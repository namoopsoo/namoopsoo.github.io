<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>michal.piekarczyk.xyz</title><meta name=keywords content><meta name=description content="sleeping&mldr; (Thread/sleep 4000) simple multithreading , from the Brave clojure book (future (Thread/sleep 4000) (println &#34;I'll print after 4 seconds&#34;)) (println &#34;I'll print immediately&#34;) hmm this is weird. so dereferencing the future blocks? (defn fight-crime [] (let [] (println &#34;hi&#34;) (Thread/sleep 2000) (println &#34;ho&#34;) (Thread/sleep 1000) (println &#34;yo&#34;) 5 )) (let [result (future (fight-crime))] (println &#34;@: &#34; @result) (println &#34;snore. &#34; ) (println &#34;@: &#34; @result) (Thread/sleep 1000) (println &#34;@: &#34; @result) ) Ah ok, but you can stop waiting."><meta name=author content="Michal Piekarczyk"><link rel=canonical href=https://michal.piekarczyk.xyz/handy/clojure/futures-promises/><link crossorigin=anonymous href=/assets/css/stylesheet.4c73b1b942ee612f2f6a56636bd60cf62223b2cdb42d501875d67bb952acf3c0.css integrity="sha256-THOxuULuYS8valZja9YM9iIjss20LVAYddZ7uVKs88A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michal.piekarczyk.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michal.piekarczyk.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michal.piekarczyk.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://michal.piekarczyk.xyz/apple-touch-icon.png><link rel=mask-icon href=https://michal.piekarczyk.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-74MK08REDT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74MK08REDT",{anonymize_ip:!1})}</script><meta property="og:title" content><meta property="og:description" content="sleeping&mldr; (Thread/sleep 4000) simple multithreading , from the Brave clojure book (future (Thread/sleep 4000) (println &#34;I'll print after 4 seconds&#34;)) (println &#34;I'll print immediately&#34;) hmm this is weird. so dereferencing the future blocks? (defn fight-crime [] (let [] (println &#34;hi&#34;) (Thread/sleep 2000) (println &#34;ho&#34;) (Thread/sleep 1000) (println &#34;yo&#34;) 5 )) (let [result (future (fight-crime))] (println &#34;@: &#34; @result) (println &#34;snore. &#34; ) (println &#34;@: &#34; @result) (Thread/sleep 1000) (println &#34;@: &#34; @result) ) Ah ok, but you can stop waiting."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/handy/clojure/futures-promises/"><meta property="article:section" content="handy"><meta property="og:site_name" content="michal.piekarczyk.xyz"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="sleeping&mldr; (Thread/sleep 4000) simple multithreading , from the Brave clojure book (future (Thread/sleep 4000) (println &#34;I'll print after 4 seconds&#34;)) (println &#34;I'll print immediately&#34;) hmm this is weird. so dereferencing the future blocks? (defn fight-crime [] (let [] (println &#34;hi&#34;) (Thread/sleep 2000) (println &#34;ho&#34;) (Thread/sleep 1000) (println &#34;yo&#34;) 5 )) (let [result (future (fight-crime))] (println &#34;@: &#34; @result) (println &#34;snore. &#34; ) (println &#34;@: &#34; @result) (Thread/sleep 1000) (println &#34;@: &#34; @result) ) Ah ok, but you can stop waiting."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Handies","item":"https://michal.piekarczyk.xyz/handy/"},{"@type":"ListItem","position":2,"name":"","item":"https://michal.piekarczyk.xyz/handy/clojure/futures-promises/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"sleeping\u0026hellip; (Thread/sleep 4000) simple multithreading , from the Brave clojure book (future (Thread/sleep 4000) (println \u0026#34;I\u0026#39;ll print after 4 seconds\u0026#34;)) (println \u0026#34;I\u0026#39;ll print immediately\u0026#34;) hmm this is weird. so dereferencing the future blocks? (defn fight-crime [] (let [] (println \u0026#34;hi\u0026#34;) (Thread/sleep 2000) (println \u0026#34;ho\u0026#34;) (Thread/sleep 1000) (println \u0026#34;yo\u0026#34;) 5 )) (let [result (future (fight-crime))] (println \u0026#34;@: \u0026#34; @result) (println \u0026#34;snore. \u0026#34; ) (println \u0026#34;@: \u0026#34; @result) (Thread/sleep 1000) (println \u0026#34;@: \u0026#34; @result) ) Ah ok, but you can stop waiting.","keywords":[],"articleBody":"sleeping… (Thread/sleep 4000) simple multithreading , from the Brave clojure book (future (Thread/sleep 4000) (println \"I'll print after 4 seconds\")) (println \"I'll print immediately\") hmm this is weird. so dereferencing the future blocks? (defn fight-crime [] (let [] (println \"hi\") (Thread/sleep 2000) (println \"ho\") (Thread/sleep 1000) (println \"yo\") 5 )) (let [result (future (fight-crime))] (println \"@: \" @result) (println \"snore. \" ) (println \"@: \" @result) (Thread/sleep 1000) (println \"@: \" @result) ) Ah ok, but you can stop waiting.. so here we wait 10ms and then return “hmmf” if future isnt done yet. (let [result (future (fight-crime))] (println \"@: \" (deref result 10 \"hmmf\")) (println \"snore. \" ) (println \"@: \" (deref result 10 \"hmmf\")) (Thread/sleep 5000) (println \"@: \" (deref result 10 \"hmmf\")) ) delays. cool (def jackson-5-delay (delay (let [message \"Just call my name and I'll be there\"] (println \"First deref:\" message) message))) and a colorful example with future, force, delay , from http://www.braveclojure.com/concurrency/ (def gimli-headshots [\"serious.jpg\" \"fun.jpg\" \"playful.jpg\"]) (defn email-user [email-address] (println \"Sending headshot notification to\" email-address)) (defn upload-document \"Needs to be implemented\" [headshot] true) (let [notify (delay (email-user \"and-my-axe@gmail.com\"))] (doseq [headshot gimli-headshots] (future (upload-document headshot) (force notify)))) Blocking thread in action… ; make a future which blocks on a promise. Then deliver promise in main thread and see what happens. (def a-promise (promise)) (def futr (future (def result (+ @a-promise 10)) (Thread/sleep 5000) (println \"result \" result) result)) ; (println \"nothing yet: \" (deref futr 10 \"nothing.\")) ; deliver.. (deliver a-promise 99) (println \"right after deliverin \" (deref futr 10 \"still nothin.\")) (Thread/sleep 5500) (println \"had some time to think... \" (deref futr)) delivering to promise multiple times? hmm, how about the other way around… make some workers do something and have them all try deliver same promise. What will happen? (def another-promise (promise)) (def d1 (delay (Thread/sleep 6000) (deliver another-promise 6000) )) ; (def d2 (delay (Thread/sleep 4000) (deliver another-promise 4000) )) ; (def d3 (delay (Thread/sleep 1000) (deliver another-promise 1000) )) ; nothing there right? (realized? another-promise) ; now run them all... (doseq [a-worker [d1 d2 d3]] (future (force a-worker)) ) (println \"Check promise: \" (deref another-promise 10 \"nothin.\")) (println \"Check promise: \" @another-promise) hmm, for the above, strange that I tried but was not able to deref the delays. Error was ClassCastException clojure.lang.Delay cannot be cast to java.util.concurrent.Future clojure.core/deref-future (core.clj:2206) exercise in http://www.braveclojure.com/concurrency/ given the yak butter search data… (def yak-butter-international {:store \"Yak Butter International\" :price 90 :smoothness 90}) (def butter-than-nothing {:store \"Butter Than Nothing\" :price 150 :smoothness 83}) ;; This is the butter that meets our requirements (def baby-got-yak {:store \"Baby Got Yak\" :price 94 :smoothness 99}) (defn mock-api-call [result] (Thread/sleep 1000) result) (defn satisfactory? \"If the butter meets our criteria, return the butter, else return false\" [butter] (and (\u003c= (:price butter) 100) (\u003e= (:smoothness butter) 97) butter)) The original non concurrent code was … (time (some (comp satisfactory? mock-api-call) [yak-butter-international butter-than-nothing baby-got-yak])) ; =\u003e \"Elapsed time: 3002.132 msecs\" ; =\u003e {:store \"Baby Got Yak\", :smoothness 99, :price 94} and a concurrent version… (defn blah-func [] (def best-butter-promise (promise)) (time (doseq [some-butter [yak-butter-international butter-than-nothing baby-got-yak]] (future (if ((comp satisfactory? mock-api-call) some-butter) (deliver best-butter-promise some-butter) ))) ) (time (println \"result is: \" @best-butter-promise)) ) (blah-func) =\u003e cloj-multiproc-play.core=\u003e (blah-func) \"Elapsed time: 0.615436 msecs\" result is: {:store Baby Got Yak, :price 94, :smoothness 99} \"Elapsed time: 1001.655823 msecs\" nil cloj-multiproc-play.core=\u003e one more example , racing Bing vs Google (def search-result-promise (promise)) (def bingurl \"https://www.bing.com/search?q=foobar\") (def googleurl \"https://www.google.com/?gws_rd=ssl#q=foobar\") (doseq [url [bingurl googleurl]] (future (deliver search-result-promise (slurp url) )) ) (def html1 (slurp \"https://www.google.com/?gws_rd=ssl#q=foobar\")) hot dog machine from http://www.braveclojure.com/core-async/ my version of a hot dog machine that only dispenses max number of hot dogs… (defn hot-dog-machine-v2 [how-many-dogs-init] (let [in (chan) out (chan)] (go (loop [num-dogs how-many-dogs-init] ; if no hot dogs left, then done. (if (= num-dogs 0) true ; Otherwise (do (println \"Going to \u003c! block on now.\") (\u003c! in) (println \"Now we have \" num-dogs \" dogs.\") (println \"Going to \u003e! block on now.\") (\u003e! out \"hot dog\") )) (recur (dec num-dogs)) )) [in out] )) ; get channels.. (def machine-channels (hot-dog-machine-v2 5)) (def in (first machine-channels)) (def out (last machine-channels)) ; ... dispensing them (println \"one\") (\u003e!! in \"pocket lint\") (\u003c!! out) (println \"two\") (\u003e!! in \"pocket lint\") (\u003c!! out) (println \"three\") (\u003e!! in \"pocket lint\") (\u003c!! out) (println \"four\") (\u003e!! in \"pocket lint\") (\u003c!! out) (println \"five\") (\u003e!! in \"pocket lint\") (\u003c!! out) .... ; that was fine except we went into negative hot dogs... playsync.core=\u003e (println \"five\") five nil playsync.core=\u003e (\u003e!! in \"pocket lint\") trueNow we have 1 dogs. Going to \u003e! block on now. playsync.core=\u003e (\u003c!! out) Going to \u003c! block on now. \"hot dog\" playsync.core=\u003e playsync.core=\u003e (\u003e!! in \"pocket lint\") Now we have -1 dogs. true Going to \u003e! block on now. playsync.core=\u003e (\u003c!! out) \"hot dog\"Going to \u003c! block on now. .. update (let [results-chan (chan) results-vector (atom [])] ; For several things in stuff-vec , start some async call that will throw results, ; into the results-chan (doseq [x stuff-vec] (do-something-async results-chan x)) ; in this case, we take from the results-chan once they are ready, ; and update (using conj) the atom results-vector (doseq [_ stuff-vec] (swap! results-vector conj (\u003c!! results-chan))) ) swap syntax for updating atoms… ","wordCount":"877","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Michal Piekarczyk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://michal.piekarczyk.xyz/handy/clojure/futures-promises/"},"publisher":{"@type":"Organization","name":"michal.piekarczyk.xyz","logo":{"@type":"ImageObject","url":"https://michal.piekarczyk.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michal.piekarczyk.xyz/ accesskey=h title="michal.piekarczyk.xyz (Alt + H)">michal.piekarczyk.xyz</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michal.piekarczyk.xyz/post/ title=posts><span>posts</span></a></li><li><a href=https://michal.piekarczyk.xyz/project/ title=projects><span>projects</span></a></li><li><a href=https://michal.piekarczyk.xyz/handy/ title=handy><span>handy</span></a></li><li><a href=https://michal.piekarczyk.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://michal.piekarczyk.xyz/about/ title=about><span>about</span></a></li><li><a href=https://world.hey.com/michal.piekarczyk title=frivolity><span>frivolity</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://michal.piekarczyk.xyz/>Home</a>&nbsp;»&nbsp;<a href=https://michal.piekarczyk.xyz/handy/>Handies</a></div><h1 class=post-title></h1><div class=post-meta>5 min&nbsp;·&nbsp;877 words&nbsp;·&nbsp;Michal Piekarczyk</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#sleeping>sleeping&mldr;</a></li><li><a href=#simple-multithreading---from-the-brave-clojure-book>simple multithreading , from the Brave clojure book</a></li><li><a href=#hmm-this-is-weird-so-dereferencing-the-future-blocks>hmm this is weird. so dereferencing the future blocks?</a></li><li><a href=#delays-cool>delays. cool</a></li><li><a href=#blocking-thread-in-action>Blocking thread in action&mldr;</a></li><li><a href=#delivering-to-promise-multiple-times>delivering to promise multiple times?</a></li><li><a href=#exercise-in-httpwwwbraveclojurecomconcurrency>exercise in <a href=http://www.braveclojure.com/concurrency/>http://www.braveclojure.com/concurrency/</a></a></li><li><a href=#one-more-example--racing-bing-vs-google>one more example , racing Bing vs Google</a></li><li><a href=#hot-dog-machine-from-httpwwwbraveclojurecomcore-async>hot dog machine from <a href=http://www.braveclojure.com/core-async/>http://www.braveclojure.com/core-async/</a></a></li><li><a href=#swap-syntax-for-updating-atoms>swap syntax for updating atoms&mldr;</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h3 id=sleeping>sleeping&mldr;<a hidden class=anchor aria-hidden=true href=#sleeping>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>4000</span>)
</span></span></code></pre></div><h3 id=simple-multithreading---from-the-brave-clojure-book>simple multithreading , from the Brave clojure book<a hidden class=anchor aria-hidden=true href=#simple-multithreading---from-the-brave-clojure-book>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#a6e22e>future</span> (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>4000</span>)
</span></span><span style=display:flex><span>        (println <span style=color:#e6db74>&#34;I&#39;ll print after 4 seconds&#34;</span>))
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;I&#39;ll print immediately&#34;</span>)
</span></span></code></pre></div><h3 id=hmm-this-is-weird-so-dereferencing-the-future-blocks>hmm this is weird. so dereferencing the future blocks?<a hidden class=anchor aria-hidden=true href=#hmm-this-is-weird-so-dereferencing-the-future-blocks>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>fight-crime
</span></span><span style=display:flex><span>  []
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[]
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;hi&#34;</span>)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>2000</span>)
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;ho&#34;</span>)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;yo&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>let </span>[result (<span style=color:#a6e22e>future</span> (<span style=color:#a6e22e>fight-crime</span>))]
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;@: &#34;</span> <span style=color:#f92672>@</span>result)
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;snore. &#34;</span> )
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;@: &#34;</span> <span style=color:#f92672>@</span>result)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;@: &#34;</span> <span style=color:#f92672>@</span>result)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><ul><li>Ah ok, but you can stop waiting.. so here we wait <code>10ms</code> and then return &ldquo;hmmf&rdquo; if future isnt done yet.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>let </span>[result (<span style=color:#a6e22e>future</span> (<span style=color:#a6e22e>fight-crime</span>))]
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;@: &#34;</span> (deref result <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;hmmf&#34;</span>))
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;snore. &#34;</span> )
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;@: &#34;</span> (deref result <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;hmmf&#34;</span>))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>5000</span>)
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;@: &#34;</span> (deref result <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;hmmf&#34;</span>))
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=delays-cool>delays. cool<a hidden class=anchor aria-hidden=true href=#delays-cool>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>def </span>jackson-5-delay
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>delay</span> (<span style=color:#66d9ef>let </span>[message <span style=color:#e6db74>&#34;Just call my name and I&#39;ll be there&#34;</span>]
</span></span><span style=display:flex><span>           (println <span style=color:#e6db74>&#34;First deref:&#34;</span> message)
</span></span><span style=display:flex><span>           message)))
</span></span></code></pre></div><ul><li>and a colorful example with <code>future</code>, <code>force</code>, <code>delay</code> , from <a href=http://www.braveclojure.com/concurrency/>http://www.braveclojure.com/concurrency/</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>def </span>gimli-headshots [<span style=color:#e6db74>&#34;serious.jpg&#34;</span> <span style=color:#e6db74>&#34;fun.jpg&#34;</span> <span style=color:#e6db74>&#34;playful.jpg&#34;</span>])
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>email-user
</span></span><span style=display:flex><span>  [email-address]
</span></span><span style=display:flex><span>  (println <span style=color:#e6db74>&#34;Sending headshot notification to&#34;</span> email-address))
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>upload-document
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;Needs to be implemented&#34;</span>
</span></span><span style=display:flex><span>  [headshot]
</span></span><span style=display:flex><span>  true)
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>let </span>[notify (<span style=color:#a6e22e>delay</span> (<span style=color:#a6e22e>email-user</span> <span style=color:#e6db74>&#34;and-my-axe@gmail.com&#34;</span>))]
</span></span><span style=display:flex><span>  (doseq [headshot gimli-headshots]
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>future</span> (<span style=color:#a6e22e>upload-document</span> headshot)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>force</span> notify))))
</span></span></code></pre></div><h3 id=blocking-thread-in-action>Blocking thread in action&mldr;<a hidden class=anchor aria-hidden=true href=#blocking-thread-in-action>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#75715e>; make a future which blocks on a promise. Then deliver promise in main thread and see what happens.</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>a-promise (<span style=color:#a6e22e>promise</span>))
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>futr
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>future</span> 
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>def </span>result (+ <span style=color:#f92672>@</span>a-promise <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>5000</span>)
</span></span><span style=display:flex><span>        (println <span style=color:#e6db74>&#34;result &#34;</span> result)
</span></span><span style=display:flex><span>        result))
</span></span><span style=display:flex><span><span style=color:#75715e>; </span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;nothing yet: &#34;</span> (deref futr <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;nothing.&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>; deliver..    </span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>deliver</span> a-promise <span style=color:#ae81ff>99</span>)
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;right after deliverin &#34;</span> (deref futr <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;still nothin.&#34;</span>))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>5500</span>)
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;had some time to think... &#34;</span> (deref futr))
</span></span></code></pre></div><h3 id=delivering-to-promise-multiple-times>delivering to promise multiple times?<a hidden class=anchor aria-hidden=true href=#delivering-to-promise-multiple-times>#</a></h3><ul><li>hmm, how about the other way around&mldr; make some workers do something and have them all try deliver same promise. What will happen?</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>def </span>another-promise (<span style=color:#a6e22e>promise</span>))
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>d1 (<span style=color:#a6e22e>delay</span> 
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>6000</span>)
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>deliver</span> another-promise <span style=color:#ae81ff>6000</span>)
</span></span><span style=display:flex><span>                ))
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>d2 (<span style=color:#a6e22e>delay</span> 
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>4000</span>)
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>deliver</span> another-promise <span style=color:#ae81ff>4000</span>)
</span></span><span style=display:flex><span>                ))
</span></span><span style=display:flex><span><span style=color:#75715e>;</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>d3 (<span style=color:#a6e22e>delay</span> 
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>deliver</span> another-promise <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>                ))
</span></span><span style=display:flex><span><span style=color:#75715e>; nothing there right?</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>realized?</span> another-promise)
</span></span><span style=display:flex><span><span style=color:#75715e>; now run them all...</span>
</span></span><span style=display:flex><span>(doseq [a-worker [d1 d2 d3]]
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>future</span> (<span style=color:#a6e22e>force</span> a-worker))
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;Check promise: &#34;</span> (deref another-promise <span style=color:#ae81ff>10</span> <span style=color:#e6db74>&#34;nothin.&#34;</span>))
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;Check promise: &#34;</span> <span style=color:#f92672>@</span>another-promise)
</span></span></code></pre></div><ul><li>hmm, for the above, strange that I tried but was not able to <code>deref</code> the delays. Error was</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>ClassCastException clojure.lang.Delay cannot be cast to java.util.concurrent.Future  clojure.core/deref-future (<span style=color:#a6e22e>core.clj</span><span style=color:#e6db74>:2206</span>)
</span></span></code></pre></div><ul><li></li></ul><h3 id=exercise-in-httpwwwbraveclojurecomconcurrency>exercise in <a href=http://www.braveclojure.com/concurrency/>http://www.braveclojure.com/concurrency/</a><a hidden class=anchor aria-hidden=true href=#exercise-in-httpwwwbraveclojurecomconcurrency>#</a></h3><ul><li>given the yak butter search data&mldr;</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>def </span>yak-butter-international
</span></span><span style=display:flex><span>  {<span style=color:#e6db74>:store</span> <span style=color:#e6db74>&#34;Yak Butter International&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:price</span> <span style=color:#ae81ff>90</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:smoothness</span> <span style=color:#ae81ff>90</span>})
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>butter-than-nothing
</span></span><span style=display:flex><span>  {<span style=color:#e6db74>:store</span> <span style=color:#e6db74>&#34;Butter Than Nothing&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>:price</span> <span style=color:#ae81ff>150</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>:smoothness</span> <span style=color:#ae81ff>83</span>})
</span></span><span style=display:flex><span><span style=color:#75715e>;; This is the butter that meets our requirements</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>baby-got-yak
</span></span><span style=display:flex><span>  {<span style=color:#e6db74>:store</span> <span style=color:#e6db74>&#34;Baby Got Yak&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>:price</span> <span style=color:#ae81ff>94</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>:smoothness</span> <span style=color:#ae81ff>99</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>mock-api-call
</span></span><span style=display:flex><span>  [result]
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>Thread/sleep</span> <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>  result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>satisfactory?
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;If the butter meets our criteria, return the butter, else return false&#34;</span>
</span></span><span style=display:flex><span>  [butter]
</span></span><span style=display:flex><span>  (and (&lt;= (<span style=color:#e6db74>:price</span> butter) <span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>       (&gt;= (<span style=color:#e6db74>:smoothness</span> butter) <span style=color:#ae81ff>97</span>)
</span></span><span style=display:flex><span>       butter))
</span></span></code></pre></div><ul><li>The original non concurrent code was &mldr;</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(time (some (comp satisfactory? mock-api-call)
</span></span><span style=display:flex><span>            [yak-butter-international butter-than-nothing baby-got-yak]))
</span></span><span style=display:flex><span><span style=color:#75715e>; =&gt; &#34;Elapsed time: 3002.132 msecs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; =&gt; {:store &#34;Baby Got Yak&#34;, :smoothness 99, :price 94}</span>
</span></span></code></pre></div><ul><li>and a concurrent version&mldr;</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>blah-func
</span></span><span style=display:flex><span>    []
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>def </span>best-butter-promise (<span style=color:#a6e22e>promise</span>))
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>time</span>
</span></span><span style=display:flex><span>        (doseq [some-butter [yak-butter-international butter-than-nothing baby-got-yak]]
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>future</span> (<span style=color:#66d9ef>if </span>((comp satisfactory? mock-api-call) some-butter)
</span></span><span style=display:flex><span>                        (<span style=color:#a6e22e>deliver</span> best-butter-promise some-butter)
</span></span><span style=display:flex><span>                        )))
</span></span><span style=display:flex><span>                        )
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>time</span>
</span></span><span style=display:flex><span>        (println <span style=color:#e6db74>&#34;result is: &#34;</span> <span style=color:#f92672>@</span>best-butter-promise))
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>blah-func</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>=&gt;
</span></span><span style=display:flex><span>cloj-multiproc-play.core=&gt; (<span style=color:#a6e22e>blah-func</span>)
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Elapsed time: 0.615436 msecs&#34;</span>
</span></span><span style=display:flex><span>result is<span style=color:#960050;background-color:#1e0010>:</span>  {<span style=color:#e6db74>:store</span> Baby Got Yak, <span style=color:#e6db74>:price</span> <span style=color:#ae81ff>94</span>, <span style=color:#e6db74>:smoothness</span> <span style=color:#ae81ff>99</span>}
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;Elapsed time: 1001.655823 msecs&#34;</span>
</span></span><span style=display:flex><span>nil
</span></span><span style=display:flex><span>cloj-multiproc-play.core=&gt;
</span></span></code></pre></div><h3 id=one-more-example--racing-bing-vs-google>one more example , racing Bing vs Google<a hidden class=anchor aria-hidden=true href=#one-more-example--racing-bing-vs-google>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>search-result-promise (<span style=color:#a6e22e>promise</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>bingurl  <span style=color:#e6db74>&#34;https://www.bing.com/search?q=foobar&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>googleurl <span style=color:#e6db74>&#34;https://www.google.com/?gws_rd=ssl#q=foobar&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(doseq [url [bingurl googleurl]]
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>future</span> (<span style=color:#a6e22e>deliver</span> search-result-promise (slurp url)
</span></span><span style=display:flex><span>       ))
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>html1 (slurp <span style=color:#e6db74>&#34;https://www.google.com/?gws_rd=ssl#q=foobar&#34;</span>))
</span></span></code></pre></div><h3 id=hot-dog-machine-from-httpwwwbraveclojurecomcore-async>hot dog machine from <a href=http://www.braveclojure.com/core-async/>http://www.braveclojure.com/core-async/</a><a hidden class=anchor aria-hidden=true href=#hot-dog-machine-from-httpwwwbraveclojurecomcore-async>#</a></h3><ul><li>my version of a hot dog machine that only dispenses max number of hot dogs&mldr;</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>hot-dog-machine-v2
</span></span><span style=display:flex><span>  [how-many-dogs-init]
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[in (<span style=color:#a6e22e>chan</span>)
</span></span><span style=display:flex><span>        out (<span style=color:#a6e22e>chan</span>)]
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>go</span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>loop </span>[num-dogs how-many-dogs-init]
</span></span><span style=display:flex><span>        <span style=color:#75715e>; if no hot dogs left, then done.</span>
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>if </span>(= num-dogs <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>          true
</span></span><span style=display:flex><span>          <span style=color:#75715e>; Otherwise </span>
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>do</span>
</span></span><span style=display:flex><span>            (println <span style=color:#e6db74>&#34;Going to &lt;! block on &lt;in&gt; now.&#34;</span>)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>&lt;!</span> in)
</span></span><span style=display:flex><span>            (println <span style=color:#e6db74>&#34;Now we have &#34;</span> num-dogs <span style=color:#e6db74>&#34; dogs.&#34;</span>)
</span></span><span style=display:flex><span>            (println <span style=color:#e6db74>&#34;Going to &gt;! block on &lt;out&gt; now.&#34;</span>)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>&gt;!</span> out <span style=color:#e6db74>&#34;hot dog&#34;</span>)
</span></span><span style=display:flex><span>            ))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>recur</span> (dec num-dogs))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        ))
</span></span><span style=display:flex><span>    [in out]
</span></span><span style=display:flex><span>    ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; get channels..</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>machine-channels (<span style=color:#a6e22e>hot-dog-machine-v2</span> <span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>in (first machine-channels))
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span>out (last machine-channels))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; ... dispensing them    </span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;two&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;three&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;four&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;five&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span>....
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; that was fine except we went into negative hot dogs...</span>
</span></span><span style=display:flex><span>playsync.core=&gt; (println <span style=color:#e6db74>&#34;five&#34;</span>)
</span></span><span style=display:flex><span>five
</span></span><span style=display:flex><span>nil
</span></span><span style=display:flex><span>playsync.core=&gt; (<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>trueNow we have  <span style=color:#ae81ff>1</span>  dogs.
</span></span><span style=display:flex><span>Going to &gt;! block on &lt;out&gt; now.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>playsync.core=&gt; (<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span>Going to &lt;! block on &lt;in&gt; now.
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;hot dog&#34;</span>
</span></span><span style=display:flex><span>playsync.core=&gt; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>playsync.core=&gt; (<span style=color:#a6e22e>&gt;!!</span> in <span style=color:#e6db74>&#34;pocket lint&#34;</span>)
</span></span><span style=display:flex><span>Now we have  <span style=color:#ae81ff>-1</span>  dogs.
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>Going to &gt;! block on &lt;out&gt; now.
</span></span><span style=display:flex><span>playsync.core=&gt; (<span style=color:#a6e22e>&lt;!!</span> out)
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;hot dog&#34;</span>Going to &lt;! block on &lt;in&gt; now.
</span></span></code></pre></div><ul><li>.. update</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>let </span>[results-chan (<span style=color:#a6e22e>chan</span>)
</span></span><span style=display:flex><span>    results-vector (<span style=color:#a6e22e>atom</span> [])]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>; For several things in stuff-vec , start some async call that will throw results,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; into the results-chan</span>
</span></span><span style=display:flex><span>    (doseq [x stuff-vec]
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>do-something-async</span> results-chan x))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>; in this case, we take from the results-chan once they are ready, </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; and update (using conj) the atom results-vector</span>
</span></span><span style=display:flex><span>    (doseq [_ stuff-vec]
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>swap!</span> results-vector conj (<span style=color:#a6e22e>&lt;!!</span> results-chan)))
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><h3 id=swap-syntax-for-updating-atoms>swap syntax for updating atoms&mldr;<a hidden class=anchor aria-hidden=true href=#swap-syntax-for-updating-atoms>#</a></h3><ul><li></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://michal.piekarczyk.xyz/>michal.piekarczyk.xyz</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>