<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>michal.piekarczyk.xyz</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content><meta name=generator content="Hugo 0.83.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link href=/handy/index.xml rel=alternate type=application/rss+xml title=michal.piekarczyk.xyz><link href=/handy/index.xml rel=feed type=application/rss+xml title=michal.piekarczyk.xyz><meta property="og:title" content="Handies"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://michal.piekarczyk.xyz/handy/"><meta itemprop=name content="Handies"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Handies"><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">michal.piekarczyk.xyz</a><div class="flex-l items-center"></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">Handies</h1></div></div></header><main class=pb7 role=main><article class="pa3 pa4-ns nested-copy-line-height nested-img"><section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></section><section class="flex-ns flex-wrap justify-around mt5"><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/aws/athena/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">This may apply to Athena and or prestodb in general
array empty? Per stackoverflow learned the name for this in the docs is cardinality select cardinality(array[]) = 0; This cannot be applied to the output of a json_extract(json_parse(data), '$.blah.flah.clah') since cardinality() takes ARRAY and not JSON. However, that JSON can be cast. For example, if '$.blah.flah.clah' is like [{"hi": "there"}, {"so": "then"}], then this cardinality(cast(json_extract(json_parse(what), '$.blah.flah.clah') as array(map(varchar, varchar)))) will produce the length of those arrays.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/aws/lambda/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Make a zip file for a lambda layer From a well written reference here : adjust the python version as needed #!/bin/bash export LIB_DIR="python" rm -rf ${LIB_DIR} && mkdir -p ${LIB_DIR} docker run --rm -v $(pwd):/foo -w /foo lambci/lambda:build-python3.8 \ pip install -r requirements.txt -t ${LIB_DIR} zip -r layer.zip python And I like to use vim layer.zip to look at the contents</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/atom-vec-and-while-loop/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">atom vec [] and while loop&mldr; (let [results-atom (atom [])] ; ; (println "elements: " (count @results-atom)) ; (swap! results-atom conj "hi") ;results-atom (while (&lt; (count @results-atom) 3) (do (println "doing") ; insert (swap! results-atom conj "hi") (println "elements: " (count @results-atom)) )) ; done (println "Done. Now have elements: " (count @results-atom)) ) => doing elements: 1 doing elements: 2 doing elements: 3 Done. Now have elements: 3 nil</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/callbacks-and-async/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">basic callbacks&mldr; (comment "basic callback" (let [callback-fn #(+ 5 %) ] (callback-fn 10)) ) &mldr; user=> (let [callback-fn #(+ 5 %) #_=> ] #_=> (callback-fn 10)) 15 callback w future (comment "future w callback func" (defn use-callback-when-done [callback-fn] (future (callback-fn (+ 4 5)))) (def output (use-callback-when-done #(println "printings.. " % " .end"))) ) => user=> (def output (use-callback-when-done #(println "printings.. " % " .end"))) #'user/output printings.. 9 .</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/clojure_tips/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">(Porting over my notes from gists .. here ),..
quick note on imports i originally inferred this (ns blah-namespace (:use clojure.core.blah ) ; this would take all the terms in blah and put them into the current namespace (:refer-clojure :exclude [blarg flarg]) ; but this is supposed to be a way to avoid term clash ; so blarg and flarg will not be used. (not that they are in clojure.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/cool-arity-thing/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">keys keywords from map (let [ {:keys [status headers body error]} {:status 0 :headers 1 :body 3 :error 5 :extra 88} ] (println status body) ) your.app=> (let [ #_=> {:keys [status headers body error]} {:status 0 :headers 1 :body 3 :error 5 :extra 88} #_=> ] #_=> (println status body) #_=> ) 0 3 nil your.app=> also keyword args arity (comment "" (defn foof [a b & {:keys [op-fn] :or {op-fn +}}] (op-fn a b)) (foof 4 5 :op-fn *) (foof 4 5 :op-fn #(str %1 ".</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/debug-and-troubleshooting/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">print data structures so as to preserve quotation (quotes) wow .. took too long to come across this nugget https://stackoverflow.com/questions/21136766/clojure-printing-functions-pr-vs-print pr/prn is to print/println for human readability. user=> (def d1 {:foo {:nil true :and "yay"}}) #'user/d1 user=> (prn "ok... " d1) "ok... " {:foo {:nil true, :and "yay"}} nil</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/devops-and-environment/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Dependencies and the repl It appears adding new dependencies into the build.boot file, and then running boot local repl again, downloads required dependencies and makes them useable for in the project.
directory structure for a project
my-project-root/ VERSION build.boot src/ blah/ foo.clj blarth.clj</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/dynamodb/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">list tables, first get the faraday class thing ready.
boot.user=> (use '[taoensso.faraday :as dynamo]) with a client-config hash defined in a separate clj file, here one/dynamo.clj is my file.
(def client-config (if (:development env) {:access-key "OMGDEVELOPMENT" :secret-key "I_SHOULD_KEEP_THIS_SECRET!" ; Point the configuration at the DynamoDB Local :endpoint "http://localhost:8000"} {:endpoint "http://dynamodb.us-east-1.amazonaws.com"} ) ) and use list-tables from the module/class thing,
boot.user=> (use '[one.dynamo :as db]) ; `one/dynamo.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Handy</span><h1 class="f3 near-black"><a href=https://michal.piekarczyk.xyz/handy/clojure/file-io/ class="link black dim"></a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">read
(use 'clojure.java.io) (with-open [rdr (reader "/tmp/test.txt")] (doseq [line (line-seq rdr)] (println line))) write (use 'clojure.java.io) (with-open [wrtr (writer "/tmp/test.txt")] (.write wrtr "Line to be written"))</div></div></div></div></section><ul class=pagination><li class=page-item><a href=/handy/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a class=page-link href=/handy/>1</a></li><li class=page-item><a class=page-link href=/handy/page/2/>2</a></li><li class=page-item><a class=page-link href=/handy/page/3/>3</a></li><li class=page-item><a class=page-link href=/handy/page/4/>4</a></li><li class=page-item><a href=/handy/page/2/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/handy/page/4/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://michal.piekarczyk.xyz/>&copy; michal.piekarczyk.xyz 2021</a><div></div></div></footer></body></html>