<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Easy Blog Posting ("My Noting Book") | My blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out  Per here &mldr;  pip install dropbox Went w/ that Getting Started page   Through that page, I created a new test app for myself.
  Using the API explorer &mldr; I hit Get Token ..
  https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=xxxxxxxxx&redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&state=file_requests_list!39%2B%2Bxxxxxxxx&token_access_type=online&
 That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account."><meta name=generator content="Hugo 0.96.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><meta property="og:title" content="Easy Blog Posting (&#34;My Noting Book&#34;)"><meta property="og:description" content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out  Per here &mldr;  pip install dropbox Went w/ that Getting Started page   Through that page, I created a new test app for myself.
  Using the API explorer &mldr; I hit Get Token ..
  https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=xxxxxxxxx&redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&state=file_requests_list!39%2B%2Bxxxxxxxx&token_access_type=online&
 That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-12-09T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-09T00:00:00+00:00"><meta property="og:site_name" content="My blog"><meta itemprop=name content="Easy Blog Posting (&#34;My Noting Book&#34;)"><meta itemprop=description content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out  Per here &mldr;  pip install dropbox Went w/ that Getting Started page   Through that page, I created a new test app for myself.
  Using the API explorer &mldr; I hit Get Token ..
  https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=xxxxxxxxx&redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&state=file_requests_list!39%2B%2Bxxxxxxxx&token_access_type=online&
 That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account."><meta itemprop=datePublished content="2020-12-09T00:00:00+00:00"><meta itemprop=dateModified content="2020-12-09T00:00:00+00:00"><meta itemprop=wordCount content="1540"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Easy Blog Posting (&#34;My Noting Book&#34;)"><meta name=twitter:description content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out  Per here &mldr;  pip install dropbox Went w/ that Getting Started page   Through that page, I created a new test app for myself.
  Using the API explorer &mldr; I hit Get Token ..
  https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=xxxxxxxxx&redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&state=file_requests_list!39%2B%2Bxxxxxxxx&token_access_type=online&
 That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">My blog</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/handy/ title="Handy page">Handy</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/post/ title="Post page">Post</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/project/ title="Side Projects page">Side Projects</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/foo/ title="The Foos page">The Foos</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POST</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/&text=Easy%20Blog%20Posting%20%28%22My%20Noting%20Book%22%29" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/&title=Easy%20Blog%20Posting%20%28%22My%20Noting%20Book%22%29" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Easy Blog Posting ("My Noting Book")</h1><time class="f6 mv4 dib tracked" datetime=2020-12-09T00:00:00Z>December 9, 2020</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h3 id=for-my-easyblogposting-project>For my EasyBlogPosting project..</h3><p>Testing out the Dropbox API..</p><h3 id=2020-12-09>2020-12-09</h3><h4 id=trying-this-out>trying this out</h4><ul><li>Per <a href=https://www.dropbox.com/developers/reference/getting-started>here</a> &mldr;</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pip install dropbox
</span></span></code></pre></div><h4 id=went-w-that-getting-started-page>Went w/ that Getting Started page</h4><ul><li><p>Through that page, I created a new test app for myself.</p></li><li><p>Using the API explorer &mldr; I hit Get Token ..</p></li></ul><p><a href="https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=xxxxxxxxx&redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&state=file_requests_list!39%2B%2Bxxxxxxxx&token_access_type=online&">https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=xxxxxxxxx&redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&state=file_requests_list!39%2B%2Bxxxxxxxx&token_access_type=online&</a></p><ul><li>That generated a token and I used <a href=https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder>https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder</a> and I was able to see actual folders in my account.</li><li>That&rsquo;s cool except I thought I had chosen something like &lsquo;single folder access&rsquo; so I&rsquo;m slightly confused why I can see the other folders.</li><li>Maybe the generated token in the API explorer is separate and meant for testing. Hopefully it&rsquo;s short lived.</li></ul><h3 id=2020-12-13>2020-12-13</h3><h4 id=oh-my-special-app-folder-was-created-w-the-acess-token>oh my special app folder was created w/ the acess token</h4><ul><li>As soon as on my <a href=https://www.dropbox.com/developers/apps/info/blahblahblah>app page</a> I hit &ldquo;Generate access token&rdquo; , my special App folder was created.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> dropbox
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Initializing Dropbox API...&#34;</span>)
</span></span><span style=display:flex><span>dbx <span style=color:#f92672>=</span> dropbox<span style=color:#f92672>.</span>Dropbox(os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;DBX_ACCESS_TOKEN&#39;</span>))
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> dbx<span style=color:#f92672>.</span>files_list_folder(path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>BadInputError: BadInputError(<span style=color:#e6db74>&#39;xxxxxxxxxxx&#39;</span>, <span style=color:#e6db74>&#39;Error in call to API function &#34;files/list_folder&#34;: Your app is not permitted to access this endpoint because it does not have the required scope </span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>files.metadata.read</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>. The owner of the app can enable the scope for the app using the Permissions tab on the App Console.&#39;</span>)
</span></span></code></pre></div><ul><li>Ah ok so I went to the Permissions tab, checked that &lsquo;files.metadata.read&rsquo; box and tried again.</li><li>Now seeing</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>AuthError: AuthError(<span style=color:#e6db74>&#39;xxxxxxxxxxx&#39;</span>, AuthError(<span style=color:#e6db74>&#39;missing_scope&#39;</span>, TokenScopeError(required_scope<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;files.metadata.read&#39;</span>)))
</span></span></code></pre></div><ul><li>Ah according to <a href=https://stackoverflow.com/a/64201654>stackoverflow</a> , the scope cannot be retroactively granted to a token created before the scope was granted.</li><li>Ok &mldr; trying to re-create a new token&mldr;</li><li>Ok recreated. Retried. Worked!</li><li>How to read?</li><li>What&rsquo;s the difference between the two <code>files/download</code> , <code>files/export</code> ( <code>files/get_preview</code> )</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Initializing Dropbox API...&#34;</span>)
</span></span><span style=display:flex><span>dbx <span style=color:#f92672>=</span> dropbox<span style=color:#f92672>.</span>Dropbox(os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;DBX_ACCESS_TOKEN&#39;</span>))
</span></span><span style=display:flex><span>meta, response <span style=color:#f92672>=</span> dbx<span style=color:#f92672>.</span>files_download(<span style=color:#e6db74>&#39;/blarg.txt&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># In [22]: response.text                                                                                                                        </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Out[22]: &#39;foo blarg\n&#39;</span>
</span></span></code></pre></div><h4 id=github-interaction>Github interaction</h4><ul><li>Hmm I was going down the path of building an AWS Batch container to commit to my git repo</li><li>But hmmm I encountered that there may be a <a href=https://docs.github.com/en/free-pro-team@latest/rest>Github API</a> which I can perhaps use??? And a <a href=https://codesnippet.io/github-api-tutorial/>nice tutorial</a></li><li>Cool, so <code>https://api.github.com/users/namoopsoo/repos</code> , repos are here.</li><li>However <a href=https://docs.github.com/en/free-pro-team@latest/rest/overview/other-authentication-methods>the oauth flow</a> , looks kind of involved for a quick script</li><li>But ah that&rsquo;s right you can create a token for your account from here, <a href=https://github.com/settings/tokens/new>Github settings</a> .</li><li>Ok cool I was able to perform a simple curl w/ the personal token I created for myself &mldr; ( per <a href=https://docs.github.com/en/free-pro-team@latest/rest/overview/other-authentication-methods>docs</a> )</li></ul><pre tabindex=0><code>$ curl -v -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/users/namoopsoo/repos
</code></pre><h4 id=ok-but-can-your-write-using-this-api-is-the-big-question>ok but can your write using this API is the big question..</h4><ul><li>Hmm according to <a href=https://docs.github.com/en/free-pro-team@latest/rest/reference/git#commits>here</a> you can commit.</li></ul><pre tabindex=0><code>post /repos/{owner}/{repo}/git/commits
</code></pre><ul><li>But not seeing how to include the actual diffs in there. Maybe a <a href=https://docs.github.com/en/free-pro-team@latest/rest/reference/git#blobs>blob?</a></li><li>Ok according to <a href=http://www.levibotelho.com/development/commit-a-file-with-the-github-api/>this nice article</a> , indeed the blob endpoint is for files! hmm</li></ul><h5 id=step-1-get-a-reference-like-herehttpsdevelopergithubcomv3gitrefsget-a-reference>step 1, get a reference.. like <a href=https://developer.github.com/v3/git/refs/#get-a-reference>here</a></h5><pre tabindex=0><code>curl -v -H &#34;Authorization: token ${GITHUB_TOKEN}&#34;   https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/ref/heads/master
</code></pre><p>Nice excellent, &mldr;</p><pre tabindex=0><code>...
...
{
  &#34;ref&#34;: &#34;refs/heads/master&#34;,
  &#34;node_id&#34;: &#34;MDM6UmVmMTAwMTg1NjcwOnJlZnMvaGVhZHMvbWFzdGVy&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master&#34;,
  &#34;object&#34;: {
    &#34;sha&#34;: &#34;482d52f53a146dd688eff4ed8093cf2980580662&#34;,
    &#34;type&#34;: &#34;commit&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662&#34;
  }
}
</code></pre><h5 id=step-2--grab-the-commit-that-head-points-to>step 2 , Grab the commit that HEAD points to</h5><pre tabindex=0><code>curl -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662
</code></pre><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;482d52f53a146dd688eff4ed8093cf2980580662&#34;,
  &#34;node_id&#34;: &#34;MDY6Q29tbWl0MTAwMTg1NjcwOjQ4MmQ1MmY1M2ExNDZkZDY4OGVmZjRlZDgwOTNjZjI5ODA1ODA2NjI=&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662&#34;,
  &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/482d52f53a146dd688eff4ed8093cf2980580662&#34;,
  &#34;author&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-13T21:39:11Z&#34;
  },
  &#34;committer&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-13T21:39:11Z&#34;
  },
  &#34;tree&#34;: {
    &#34;sha&#34;: &#34;e5a9ee9506a040a7cc8c608614db7531f8f32e70&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70&#34;
  },
  &#34;message&#34;: &#34;moar&#34;,
  &#34;parents&#34;: [
    {
      &#34;sha&#34;: &#34;13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc&#34;,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc&#34;,
      &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc&#34;
    }
  ],
  &#34;verification&#34;: {
    &#34;verified&#34;: false,
    &#34;reason&#34;: &#34;unsigned&#34;,
    &#34;signature&#34;: null,
    &#34;payload&#34;: null
  }
}
</code></pre><ul><li>Ok and the tree sha is important. Reading up on this <a href=https://git-scm.com/book/en/v2/Git-Internals-Git-Objects>here</a></li><li>Okay after taking a <a href=/2020/12/13/Article-GitInternalsGitObjects-notes.html>mini detour</a> to understand what a <em>Tree Object</em> is, I think I can keep going now .</li><li>So a <em>Tree Object</em> is a group of other objects ( blob and or tree objects).</li><li>So continuing with <a href=http://www.levibotelho.com/development/commit-a-file-with-the-github-api/>this article</a> , going to post a blob next</li></ul><h4 id=3-post-your-new-file-to-the-server>3. Post your new file to the server</h4><pre tabindex=0><code>curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs \
  -d &#39;{&#34;content&#34;: &#34;content of the blob&#34;, &#34;encoding&#34;: &#34;utf-8&#34;}&#39;
</code></pre><p>Getting</p><pre tabindex=0><code>{
  &#34;message&#34;: &#34;Not Found&#34;,
  &#34;documentation_url&#34;: &#34;https://docs.github.com/rest/reference/git#create-a-blob&#34;
}
</code></pre><p>Well Not Found is better than permission denied I guess.</p><ul><li>Ah actually, .. I took a random guess and looking at <a href=https://github.com/settings/tokens>https://github.com/settings/tokens</a> indeed found I needed to just add some extra permissions.</li><li>Tried that same <code>curl -X POST</code> again and now got back</li></ul><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;
}
</code></pre><p>So all good.</p><h4 id=4-get-a-hold-of-the-tree-that-the-commit-points-to>4. Get a hold of the tree that the commit points to</h4><ul><li>Ok so grabbing that <code>e5a9ee9506a040a7cc8c608614db7531f8f32e70</code> tree of my target branch&rsquo;s current <code>HEAD</code> commit now&mldr;</li><li>( and incidentally that <code>jq</code> json querying parsing utility is kind of nice here.. )</li></ul><pre tabindex=0><code>get /repos/{owner}/{repo}/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70
curl \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70  \
  | jq --color-output &#39;.tree | .[0:3]&#39;
  [
    {
      &#34;path&#34;: &#34;.gitignore&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;f40fbd8ba564ea28e0a2501e2921909467b39887&#34;,
      &#34;size&#34;: 56,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/f40fbd8ba564ea28e0a2501e2921909467b39887&#34;
    },
    {
      &#34;path&#34;: &#34;404.html&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;086a5c9ea988c5a4d37acc5f8ea089e37cb19371&#34;,
      &#34;size&#34;: 419,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/086a5c9ea988c5a4d37acc5f8ea089e37cb19371&#34;
    },
    {
      &#34;path&#34;: &#34;CNAME&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;922c44a4850e7421585c9030ecd82face732adc6&#34;,
      &#34;size&#34;: 21,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/922c44a4850e7421585c9030ecd82face732adc6&#34;
    }
  ]
</code></pre><pre tabindex=0><code>(pandars3) $ curl   -H &#34;Accept: application/vnd.github.v3+json&#34;   -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70 |jq --color-output &#39;.tree | map(.type)&#39;
[
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;tree&#34;,
  &#34;blob&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;blob&#34;,
  &#34;tree&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;
]
</code></pre><ul><li>Also noticed the paths dont seem to be absolute paths ..</li><li>I looked up the tree representing the directory <code>_sass</code> and got a relative path there inside..</li></ul><pre tabindex=0><code>[
  {
    &#34;path&#34;: &#34;main.scss&#34;,
    &#34;mode&#34;: &#34;100644&#34;,
    &#34;type&#34;: &#34;blob&#34;,
    &#34;sha&#34;: &#34;bc25e9ec345e7f25206a42139085669d4ad800b9&#34;,
    &#34;size&#34;: 29,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/bc25e9ec345e7f25206a42139085669d4ad800b9&#34;
  }
]
(pandars3) $ ls _s
_sass/ _site/
(pandars3) $ ls _sass/
main.scss
(pandars3) $
</code></pre><h4 id=5-create-a-tree-containing-your-new-file>5. Create a tree containing your new file</h4><ul><li>Ok So I must create a new tree containing the newly created blob.</li><li>I had actually committed a few commits in the meantime, so I just have to fetch the last trees commit again &mldr;</li></ul><pre tabindex=0><code># using the last commit ... bc74103c6c376a267f6f480e185fcb0c816d2f5b

(pandars3) $ curl -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b
{
  &#34;sha&#34;: &#34;bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
  &#34;node_id&#34;: &#34;MDY6Q29tbWl0MTAwMTg1NjcwOmJjNzQxMDNjNmMzNzZhMjY3ZjZmNDgwZTE4NWZjYjBjODE2ZDJmNWI=&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
  &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
  &#34;author&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-14T00:47:00Z&#34;
  },
  &#34;committer&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-14T00:47:00Z&#34;
  },
  &#34;tree&#34;: {
    &#34;sha&#34;: &#34;e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;
  },
  &#34;message&#34;: &#34;moar&#34;,
  &#34;parents&#34;: [
    {
      &#34;sha&#34;: &#34;c96842008683f25454793eccc3938cce1f605eb6&#34;,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/c96842008683f25454793eccc3938cce1f605eb6&#34;,
      &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/c96842008683f25454793eccc3938cce1f605eb6&#34;
    }
  ],
  &#34;verification&#34;: {
    &#34;verified&#34;: false,
    &#34;reason&#34;: &#34;unsigned&#34;,
    &#34;signature&#34;: null,
    &#34;payload&#34;: null
  }
}
</code></pre><ul><li>ok now to create a new tree using <code>e25ed95e0655cc209c8a3f9c61d18a182abd60d0</code> from above, as the base tree</li><li>And the new blob I had created earlier&mldr; is <code>6b2d785ecc7db8b71ee933a5b22961a52f40592c</code></li></ul><pre tabindex=0><code>post /repos/{owner}/{repo}/git/trees

curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees \
  -d &#39;{&#34;base_tree&#34;: &#34;e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;, \
    &#34;tree&#34;: [ \
      { \
        &#34;path&#34;: &#34;new_blob.txt&#34;, \
        &#34;mode&#34;: &#34;100644&#34;, \
        &#34;type&#34;: &#34;blob&#34;, \
        &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34; \
      } \
    ] \
    }&#39;
</code></pre><ul><li>ok first try I got</li></ul><pre tabindex=0><code>{
  &#34;message&#34;: &#34;Problems parsing JSON&#34;,
  &#34;documentation_url&#34;: &#34;https://docs.github.com/rest/reference/git#create-a-tree&#34;
}
</code></pre><ul><li>Ok tried without trying to break it up on multiple lines and this time somehow worked..</li></ul><pre tabindex=0><code>curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees \
  -d &#39;{&#34;base_tree&#34;: &#34;e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;, &#34;tree&#34;: [ { &#34;path&#34;: &#34;new_blob.txt&#34;, &#34;mode&#34;: &#34;100644&#34;, &#34;type&#34;: &#34;blob&#34;, &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34; } ] }&#39;
</code></pre><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;477075b08cae14b22534e7071b066d383696222c&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/477075b08cae14b22534e7071b066d383696222c&#34;,
  &#34;tree&#34;: [
    {
      &#34;path&#34;: &#34;.gitignore&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;f40fbd8ba564ea28e0a2501e2921909467b39887&#34;,
      &#34;size&#34;: 56,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/f40fbd8ba564ea28e0a2501e2921909467b39887&#34;
    },
...
...
{
  &#34;path&#34;: &#34;new_blob.txt&#34;,
  &#34;mode&#34;: &#34;100644&#34;,
  &#34;type&#34;: &#34;blob&#34;,
  &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;,
  &#34;size&#34;: 19,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;
},
...
]
</code></pre><h4 id=6-create-a-new-commit>6. Create a new commit</h4><ul><li>The parent commit in this case&mldr; <code>bc74103c6c376a267f6f480e185fcb0c816d2f5b</code></li><li>And the <code>477075b08cae14b22534e7071b066d383696222c</code> new tree created in last step&mldr;</li></ul><pre tabindex=0><code>curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits \
  -d  &#39; { &#34;message&#34;: &#34;my first commit using github api!&#34;, &#34;parents&#34;: [&#34;bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;], &#34;tree&#34;: &#34;477075b08cae14b22534e7071b066d383696222c&#34; } &#39;
</code></pre><p>As far as I can tell that created a commit .. <code>526dea236deed39d9a996187a6eb31c55137f675</code></p><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;,
  &#34;node_id&#34;: &#34;MDY6Q29tbWl0MTAwMTg1NjcwOjUyNmRlYTIzNmRlZWQzOWQ5YTk5NjE4N2E2ZWIzMWM1NTEzN2Y2NzU=&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/526dea236deed39d9a996187a6eb31c55137f675&#34;,
  &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/526dea236deed39d9a996187a6eb31c55137f675&#34;,
  &#34;author&#34;: {
    &#34;name&#34;: &#34;namoopsoo&#34;,
    &#34;email&#34;: &#34;namoopsoo@users.noreply.github.com&#34;,
    &#34;date&#34;: &#34;2020-12-14T01:28:09Z&#34;
  },
  &#34;committer&#34;: {
    &#34;name&#34;: &#34;namoopsoo&#34;,
    &#34;email&#34;: &#34;namoopsoo@users.noreply.github.com&#34;,
    &#34;date&#34;: &#34;2020-12-14T01:28:09Z&#34;
  },
  &#34;tree&#34;: {
    &#34;sha&#34;: &#34;477075b08cae14b22534e7071b066d383696222c&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/477075b08cae14b22534e7071b066d383696222c&#34;
  },
  &#34;message&#34;: &#34;my first commit using github api!&#34;,
  &#34;parents&#34;: [
    {
      &#34;sha&#34;: &#34;bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
      &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;
    }
  ],
  &#34;verification&#34;: {
    &#34;verified&#34;: false,
    &#34;reason&#34;: &#34;unsigned&#34;,
    &#34;signature&#34;: null,
    &#34;payload&#34;: null
  }
}
</code></pre><h4 id=7-update-head>7. Update HEAD</h4><pre tabindex=0><code>patch /repos/{owner}/{repo}/git/refs/{ref}
curl \
  -X PATCH \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/master/HEAD \
  -d  &#39;{&#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;} &#39;
</code></pre><p>First stab I&rsquo;m seeing</p><pre tabindex=0><code>{
  &#34;message&#34;: &#34;Reference does not exist&#34;,
  &#34;documentation_url&#34;: &#34;https://docs.github.com/rest/reference/git#update-a-reference&#34;
}
</code></pre><ul><li>(Incidentally at this point I tried <code>git fetch</code> and didnt work. Also didnt see the new commit on the github.com through a browser either. )</li><li>Ok using a slightly different syntax..</li></ul><pre tabindex=0><code>curl \
  -X PATCH \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master \
  -d  &#39;{&#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;} &#39;
</code></pre><pre tabindex=0><code>{
  &#34;ref&#34;: &#34;refs/heads/master&#34;,
  &#34;node_id&#34;: &#34;MDM6UmVmMTAwMTg1NjcwOnJlZnMvaGVhZHMvbWFzdGVy&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master&#34;,
  &#34;object&#34;: {
    &#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;,
    &#34;type&#34;: &#34;commit&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/526dea236deed39d9a996187a6eb31c55137f675&#34;
  }
}
</code></pre><p>Nice and success..</p><pre tabindex=0><code>(pandars3) $ git log  --graph --pretty=oneline --abbrev-commit --decorate  --all
* 526dea2 (origin/master) my first commit using github api!
* bc74103 (HEAD -&gt; master) moar
* c968420 moar
</code></pre><p>I also checked that <code>git log -p</code> indeed showed only one change in that commit, a new file <code>new_blob.txt</code> with <code>content of the blob</code></p><h4 id=next>Next</h4><ul><li>That was pretty cool. Next I should like to combine the Dropbox + github Api parts to make a proof of concept,</li><li>A Proof of concept that reads a new yaml file in that special dropbox application folder, runs something like the <code>quick_post.py</code> and publishes a new file through the github api.</li></ul><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://michal.piekarczyk.xyz/>&copy; My blog 2022</a><div></div></div></footer></body></html>