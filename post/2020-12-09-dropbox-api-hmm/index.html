<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Easy Blog Posting ("My Noting Book") | michal.piekarczyk.xyz</title><meta name=keywords content><meta name=description content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out Per here &mldr; pip install dropbox Went w/ that Getting Started page Through that page, I created a new test app for myself.
Using the API explorer &mldr; I hit Get Token ..
https://www.dropbox.com/oauth2/authorize?response_type=token&amp;client_id=xxxxxxxxx&amp;redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&amp;state=file_requests_list!39%2B%2Bxxxxxxxx&amp;token_access_type=online&
That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account. That&rsquo;s cool except I thought I had chosen something like &lsquo;single folder access&rsquo; so I&rsquo;m slightly confused why I can see the other folders."><meta name=author content="Michal Piekarczyk"><link rel=canonical href=https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/><link crossorigin=anonymous href=/assets/css/stylesheet.4c73b1b942ee612f2f6a56636bd60cf62223b2cdb42d501875d67bb952acf3c0.css integrity="sha256-THOxuULuYS8valZja9YM9iIjss20LVAYddZ7uVKs88A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michal.piekarczyk.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michal.piekarczyk.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michal.piekarczyk.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://michal.piekarczyk.xyz/apple-touch-icon.png><link rel=mask-icon href=https://michal.piekarczyk.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-74MK08REDT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74MK08REDT",{anonymize_ip:!1})}</script><meta property="og:title" content="Easy Blog Posting (&#34;My Noting Book&#34;)"><meta property="og:description" content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out Per here &mldr; pip install dropbox Went w/ that Getting Started page Through that page, I created a new test app for myself.
Using the API explorer &mldr; I hit Get Token ..
https://www.dropbox.com/oauth2/authorize?response_type=token&amp;client_id=xxxxxxxxx&amp;redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&amp;state=file_requests_list!39%2B%2Bxxxxxxxx&amp;token_access_type=online&
That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account. That&rsquo;s cool except I thought I had chosen something like &lsquo;single folder access&rsquo; so I&rsquo;m slightly confused why I can see the other folders."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-12-09T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-09T00:00:00+00:00"><meta property="og:site_name" content="michal.piekarczyk.xyz"><meta name=twitter:card content="summary"><meta name=twitter:title content="Easy Blog Posting (&#34;My Noting Book&#34;)"><meta name=twitter:description content="For my EasyBlogPosting project.. Testing out the Dropbox API..
2020-12-09 trying this out Per here &mldr; pip install dropbox Went w/ that Getting Started page Through that page, I created a new test app for myself.
Using the API explorer &mldr; I hit Get Token ..
https://www.dropbox.com/oauth2/authorize?response_type=token&amp;client_id=xxxxxxxxx&amp;redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&amp;state=file_requests_list!39%2B%2Bxxxxxxxx&amp;token_access_type=online&
That generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account. That&rsquo;s cool except I thought I had chosen something like &lsquo;single folder access&rsquo; so I&rsquo;m slightly confused why I can see the other folders."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michal.piekarczyk.xyz/post/"},{"@type":"ListItem","position":2,"name":"Easy Blog Posting (\"My Noting Book\")","item":"https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Easy Blog Posting (\"My Noting Book\")","name":"Easy Blog Posting (\u0022My Noting Book\u0022)","description":"For my EasyBlogPosting project.. Testing out the Dropbox API..\n2020-12-09 trying this out Per here \u0026hellip; pip install dropbox Went w/ that Getting Started page Through that page, I created a new test app for myself.\nUsing the API explorer \u0026hellip; I hit Get Token ..\nhttps://www.dropbox.com/oauth2/authorize?response_type=token\u0026amp;client_id=xxxxxxxxx\u0026amp;redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F\u0026amp;state=file_requests_list!39%2B%2Bxxxxxxxx\u0026amp;token_access_type=online\u0026amp;\nThat generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account. That\u0026rsquo;s cool except I thought I had chosen something like \u0026lsquo;single folder access\u0026rsquo; so I\u0026rsquo;m slightly confused why I can see the other folders.","keywords":[],"articleBody":"For my EasyBlogPosting project.. Testing out the Dropbox API..\n2020-12-09 trying this out Per here … pip install dropbox Went w/ that Getting Started page Through that page, I created a new test app for myself.\nUsing the API explorer … I hit Get Token ..\nhttps://www.dropbox.com/oauth2/authorize?response_type=token\u0026client_id=xxxxxxxxx\u0026redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F\u0026state=file_requests_list!39%2B%2Bxxxxxxxx\u0026token_access_type=online\u0026\nThat generated a token and I used https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder and I was able to see actual folders in my account. That’s cool except I thought I had chosen something like ‘single folder access’ so I’m slightly confused why I can see the other folders. Maybe the generated token in the API explorer is separate and meant for testing. Hopefully it’s short lived. 2020-12-13 oh my special app folder was created w/ the acess token As soon as on my app page I hit “Generate access token” , my special App folder was created. import dropbox import os print(\"Initializing Dropbox API...\") dbx = dropbox.Dropbox(os.getenv('DBX_ACCESS_TOKEN')) result = dbx.files_list_folder(path=\"\") BadInputError: BadInputError('xxxxxxxxxxx', 'Error in call to API function \"files/list_folder\": Your app is not permitted to access this endpoint because it does not have the required scope \\'files.metadata.read\\'. The owner of the app can enable the scope for the app using the Permissions tab on the App Console.') Ah ok so I went to the Permissions tab, checked that ‘files.metadata.read’ box and tried again. Now seeing AuthError: AuthError('xxxxxxxxxxx', AuthError('missing_scope', TokenScopeError(required_scope='files.metadata.read'))) Ah according to stackoverflow , the scope cannot be retroactively granted to a token created before the scope was granted. Ok … trying to re-create a new token… Ok recreated. Retried. Worked! How to read? What’s the difference between the two files/download , files/export ( files/get_preview ) print(\"Initializing Dropbox API...\") dbx = dropbox.Dropbox(os.getenv('DBX_ACCESS_TOKEN')) meta, response = dbx.files_download('/blarg.txt') # In [22]: response.text # Out[22]: 'foo blarg\\n' Github interaction Hmm I was going down the path of building an AWS Batch container to commit to my git repo But hmmm I encountered that there may be a Github API which I can perhaps use??? And a nice tutorial Cool, so https://api.github.com/users/namoopsoo/repos , repos are here. However the oauth flow , looks kind of involved for a quick script But ah that’s right you can create a token for your account from here, Github settings . Ok cool I was able to perform a simple curl w/ the personal token I created for myself … ( per docs ) $ curl -v -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/users/namoopsoo/repos ok but can your write using this API is the big question.. Hmm according to here you can commit. post /repos/{owner}/{repo}/git/commits But not seeing how to include the actual diffs in there. Maybe a blob? Ok according to this nice article , indeed the blob endpoint is for files! hmm step 1, get a reference.. like here curl -v -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/ref/heads/master Nice excellent, …\n... ... { \"ref\": \"refs/heads/master\", \"node_id\": \"MDM6UmVmMTAwMTg1NjcwOnJlZnMvaGVhZHMvbWFzdGVy\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master\", \"object\": { \"sha\": \"482d52f53a146dd688eff4ed8093cf2980580662\", \"type\": \"commit\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662\" } } step 2 , Grab the commit that HEAD points to curl -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662 { \"sha\": \"482d52f53a146dd688eff4ed8093cf2980580662\", \"node_id\": \"MDY6Q29tbWl0MTAwMTg1NjcwOjQ4MmQ1MmY1M2ExNDZkZDY4OGVmZjRlZDgwOTNjZjI5ODA1ODA2NjI=\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662\", \"html_url\": \"https://github.com/namoopsoo/namoopsoo.github.io/commit/482d52f53a146dd688eff4ed8093cf2980580662\", \"author\": { \"name\": \"Michal Piekarczyk\", \"email\": \"namoopsoo\", \"date\": \"2020-12-13T21:39:11Z\" }, \"committer\": { \"name\": \"Michal Piekarczyk\", \"email\": \"namoopsoo\", \"date\": \"2020-12-13T21:39:11Z\" }, \"tree\": { \"sha\": \"e5a9ee9506a040a7cc8c608614db7531f8f32e70\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70\" }, \"message\": \"moar\", \"parents\": [ { \"sha\": \"13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc\", \"html_url\": \"https://github.com/namoopsoo/namoopsoo.github.io/commit/13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc\" } ], \"verification\": { \"verified\": false, \"reason\": \"unsigned\", \"signature\": null, \"payload\": null } } Ok and the tree sha is important. Reading up on this here Okay after taking a mini detour to understand what a Tree Object is, I think I can keep going now . So a Tree Object is a group of other objects ( blob and or tree objects). So continuing with this article , going to post a blob next 3. Post your new file to the server curl \\ -X POST \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs \\ -d '{\"content\": \"content of the blob\", \"encoding\": \"utf-8\"}' Getting\n{ \"message\": \"Not Found\", \"documentation_url\": \"https://docs.github.com/rest/reference/git#create-a-blob\" } Well Not Found is better than permission denied I guess.\nAh actually, .. I took a random guess and looking at https://github.com/settings/tokens indeed found I needed to just add some extra permissions. Tried that same curl -X POST again and now got back { \"sha\": \"6b2d785ecc7db8b71ee933a5b22961a52f40592c\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/6b2d785ecc7db8b71ee933a5b22961a52f40592c\" } So all good.\n4. Get a hold of the tree that the commit points to Ok so grabbing that e5a9ee9506a040a7cc8c608614db7531f8f32e70 tree of my target branch’s current HEAD commit now… ( and incidentally that jq json querying parsing utility is kind of nice here.. ) get /repos/{owner}/{repo}/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70 curl \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70 \\ | jq --color-output '.tree | .[0:3]' [ { \"path\": \".gitignore\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"f40fbd8ba564ea28e0a2501e2921909467b39887\", \"size\": 56, \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/f40fbd8ba564ea28e0a2501e2921909467b39887\" }, { \"path\": \"404.html\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"086a5c9ea988c5a4d37acc5f8ea089e37cb19371\", \"size\": 419, \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/086a5c9ea988c5a4d37acc5f8ea089e37cb19371\" }, { \"path\": \"CNAME\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"922c44a4850e7421585c9030ecd82face732adc6\", \"size\": 21, \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/922c44a4850e7421585c9030ecd82face732adc6\" } ] (pandars3) $ curl -H \"Accept: application/vnd.github.v3+json\" -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70 |jq --color-output '.tree | map(.type)' [ \"blob\", \"blob\", \"blob\", \"blob\", \"blob\", \"tree\", \"blob\", \"tree\", \"tree\", \"tree\", \"tree\", \"tree\", \"tree\", \"tree\", \"tree\", \"blob\", \"tree\", \"blob\", \"blob\", \"blob\", \"blob\", \"blob\", \"blob\", \"blob\", \"blob\" ] Also noticed the paths dont seem to be absolute paths .. I looked up the tree representing the directory _sass and got a relative path there inside.. [ { \"path\": \"main.scss\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"bc25e9ec345e7f25206a42139085669d4ad800b9\", \"size\": 29, \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/bc25e9ec345e7f25206a42139085669d4ad800b9\" } ] (pandars3) $ ls _s _sass/ _site/ (pandars3) $ ls _sass/ main.scss (pandars3) $ 5. Create a tree containing your new file Ok So I must create a new tree containing the newly created blob. I had actually committed a few commits in the meantime, so I just have to fetch the last trees commit again … # using the last commit ... bc74103c6c376a267f6f480e185fcb0c816d2f5b (pandars3) $ curl -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b { \"sha\": \"bc74103c6c376a267f6f480e185fcb0c816d2f5b\", \"node_id\": \"MDY6Q29tbWl0MTAwMTg1NjcwOmJjNzQxMDNjNmMzNzZhMjY3ZjZmNDgwZTE4NWZjYjBjODE2ZDJmNWI=\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b\", \"html_url\": \"https://github.com/namoopsoo/namoopsoo.github.io/commit/bc74103c6c376a267f6f480e185fcb0c816d2f5b\", \"author\": { \"name\": \"Michal Piekarczyk\", \"email\": \"namoopsoo\", \"date\": \"2020-12-14T00:47:00Z\" }, \"committer\": { \"name\": \"Michal Piekarczyk\", \"email\": \"namoopsoo\", \"date\": \"2020-12-14T00:47:00Z\" }, \"tree\": { \"sha\": \"e25ed95e0655cc209c8a3f9c61d18a182abd60d0\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e25ed95e0655cc209c8a3f9c61d18a182abd60d0\" }, \"message\": \"moar\", \"parents\": [ { \"sha\": \"c96842008683f25454793eccc3938cce1f605eb6\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/c96842008683f25454793eccc3938cce1f605eb6\", \"html_url\": \"https://github.com/namoopsoo/namoopsoo.github.io/commit/c96842008683f25454793eccc3938cce1f605eb6\" } ], \"verification\": { \"verified\": false, \"reason\": \"unsigned\", \"signature\": null, \"payload\": null } } ok now to create a new tree using e25ed95e0655cc209c8a3f9c61d18a182abd60d0 from above, as the base tree And the new blob I had created earlier… is 6b2d785ecc7db8b71ee933a5b22961a52f40592c post /repos/{owner}/{repo}/git/trees curl \\ -X POST \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees \\ -d '{\"base_tree\": \"e25ed95e0655cc209c8a3f9c61d18a182abd60d0\", \\ \"tree\": [ \\ { \\ \"path\": \"new_blob.txt\", \\ \"mode\": \"100644\", \\ \"type\": \"blob\", \\ \"sha\": \"6b2d785ecc7db8b71ee933a5b22961a52f40592c\" \\ } \\ ] \\ }' ok first try I got { \"message\": \"Problems parsing JSON\", \"documentation_url\": \"https://docs.github.com/rest/reference/git#create-a-tree\" } Ok tried without trying to break it up on multiple lines and this time somehow worked.. curl \\ -X POST \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees \\ -d '{\"base_tree\": \"e25ed95e0655cc209c8a3f9c61d18a182abd60d0\", \"tree\": [ { \"path\": \"new_blob.txt\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"6b2d785ecc7db8b71ee933a5b22961a52f40592c\" } ] }' { \"sha\": \"477075b08cae14b22534e7071b066d383696222c\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/477075b08cae14b22534e7071b066d383696222c\", \"tree\": [ { \"path\": \".gitignore\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"f40fbd8ba564ea28e0a2501e2921909467b39887\", \"size\": 56, \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/f40fbd8ba564ea28e0a2501e2921909467b39887\" }, ... ... { \"path\": \"new_blob.txt\", \"mode\": \"100644\", \"type\": \"blob\", \"sha\": \"6b2d785ecc7db8b71ee933a5b22961a52f40592c\", \"size\": 19, \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/6b2d785ecc7db8b71ee933a5b22961a52f40592c\" }, ... ] 6. Create a new commit The parent commit in this case… bc74103c6c376a267f6f480e185fcb0c816d2f5b And the 477075b08cae14b22534e7071b066d383696222c new tree created in last step… curl \\ -X POST \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits \\ -d ' { \"message\": \"my first commit using github api!\", \"parents\": [\"bc74103c6c376a267f6f480e185fcb0c816d2f5b\"], \"tree\": \"477075b08cae14b22534e7071b066d383696222c\" } ' As far as I can tell that created a commit .. 526dea236deed39d9a996187a6eb31c55137f675\n{ \"sha\": \"526dea236deed39d9a996187a6eb31c55137f675\", \"node_id\": \"MDY6Q29tbWl0MTAwMTg1NjcwOjUyNmRlYTIzNmRlZWQzOWQ5YTk5NjE4N2E2ZWIzMWM1NTEzN2Y2NzU=\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/526dea236deed39d9a996187a6eb31c55137f675\", \"html_url\": \"https://github.com/namoopsoo/namoopsoo.github.io/commit/526dea236deed39d9a996187a6eb31c55137f675\", \"author\": { \"name\": \"namoopsoo\", \"email\": \"namoopsoo@users.noreply.github.com\", \"date\": \"2020-12-14T01:28:09Z\" }, \"committer\": { \"name\": \"namoopsoo\", \"email\": \"namoopsoo@users.noreply.github.com\", \"date\": \"2020-12-14T01:28:09Z\" }, \"tree\": { \"sha\": \"477075b08cae14b22534e7071b066d383696222c\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/477075b08cae14b22534e7071b066d383696222c\" }, \"message\": \"my first commit using github api!\", \"parents\": [ { \"sha\": \"bc74103c6c376a267f6f480e185fcb0c816d2f5b\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b\", \"html_url\": \"https://github.com/namoopsoo/namoopsoo.github.io/commit/bc74103c6c376a267f6f480e185fcb0c816d2f5b\" } ], \"verification\": { \"verified\": false, \"reason\": \"unsigned\", \"signature\": null, \"payload\": null } } 7. Update HEAD patch /repos/{owner}/{repo}/git/refs/{ref} curl \\ -X PATCH \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/master/HEAD \\ -d '{\"sha\": \"526dea236deed39d9a996187a6eb31c55137f675\"} ' First stab I’m seeing\n{ \"message\": \"Reference does not exist\", \"documentation_url\": \"https://docs.github.com/rest/reference/git#update-a-reference\" } (Incidentally at this point I tried git fetch and didnt work. Also didnt see the new commit on the github.com through a browser either. ) Ok using a slightly different syntax.. curl \\ -X PATCH \\ -H \"Accept: application/vnd.github.v3+json\" \\ -H \"Authorization: token ${GITHUB_TOKEN}\" https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master \\ -d '{\"sha\": \"526dea236deed39d9a996187a6eb31c55137f675\"} ' { \"ref\": \"refs/heads/master\", \"node_id\": \"MDM6UmVmMTAwMTg1NjcwOnJlZnMvaGVhZHMvbWFzdGVy\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master\", \"object\": { \"sha\": \"526dea236deed39d9a996187a6eb31c55137f675\", \"type\": \"commit\", \"url\": \"https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/526dea236deed39d9a996187a6eb31c55137f675\" } } Nice and success..\n(pandars3) $ git log --graph --pretty=oneline --abbrev-commit --decorate --all * 526dea2 (origin/master) my first commit using github api! * bc74103 (HEAD -\u003e master) moar * c968420 moar I also checked that git log -p indeed showed only one change in that commit, a new file new_blob.txt with content of the blob\nNext That was pretty cool. Next I should like to combine the Dropbox + github Api parts to make a proof of concept, A Proof of concept that reads a new yaml file in that special dropbox application folder, runs something like the quick_post.py and publishes a new file through the github api. ","wordCount":"1540","inLanguage":"en","datePublished":"2020-12-09T00:00:00Z","dateModified":"2020-12-09T00:00:00Z","author":{"@type":"Person","name":"Michal Piekarczyk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://michal.piekarczyk.xyz/post/2020-12-09-dropbox-api-hmm/"},"publisher":{"@type":"Organization","name":"michal.piekarczyk.xyz","logo":{"@type":"ImageObject","url":"https://michal.piekarczyk.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michal.piekarczyk.xyz/ accesskey=h title="michal.piekarczyk.xyz (Alt + H)">michal.piekarczyk.xyz</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michal.piekarczyk.xyz/post/ title=posts><span>posts</span></a></li><li><a href=https://michal.piekarczyk.xyz/project/ title=projects><span>projects</span></a></li><li><a href=https://michal.piekarczyk.xyz/handy/ title=handy><span>handy</span></a></li><li><a href=https://michal.piekarczyk.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://michal.piekarczyk.xyz/about/ title=about><span>about</span></a></li><li><a href=https://world.hey.com/michal.piekarczyk title=frivolity><span>frivolity</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://michal.piekarczyk.xyz/>Home</a>&nbsp;»&nbsp;<a href=https://michal.piekarczyk.xyz/post/>Posts</a></div><h1 class=post-title>Easy Blog Posting ("My Noting Book")</h1><div class=post-meta><span title='2020-12-09 00:00:00 +0000 UTC'>9099-09-912</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1540 words&nbsp;·&nbsp;Michal Piekarczyk</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#for-my-easyblogposting-project>For my EasyBlogPosting project..</a></li><li><a href=#2020-12-09>2020-12-09</a></li><li><a href=#2020-12-13>2020-12-13</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h3 id=for-my-easyblogposting-project>For my EasyBlogPosting project..<a hidden class=anchor aria-hidden=true href=#for-my-easyblogposting-project>#</a></h3><p>Testing out the Dropbox API..</p><h3 id=2020-12-09>2020-12-09<a hidden class=anchor aria-hidden=true href=#2020-12-09>#</a></h3><h4 id=trying-this-out>trying this out<a hidden class=anchor aria-hidden=true href=#trying-this-out>#</a></h4><ul><li>Per <a href=https://www.dropbox.com/developers/reference/getting-started>here</a> &mldr;</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pip install dropbox
</span></span></code></pre></div><h4 id=went-w-that-getting-started-page>Went w/ that Getting Started page<a hidden class=anchor aria-hidden=true href=#went-w-that-getting-started-page>#</a></h4><ul><li><p>Through that page, I created a new test app for myself.</p></li><li><p>Using the API explorer &mldr; I hit Get Token ..</p></li></ul><p><a href="https://www.dropbox.com/oauth2/authorize?response_type=token&amp;client_id=xxxxxxxxx&amp;redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&amp;state=file_requests_list!39%2B%2Bxxxxxxxx&amp;token_access_type=online&">https://www.dropbox.com/oauth2/authorize?response_type=token&amp;client_id=xxxxxxxxx&amp;redirect_uri=https%3A%2F%2Fdropbox.github.io%2Fdropbox-api-v2-explorer%2F&amp;state=file_requests_list!39%2B%2Bxxxxxxxx&amp;token_access_type=online&</a></p><ul><li>That generated a token and I used <a href=https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder>https://dropbox.github.io/dropbox-api-v2-explorer/#files_list_folder</a> and I was able to see actual folders in my account.</li><li>That&rsquo;s cool except I thought I had chosen something like &lsquo;single folder access&rsquo; so I&rsquo;m slightly confused why I can see the other folders.</li><li>Maybe the generated token in the API explorer is separate and meant for testing. Hopefully it&rsquo;s short lived.</li></ul><h3 id=2020-12-13>2020-12-13<a hidden class=anchor aria-hidden=true href=#2020-12-13>#</a></h3><h4 id=oh-my-special-app-folder-was-created-w-the-acess-token>oh my special app folder was created w/ the acess token<a hidden class=anchor aria-hidden=true href=#oh-my-special-app-folder-was-created-w-the-acess-token>#</a></h4><ul><li>As soon as on my <a href=https://www.dropbox.com/developers/apps/info/blahblahblah>app page</a> I hit &ldquo;Generate access token&rdquo; , my special App folder was created.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> dropbox
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Initializing Dropbox API...&#34;</span>)
</span></span><span style=display:flex><span>dbx <span style=color:#f92672>=</span> dropbox<span style=color:#f92672>.</span>Dropbox(os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;DBX_ACCESS_TOKEN&#39;</span>))
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> dbx<span style=color:#f92672>.</span>files_list_folder(path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>BadInputError: BadInputError(<span style=color:#e6db74>&#39;xxxxxxxxxxx&#39;</span>, <span style=color:#e6db74>&#39;Error in call to API function &#34;files/list_folder&#34;: Your app is not permitted to access this endpoint because it does not have the required scope </span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>files.metadata.read</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>. The owner of the app can enable the scope for the app using the Permissions tab on the App Console.&#39;</span>)
</span></span></code></pre></div><ul><li>Ah ok so I went to the Permissions tab, checked that &lsquo;files.metadata.read&rsquo; box and tried again.</li><li>Now seeing</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>AuthError: AuthError(<span style=color:#e6db74>&#39;xxxxxxxxxxx&#39;</span>, AuthError(<span style=color:#e6db74>&#39;missing_scope&#39;</span>, TokenScopeError(required_scope<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;files.metadata.read&#39;</span>)))
</span></span></code></pre></div><ul><li>Ah according to <a href=https://stackoverflow.com/a/64201654>stackoverflow</a> , the scope cannot be retroactively granted to a token created before the scope was granted.</li><li>Ok &mldr; trying to re-create a new token&mldr;</li><li>Ok recreated. Retried. Worked!</li><li>How to read?</li><li>What&rsquo;s the difference between the two <code>files/download</code> , <code>files/export</code> ( <code>files/get_preview</code> )</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Initializing Dropbox API...&#34;</span>)
</span></span><span style=display:flex><span>dbx <span style=color:#f92672>=</span> dropbox<span style=color:#f92672>.</span>Dropbox(os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;DBX_ACCESS_TOKEN&#39;</span>))
</span></span><span style=display:flex><span>meta, response <span style=color:#f92672>=</span> dbx<span style=color:#f92672>.</span>files_download(<span style=color:#e6db74>&#39;/blarg.txt&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># In [22]: response.text                                                                                                                        </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Out[22]: &#39;foo blarg\n&#39;</span>
</span></span></code></pre></div><h4 id=github-interaction>Github interaction<a hidden class=anchor aria-hidden=true href=#github-interaction>#</a></h4><ul><li>Hmm I was going down the path of building an AWS Batch container to commit to my git repo</li><li>But hmmm I encountered that there may be a <a href=https://docs.github.com/en/free-pro-team@latest/rest>Github API</a> which I can perhaps use??? And a <a href=https://codesnippet.io/github-api-tutorial/>nice tutorial</a></li><li>Cool, so <code>https://api.github.com/users/namoopsoo/repos</code> , repos are here.</li><li>However <a href=https://docs.github.com/en/free-pro-team@latest/rest/overview/other-authentication-methods>the oauth flow</a> , looks kind of involved for a quick script</li><li>But ah that&rsquo;s right you can create a token for your account from here, <a href=https://github.com/settings/tokens/new>Github settings</a> .</li><li>Ok cool I was able to perform a simple curl w/ the personal token I created for myself &mldr; ( per <a href=https://docs.github.com/en/free-pro-team@latest/rest/overview/other-authentication-methods>docs</a> )</li></ul><pre tabindex=0><code>$ curl -v -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/users/namoopsoo/repos
</code></pre><h4 id=ok-but-can-your-write-using-this-api-is-the-big-question>ok but can your write using this API is the big question..<a hidden class=anchor aria-hidden=true href=#ok-but-can-your-write-using-this-api-is-the-big-question>#</a></h4><ul><li>Hmm according to <a href=https://docs.github.com/en/free-pro-team@latest/rest/reference/git#commits>here</a> you can commit.</li></ul><pre tabindex=0><code>post /repos/{owner}/{repo}/git/commits
</code></pre><ul><li>But not seeing how to include the actual diffs in there. Maybe a <a href=https://docs.github.com/en/free-pro-team@latest/rest/reference/git#blobs>blob?</a></li><li>Ok according to <a href=http://www.levibotelho.com/development/commit-a-file-with-the-github-api/>this nice article</a> , indeed the blob endpoint is for files! hmm</li></ul><h5 id=step-1-get-a-reference-like-herehttpsdevelopergithubcomv3gitrefsget-a-reference>step 1, get a reference.. like <a href=https://developer.github.com/v3/git/refs/#get-a-reference>here</a><a hidden class=anchor aria-hidden=true href=#step-1-get-a-reference-like-herehttpsdevelopergithubcomv3gitrefsget-a-reference>#</a></h5><pre tabindex=0><code>curl -v -H &#34;Authorization: token ${GITHUB_TOKEN}&#34;   https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/ref/heads/master
</code></pre><p>Nice excellent, &mldr;</p><pre tabindex=0><code>...
...
{
  &#34;ref&#34;: &#34;refs/heads/master&#34;,
  &#34;node_id&#34;: &#34;MDM6UmVmMTAwMTg1NjcwOnJlZnMvaGVhZHMvbWFzdGVy&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master&#34;,
  &#34;object&#34;: {
    &#34;sha&#34;: &#34;482d52f53a146dd688eff4ed8093cf2980580662&#34;,
    &#34;type&#34;: &#34;commit&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662&#34;
  }
}
</code></pre><h5 id=step-2--grab-the-commit-that-head-points-to>step 2 , Grab the commit that HEAD points to<a hidden class=anchor aria-hidden=true href=#step-2--grab-the-commit-that-head-points-to>#</a></h5><pre tabindex=0><code>curl -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662
</code></pre><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;482d52f53a146dd688eff4ed8093cf2980580662&#34;,
  &#34;node_id&#34;: &#34;MDY6Q29tbWl0MTAwMTg1NjcwOjQ4MmQ1MmY1M2ExNDZkZDY4OGVmZjRlZDgwOTNjZjI5ODA1ODA2NjI=&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/482d52f53a146dd688eff4ed8093cf2980580662&#34;,
  &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/482d52f53a146dd688eff4ed8093cf2980580662&#34;,
  &#34;author&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-13T21:39:11Z&#34;
  },
  &#34;committer&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-13T21:39:11Z&#34;
  },
  &#34;tree&#34;: {
    &#34;sha&#34;: &#34;e5a9ee9506a040a7cc8c608614db7531f8f32e70&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70&#34;
  },
  &#34;message&#34;: &#34;moar&#34;,
  &#34;parents&#34;: [
    {
      &#34;sha&#34;: &#34;13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc&#34;,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc&#34;,
      &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/13db6ee453ea2b05d09ed8da1b7baa87fbbdcebc&#34;
    }
  ],
  &#34;verification&#34;: {
    &#34;verified&#34;: false,
    &#34;reason&#34;: &#34;unsigned&#34;,
    &#34;signature&#34;: null,
    &#34;payload&#34;: null
  }
}
</code></pre><ul><li>Ok and the tree sha is important. Reading up on this <a href=https://git-scm.com/book/en/v2/Git-Internals-Git-Objects>here</a></li><li>Okay after taking a <a href=/2020/12/13/Article-GitInternalsGitObjects-notes.html>mini detour</a> to understand what a <em>Tree Object</em> is, I think I can keep going now .</li><li>So a <em>Tree Object</em> is a group of other objects ( blob and or tree objects).</li><li>So continuing with <a href=http://www.levibotelho.com/development/commit-a-file-with-the-github-api/>this article</a> , going to post a blob next</li></ul><h4 id=3-post-your-new-file-to-the-server>3. Post your new file to the server<a hidden class=anchor aria-hidden=true href=#3-post-your-new-file-to-the-server>#</a></h4><pre tabindex=0><code>curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs \
  -d &#39;{&#34;content&#34;: &#34;content of the blob&#34;, &#34;encoding&#34;: &#34;utf-8&#34;}&#39;
</code></pre><p>Getting</p><pre tabindex=0><code>{
  &#34;message&#34;: &#34;Not Found&#34;,
  &#34;documentation_url&#34;: &#34;https://docs.github.com/rest/reference/git#create-a-blob&#34;
}
</code></pre><p>Well Not Found is better than permission denied I guess.</p><ul><li>Ah actually, .. I took a random guess and looking at <a href=https://github.com/settings/tokens>https://github.com/settings/tokens</a> indeed found I needed to just add some extra permissions.</li><li>Tried that same <code>curl -X POST</code> again and now got back</li></ul><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;
}
</code></pre><p>So all good.</p><h4 id=4-get-a-hold-of-the-tree-that-the-commit-points-to>4. Get a hold of the tree that the commit points to<a hidden class=anchor aria-hidden=true href=#4-get-a-hold-of-the-tree-that-the-commit-points-to>#</a></h4><ul><li>Ok so grabbing that <code>e5a9ee9506a040a7cc8c608614db7531f8f32e70</code> tree of my target branch&rsquo;s current <code>HEAD</code> commit now&mldr;</li><li>( and incidentally that <code>jq</code> json querying parsing utility is kind of nice here.. )</li></ul><pre tabindex=0><code>get /repos/{owner}/{repo}/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70
curl \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70  \
  | jq --color-output &#39;.tree | .[0:3]&#39;
  [
    {
      &#34;path&#34;: &#34;.gitignore&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;f40fbd8ba564ea28e0a2501e2921909467b39887&#34;,
      &#34;size&#34;: 56,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/f40fbd8ba564ea28e0a2501e2921909467b39887&#34;
    },
    {
      &#34;path&#34;: &#34;404.html&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;086a5c9ea988c5a4d37acc5f8ea089e37cb19371&#34;,
      &#34;size&#34;: 419,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/086a5c9ea988c5a4d37acc5f8ea089e37cb19371&#34;
    },
    {
      &#34;path&#34;: &#34;CNAME&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;922c44a4850e7421585c9030ecd82face732adc6&#34;,
      &#34;size&#34;: 21,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/922c44a4850e7421585c9030ecd82face732adc6&#34;
    }
  ]
</code></pre><pre tabindex=0><code>(pandars3) $ curl   -H &#34;Accept: application/vnd.github.v3+json&#34;   -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e5a9ee9506a040a7cc8c608614db7531f8f32e70 |jq --color-output &#39;.tree | map(.type)&#39;
[
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;tree&#34;,
  &#34;blob&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;tree&#34;,
  &#34;blob&#34;,
  &#34;tree&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;,
  &#34;blob&#34;
]
</code></pre><ul><li>Also noticed the paths dont seem to be absolute paths ..</li><li>I looked up the tree representing the directory <code>_sass</code> and got a relative path there inside..</li></ul><pre tabindex=0><code>[
  {
    &#34;path&#34;: &#34;main.scss&#34;,
    &#34;mode&#34;: &#34;100644&#34;,
    &#34;type&#34;: &#34;blob&#34;,
    &#34;sha&#34;: &#34;bc25e9ec345e7f25206a42139085669d4ad800b9&#34;,
    &#34;size&#34;: 29,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/bc25e9ec345e7f25206a42139085669d4ad800b9&#34;
  }
]
(pandars3) $ ls _s
_sass/ _site/
(pandars3) $ ls _sass/
main.scss
(pandars3) $
</code></pre><h4 id=5-create-a-tree-containing-your-new-file>5. Create a tree containing your new file<a hidden class=anchor aria-hidden=true href=#5-create-a-tree-containing-your-new-file>#</a></h4><ul><li>Ok So I must create a new tree containing the newly created blob.</li><li>I had actually committed a few commits in the meantime, so I just have to fetch the last trees commit again &mldr;</li></ul><pre tabindex=0><code># using the last commit ... bc74103c6c376a267f6f480e185fcb0c816d2f5b

(pandars3) $ curl -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b
{
  &#34;sha&#34;: &#34;bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
  &#34;node_id&#34;: &#34;MDY6Q29tbWl0MTAwMTg1NjcwOmJjNzQxMDNjNmMzNzZhMjY3ZjZmNDgwZTE4NWZjYjBjODE2ZDJmNWI=&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
  &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
  &#34;author&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-14T00:47:00Z&#34;
  },
  &#34;committer&#34;: {
    &#34;name&#34;: &#34;Michal Piekarczyk&#34;,
    &#34;email&#34;: &#34;namoopsoo&#34;,
    &#34;date&#34;: &#34;2020-12-14T00:47:00Z&#34;
  },
  &#34;tree&#34;: {
    &#34;sha&#34;: &#34;e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;
  },
  &#34;message&#34;: &#34;moar&#34;,
  &#34;parents&#34;: [
    {
      &#34;sha&#34;: &#34;c96842008683f25454793eccc3938cce1f605eb6&#34;,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/c96842008683f25454793eccc3938cce1f605eb6&#34;,
      &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/c96842008683f25454793eccc3938cce1f605eb6&#34;
    }
  ],
  &#34;verification&#34;: {
    &#34;verified&#34;: false,
    &#34;reason&#34;: &#34;unsigned&#34;,
    &#34;signature&#34;: null,
    &#34;payload&#34;: null
  }
}
</code></pre><ul><li>ok now to create a new tree using <code>e25ed95e0655cc209c8a3f9c61d18a182abd60d0</code> from above, as the base tree</li><li>And the new blob I had created earlier&mldr; is <code>6b2d785ecc7db8b71ee933a5b22961a52f40592c</code></li></ul><pre tabindex=0><code>post /repos/{owner}/{repo}/git/trees

curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees \
  -d &#39;{&#34;base_tree&#34;: &#34;e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;, \
    &#34;tree&#34;: [ \
      { \
        &#34;path&#34;: &#34;new_blob.txt&#34;, \
        &#34;mode&#34;: &#34;100644&#34;, \
        &#34;type&#34;: &#34;blob&#34;, \
        &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34; \
      } \
    ] \
    }&#39;
</code></pre><ul><li>ok first try I got</li></ul><pre tabindex=0><code>{
  &#34;message&#34;: &#34;Problems parsing JSON&#34;,
  &#34;documentation_url&#34;: &#34;https://docs.github.com/rest/reference/git#create-a-tree&#34;
}
</code></pre><ul><li>Ok tried without trying to break it up on multiple lines and this time somehow worked..</li></ul><pre tabindex=0><code>curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees \
  -d &#39;{&#34;base_tree&#34;: &#34;e25ed95e0655cc209c8a3f9c61d18a182abd60d0&#34;, &#34;tree&#34;: [ { &#34;path&#34;: &#34;new_blob.txt&#34;, &#34;mode&#34;: &#34;100644&#34;, &#34;type&#34;: &#34;blob&#34;, &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34; } ] }&#39;
</code></pre><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;477075b08cae14b22534e7071b066d383696222c&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/477075b08cae14b22534e7071b066d383696222c&#34;,
  &#34;tree&#34;: [
    {
      &#34;path&#34;: &#34;.gitignore&#34;,
      &#34;mode&#34;: &#34;100644&#34;,
      &#34;type&#34;: &#34;blob&#34;,
      &#34;sha&#34;: &#34;f40fbd8ba564ea28e0a2501e2921909467b39887&#34;,
      &#34;size&#34;: 56,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/f40fbd8ba564ea28e0a2501e2921909467b39887&#34;
    },
...
...
{
  &#34;path&#34;: &#34;new_blob.txt&#34;,
  &#34;mode&#34;: &#34;100644&#34;,
  &#34;type&#34;: &#34;blob&#34;,
  &#34;sha&#34;: &#34;6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;,
  &#34;size&#34;: 19,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/blobs/6b2d785ecc7db8b71ee933a5b22961a52f40592c&#34;
},
...
]
</code></pre><h4 id=6-create-a-new-commit>6. Create a new commit<a hidden class=anchor aria-hidden=true href=#6-create-a-new-commit>#</a></h4><ul><li>The parent commit in this case&mldr; <code>bc74103c6c376a267f6f480e185fcb0c816d2f5b</code></li><li>And the <code>477075b08cae14b22534e7071b066d383696222c</code> new tree created in last step&mldr;</li></ul><pre tabindex=0><code>curl \
  -X POST \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits \
  -d  &#39; { &#34;message&#34;: &#34;my first commit using github api!&#34;, &#34;parents&#34;: [&#34;bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;], &#34;tree&#34;: &#34;477075b08cae14b22534e7071b066d383696222c&#34; } &#39;
</code></pre><p>As far as I can tell that created a commit .. <code>526dea236deed39d9a996187a6eb31c55137f675</code></p><pre tabindex=0><code>{
  &#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;,
  &#34;node_id&#34;: &#34;MDY6Q29tbWl0MTAwMTg1NjcwOjUyNmRlYTIzNmRlZWQzOWQ5YTk5NjE4N2E2ZWIzMWM1NTEzN2Y2NzU=&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/526dea236deed39d9a996187a6eb31c55137f675&#34;,
  &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/526dea236deed39d9a996187a6eb31c55137f675&#34;,
  &#34;author&#34;: {
    &#34;name&#34;: &#34;namoopsoo&#34;,
    &#34;email&#34;: &#34;namoopsoo@users.noreply.github.com&#34;,
    &#34;date&#34;: &#34;2020-12-14T01:28:09Z&#34;
  },
  &#34;committer&#34;: {
    &#34;name&#34;: &#34;namoopsoo&#34;,
    &#34;email&#34;: &#34;namoopsoo@users.noreply.github.com&#34;,
    &#34;date&#34;: &#34;2020-12-14T01:28:09Z&#34;
  },
  &#34;tree&#34;: {
    &#34;sha&#34;: &#34;477075b08cae14b22534e7071b066d383696222c&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/trees/477075b08cae14b22534e7071b066d383696222c&#34;
  },
  &#34;message&#34;: &#34;my first commit using github api!&#34;,
  &#34;parents&#34;: [
    {
      &#34;sha&#34;: &#34;bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
      &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;,
      &#34;html_url&#34;: &#34;https://github.com/namoopsoo/namoopsoo.github.io/commit/bc74103c6c376a267f6f480e185fcb0c816d2f5b&#34;
    }
  ],
  &#34;verification&#34;: {
    &#34;verified&#34;: false,
    &#34;reason&#34;: &#34;unsigned&#34;,
    &#34;signature&#34;: null,
    &#34;payload&#34;: null
  }
}
</code></pre><h4 id=7-update-head>7. Update HEAD<a hidden class=anchor aria-hidden=true href=#7-update-head>#</a></h4><pre tabindex=0><code>patch /repos/{owner}/{repo}/git/refs/{ref}
curl \
  -X PATCH \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/master/HEAD \
  -d  &#39;{&#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;} &#39;
</code></pre><p>First stab I&rsquo;m seeing</p><pre tabindex=0><code>{
  &#34;message&#34;: &#34;Reference does not exist&#34;,
  &#34;documentation_url&#34;: &#34;https://docs.github.com/rest/reference/git#update-a-reference&#34;
}
</code></pre><ul><li>(Incidentally at this point I tried <code>git fetch</code> and didnt work. Also didnt see the new commit on the github.com through a browser either. )</li><li>Ok using a slightly different syntax..</li></ul><pre tabindex=0><code>curl \
  -X PATCH \
  -H &#34;Accept: application/vnd.github.v3+json&#34; \
  -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master \
  -d  &#39;{&#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;} &#39;
</code></pre><pre tabindex=0><code>{
  &#34;ref&#34;: &#34;refs/heads/master&#34;,
  &#34;node_id&#34;: &#34;MDM6UmVmMTAwMTg1NjcwOnJlZnMvaGVhZHMvbWFzdGVy&#34;,
  &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/refs/heads/master&#34;,
  &#34;object&#34;: {
    &#34;sha&#34;: &#34;526dea236deed39d9a996187a6eb31c55137f675&#34;,
    &#34;type&#34;: &#34;commit&#34;,
    &#34;url&#34;: &#34;https://api.github.com/repos/namoopsoo/namoopsoo.github.io/git/commits/526dea236deed39d9a996187a6eb31c55137f675&#34;
  }
}
</code></pre><p>Nice and success..</p><pre tabindex=0><code>(pandars3) $ git log  --graph --pretty=oneline --abbrev-commit --decorate  --all
* 526dea2 (origin/master) my first commit using github api!
* bc74103 (HEAD -&gt; master) moar
* c968420 moar
</code></pre><p>I also checked that <code>git log -p</code> indeed showed only one change in that commit, a new file <code>new_blob.txt</code> with <code>content of the blob</code></p><h4 id=next>Next<a hidden class=anchor aria-hidden=true href=#next>#</a></h4><ul><li>That was pretty cool. Next I should like to combine the Dropbox + github Api parts to make a proof of concept,</li><li>A Proof of concept that reads a new yaml file in that special dropbox application folder, runs something like the <code>quick_post.py</code> and publishes a new file through the github api.</li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://michal.piekarczyk.xyz/post/2020-12-13-article-gitinternalsgitobjects-notes/><span class=title>« Prev</span><br><span>notes on Git Internals Git Objects article</span></a>
<a class=next href=https://michal.piekarczyk.xyz/post/2020-11-22-deepspeech/><span class=title>Next »</span><br><span>Quick test drive this Mozilla/Baidu Deep Speech</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://michal.piekarczyk.xyz/>michal.piekarczyk.xyz</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>