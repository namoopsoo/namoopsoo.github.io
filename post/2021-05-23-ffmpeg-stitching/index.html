<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>some ffmpeg stitching | michal.piekarczyk.xyz</title><meta name=keywords content><meta name=description content="using ffmpeg to stitch together some images into a slide show"><meta name=author content="Michal Piekarczyk"><link rel=canonical href=https://michal.piekarczyk.xyz/post/2021-05-23-ffmpeg-stitching/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michal.piekarczyk.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michal.piekarczyk.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michal.piekarczyk.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://michal.piekarczyk.xyz/apple-touch-icon.png><link rel=mask-icon href=https://michal.piekarczyk.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-86TSXEXWB5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-86TSXEXWB5",{anonymize_ip:!1})}</script><meta property="og:title" content="some ffmpeg stitching"><meta property="og:description" content="using ffmpeg to stitch together some images into a slide show"><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2021-05-23-ffmpeg-stitching/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-23T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-23T00:00:00+00:00"><meta property="og:site_name" content="michal.piekarczyk.xyz"><meta name=twitter:card content="summary"><meta name=twitter:title content="some ffmpeg stitching"><meta name=twitter:description content="using ffmpeg to stitch together some images into a slide show"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michal.piekarczyk.xyz/post/"},{"@type":"ListItem","position":2,"name":"some ffmpeg stitching","item":"https://michal.piekarczyk.xyz/post/2021-05-23-ffmpeg-stitching/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"some ffmpeg stitching","name":"some ffmpeg stitching","description":"using ffmpeg to stitch together some images into a slide show","keywords":[],"articleBody":" Trying Per here tried ffmpeg -i image%03d.jpeg -sameq -r 25 outmovie.mp4 But getting Option 'sameq' was removed. If you are looking for an option to preserve the quality (which is not what -sameq was for), use -qscale 0 or an equivalent quality factor option. Failed to set value '1' for option 'sameq': Invalid argument ffmpeg -framerate 24 -i img%03d.png output.mp4 To glob… ffmpeg -framerate 24 -pattern_type glob -i '*.jpg' -c:v libx264 -pix_fmt yuv420p out.mp4 That kind of did the trick, but kind of fast. only lasted 2 seconds.. Per the “Additional Info: Frame rates” section in https://trac.ffmpeg.org/wiki/Slideshow , ffmpeg -framerate 1/3 -pattern_type glob -i '2021-05-19 09.0*.jpg' -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.mp4 Wow nice that was perfect , so 1/3 indeed sets the duration at 3 seconds per image…\nGoing to try again with 0.75 seconds so\nffmpeg -framerate 4/3 -pattern_type glob -i '2021-05-19 09.0*.jpg' -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.mp4 Okay that was about perfect I think. Only thing is my images are rotated still, so think I got to rotate them first .. ffmpeg -framerate 4/3 -pattern_type glob -i '*R.jpg' -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.mini.mp4 Wow very weird, but “turns out” hehe , all I had to do was rotate the image 360 degrees and it still managed to get modified and then the mp4 orientation ended up being correct finally.\nHopefully image magick has the same effect? ( per here )\nconvert -rotate \"360\" \"2021-05-19 09.02.15.jpg\" \"2021-05-19 09.02.15.R360.jpg\" $ md5 \"2021-05-19 09.02.15.jpg\" \"2021-05-19 09.02.15.R360.jpg\" MD5 (2021-05-19 09.02.15.jpg) = 63efd132e1c609672f260c0af1c84058 MD5 (2021-05-19 09.02.15.R360.jpg) = 08c2a4716cb90e8d53a0bde0d3d0a397 Wow something definitely happened here hmm. Try a few more and reproduce.. convert -rotate \"360\" \"2021-05-19 09.02.24.jpg\" \"2021-05-19 09.02.24.R360.jpg\" convert -rotate \"360\" \"2021-05-19 09.02.32.jpg\" \"2021-05-19 09.02.32.R360.jpg\" And try on just the image magick images.. ffmpeg -framerate 4/3 -pattern_type glob -i '*R360.jpg' -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.mini4.mp4 Hmm dang the output out.slower.three_quarters.mini4.mp4 is still rotated.\nMaybe image magick is doing some pure math rotation, but perhaps using the “Preview” app to do the rotation resets some kind of EXIF rotation setting.\nSo I tried looking at one of the original images and I’m getting\nidentify -format '%[EXIF:*]' \"2021-05-19 09.02.40.jpg\" | grep Orientation exif:Orientation=6 Which according to this , 6 means “upper right” The orientation of the camera relative to the scene, when the image was captured. The start point of stored data is, ‘1’ means upper left, ‘3’ lower right, ‘6’ upper right, ‘8’ lower left, ‘9’ undefined.\nNot really sure what that means but one of the images which I rotated manually with “Preview” … identify -format '%[EXIF:*]' \"2021-05-19 09.01.12R.jpg\"|grep Orientation exif:Orientation=1 Bingo. So if I can modify this tag on these images from 6 to 1 that might work. Oh wow a stack overflow search on simply “modifying exif data with image magick” brought up this answer which is specifically about the orientation . Haha So the suggestion is to use mogrify And this other use of identify gives the human readable value instead identify -verbose \"2021-05-19 09.01.12R.jpg\"|grep Orientation Orientation: TopLeft Ok going to just try to use the glob approach file=\"2021-05-19 09.02.40.jpg\" echo \"before\" $(identify -verbose $file|grep Orientation) mogrify -orient \"left-top\" \"2021-05-19 09.02.40.jpg\" echo \"after\" $(identify -verbose $file|grep Orientation) # output.. before Orientation: RightTop after Orientation: LeftTop Ok cool.. mogrify -orient \"left-top\" *.jpg Ok try ffmpeg again … ffmpeg -framerate 4/3 -pattern_type glob -i '*.jpg' -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.full.mp4 ","wordCount":"567","inLanguage":"en","datePublished":"2021-05-23T00:00:00Z","dateModified":"2021-05-23T00:00:00Z","author":{"@type":"Person","name":"Michal Piekarczyk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://michal.piekarczyk.xyz/post/2021-05-23-ffmpeg-stitching/"},"publisher":{"@type":"Organization","name":"michal.piekarczyk.xyz","logo":{"@type":"ImageObject","url":"https://michal.piekarczyk.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michal.piekarczyk.xyz/ accesskey=h title="michal.piekarczyk.xyz (Alt + H)">michal.piekarczyk.xyz</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michal.piekarczyk.xyz/post/ title=posts><span>posts</span></a></li><li><a href=https://michal.piekarczyk.xyz/project/ title=projects><span>projects</span></a></li><li><a href=https://michal.piekarczyk.xyz/handy/ title=handy><span>handy</span></a></li><li><a href=https://michal.piekarczyk.xyz/tags/ title=tags><span>tags</span></a></li><li><a href=https://michal.piekarczyk.xyz/about/ title=about><span>about</span></a></li><li><a href=https://world.hey.com/michal.piekarczyk title=frivolity><span>frivolity</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://michal.piekarczyk.xyz/>Home</a>&nbsp;»&nbsp;<a href=https://michal.piekarczyk.xyz/post/>Posts</a></div><h1 class=post-title>some ffmpeg stitching</h1><div class=post-meta><span title='2021-05-23 00:00:00 +0000 UTC'>232323-23-2312</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;567 words&nbsp;·&nbsp;Michal Piekarczyk</div></header><div class=post-content><h4 id=trying>Trying<a hidden class=anchor aria-hidden=true href=#trying>#</a></h4><ul><li>Per <a href=http://tooloftrade.blogspot.com/2011/10/merging-images-into-movie-using-ffmpeg.html>here</a> tried</li></ul><pre tabindex=0><code> ffmpeg -i image%03d.jpeg -sameq -r 25 outmovie.mp4
</code></pre><ul><li>But getting</li></ul><pre tabindex=0><code>Option &#39;sameq&#39; was removed. If you are looking for an option to preserve the quality (which is not what -sameq was for), use -qscale 0 or an equivalent quality factor option.
Failed to set value &#39;1&#39; for option &#39;sameq&#39;: Invalid argument
</code></pre><ul><li></li></ul><pre tabindex=0><code>ffmpeg -framerate 24 -i img%03d.png output.mp4
</code></pre><ul><li>To glob&mldr;</li></ul><pre tabindex=0><code>ffmpeg -framerate 24 -pattern_type glob -i &#39;*.jpg&#39; -c:v libx264 -pix_fmt yuv420p out.mp4
</code></pre><ul><li>That kind of did the trick, but kind of fast. only lasted 2 seconds..</li><li>Per the &ldquo;Additional Info: Frame rates&rdquo; section in <a href=https://trac.ffmpeg.org/wiki/Slideshow>https://trac.ffmpeg.org/wiki/Slideshow</a> ,</li></ul><pre tabindex=0><code>ffmpeg -framerate 1/3 -pattern_type glob -i &#39;2021-05-19 09.0*.jpg&#39; -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.mp4
</code></pre><ul><li><p>Wow nice that was perfect , so <code>1/3</code> indeed sets the duration at <code>3 seconds</code> per image&mldr;</p></li><li><p>Going to try again with <code>0.75 seconds</code> so</p></li></ul><pre tabindex=0><code>ffmpeg -framerate 4/3 -pattern_type glob -i &#39;2021-05-19 09.0*.jpg&#39; -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.mp4
</code></pre><ul><li>Okay that was about perfect I think.</li><li>Only thing is my images are rotated still, so think I got to rotate them first ..</li></ul><pre tabindex=0><code>ffmpeg -framerate 4/3 -pattern_type glob -i &#39;*R.jpg&#39; -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.mini.mp4
</code></pre><ul><li><p>Wow very weird, but &ldquo;turns out&rdquo; hehe , all I had to do was rotate the image 360 degrees and it still managed to get modified and then the <code>mp4</code> orientation ended up being correct finally.</p></li><li><p>Hopefully image magick has the same effect? ( per <a href=https://codeyarns.com/tech/2016-07-05-how-to-rotate-image-using-imagemagick.html>here</a> )</p></li></ul><pre tabindex=0><code>convert -rotate &#34;360&#34; &#34;2021-05-19 09.02.15.jpg&#34;   &#34;2021-05-19 09.02.15.R360.jpg&#34;

$ md5 &#34;2021-05-19 09.02.15.jpg&#34;   &#34;2021-05-19 09.02.15.R360.jpg&#34;
MD5 (2021-05-19 09.02.15.jpg) = 63efd132e1c609672f260c0af1c84058
MD5 (2021-05-19 09.02.15.R360.jpg) = 08c2a4716cb90e8d53a0bde0d3d0a397
</code></pre><ul><li>Wow something definitely happened here hmm.</li><li>Try a few more and reproduce..</li></ul><pre tabindex=0><code>convert -rotate &#34;360&#34; &#34;2021-05-19 09.02.24.jpg&#34; &#34;2021-05-19 09.02.24.R360.jpg&#34;
convert -rotate &#34;360&#34; &#34;2021-05-19 09.02.32.jpg&#34; &#34;2021-05-19 09.02.32.R360.jpg&#34;
</code></pre><ul><li>And try on just the image magick images..</li></ul><pre tabindex=0><code>ffmpeg -framerate 4/3 -pattern_type glob -i &#39;*R360.jpg&#39; -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.mini4.mp4
</code></pre><ul><li><p>Hmm dang the output <code>out.slower.three_quarters.mini4.mp4</code> is still rotated.</p></li><li><p>Maybe image magick is doing some pure math rotation, but perhaps using the &ldquo;Preview&rdquo; app to do the rotation resets some kind of EXIF rotation setting.</p></li><li><p>So I tried looking at one of the original images and I&rsquo;m getting</p></li></ul><pre tabindex=0><code>identify -format &#39;%[EXIF:*]&#39; &#34;2021-05-19 09.02.40.jpg&#34; | grep Orientation
exif:Orientation=6
</code></pre><ul><li>Which according to <a href=https://www.media.mit.edu/pia/Research/deepview/exif.html>this</a> , <code>6</code> means &ldquo;upper right&rdquo;</li></ul><blockquote><p>The orientation of the camera relative to the scene, when the image was captured. The start point of stored data is, &lsquo;1&rsquo; means upper left, &lsquo;3&rsquo; lower right, &lsquo;6&rsquo; upper right, &lsquo;8&rsquo; lower left, &lsquo;9&rsquo; undefined.</p></blockquote><ul><li>Not really sure what that means but one of the images which I rotated manually with &ldquo;Preview&rdquo; &mldr;</li></ul><pre tabindex=0><code>identify -format &#39;%[EXIF:*]&#39;  &#34;2021-05-19 09.01.12R.jpg&#34;|grep Orientation
exif:Orientation=1
</code></pre><ul><li>Bingo. So if I can modify this tag on these images from <code>6</code> to <code>1</code> that might work.</li><li>Oh wow a stack overflow search on simply &ldquo;modifying exif data with image magick&rdquo; brought up <a href=https://stackoverflow.com/questions/40606464/setting-image-orientation-exif-data-using-imagemagick#40804379>this answer</a> which is specifically about the orientation . Haha</li><li>So the suggestion is to use <code>mogrify</code></li><li>And this other use of <code>identify</code> gives the human readable value instead</li></ul><pre tabindex=0><code>identify -verbose &#34;2021-05-19 09.01.12R.jpg&#34;|grep Orientation
  Orientation: TopLeft
</code></pre><ul><li>Ok going to just try to use the glob approach</li></ul><pre tabindex=0><code>file=&#34;2021-05-19 09.02.40.jpg&#34;
echo &#34;before&#34; $(identify -verbose $file|grep Orientation)
mogrify -orient &#34;left-top&#34;  &#34;2021-05-19 09.02.40.jpg&#34;
echo &#34;after&#34; $(identify -verbose $file|grep Orientation)

# output..
before   Orientation: RightTop
after   Orientation: LeftTop
</code></pre><ul><li>Ok cool..</li></ul><pre tabindex=0><code>mogrify -orient &#34;left-top&#34;  *.jpg
</code></pre><h4 id=ok-try-ffmpeg-again->Ok try ffmpeg again &mldr;<a hidden class=anchor aria-hidden=true href=#ok-try-ffmpeg-again->#</a></h4><pre tabindex=0><code>ffmpeg -framerate 4/3 -pattern_type glob -i &#39;*.jpg&#39; -c:v libx264 -r 30 -pix_fmt yuv420p out.slower.three_quarters.full.mp4
</code></pre></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://michal.piekarczyk.xyz/post/2021-05-07-covid-vaccine-2-temps/><span class=title>« Prev</span><br><span>Covid Vaccine 2 Temperatures</span></a>
<a class=next href=https://michal.piekarczyk.xyz/post/2021-05-16-hugo-notes/><span class=title>Next »</span><br><span>Notes on hugo</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://michal.piekarczyk.xyz/>michal.piekarczyk.xyz</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>