<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Dockerizing Daniel Bourke's Food Not Food | michal.piekarczyk.xyz</title>
<meta name=keywords content="docker,tensorflow"><meta name=description content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."><meta name=author content="Michal Piekarczyk"><link rel=canonical href=https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/><link crossorigin=anonymous href=/assets/css/stylesheet.dd867d536fb6202811c1ee15fa181ef8945826662b49d3016ac91365a2621d58.css integrity="sha256-3YZ9U2+2ICgRwe4V+hge+JRYJmYrSdMBaskTZaJiHVg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://michal.piekarczyk.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michal.piekarczyk.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michal.piekarczyk.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://michal.piekarczyk.xyz/apple-touch-icon.png><link rel=mask-icon href=https://michal.piekarczyk.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-74MK08REDT"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74MK08REDT",{anonymize_ip:!1})}</script><meta property="og:title" content="Dockerizing Daniel Bourke's Food Not Food"><meta property="og:description" content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-26T18:33:54-05:00"><meta property="og:site_name" content="michal.piekarczyk.xyz"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dockerizing Daniel Bourke's Food Not Food"><meta name=twitter:description content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michal.piekarczyk.xyz/post/"},{"@type":"ListItem","position":2,"name":"Dockerizing Daniel Bourke's Food Not Food","item":"https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Dockerizing Daniel Bourke's Food Not Food","name":"Dockerizing Daniel Bourke\u0027s Food Not Food","description":"I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)\nBut I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke\u0026rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .\nThis was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github.","keywords":["docker","tensorflow"],"articleBody":"I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)\nBut I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke’s Food Not Food repo, https://github.com/mrdbourke/food-not-food .\nThis was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github.com/namoopsoo/food-not-food and added a Dockerfile to make this easier. Also putting this into docker eventually helped me to batch process photos as well. I can link to a separate post on that as well.\nMy stream of consciousness notes! 14:02 continue with [[my photo system]] [[import my photos to icloud photos 2022-Oct]] 14:12 I am also using a pytorch repo for photo deduping.\n14:22 Ok I took a snapshot dedupe-requirements-snapshot-2022-11-12.txt of what I have in my dedupe pip environment and looks like actually the #deduping-images library I use , uses #PyTorch and the [[Daniel Bourke Food not Food]] uses #TensorFlow , so likely will not clash .\n14:28 ok I cloned the repo and running the pip install -r requirements.txt\nStumbling on dependency resolution bottlenecks with several packages, tensorflow-metadata , tabulate , INFO: pip is looking at multiple versions of tabulate to determine which version is compatible with other requirements. This could take a while. ... INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. If you want to abort this run, you can press Ctrl + C to do so. To improve how pip performs, tell us what happened here: https://pip.pypa.io/surveys/backtracking ... INFO: pip is looking at multiple versions of sortedcontainers to determine which version is compatible with other requirements. This could take a while. INFO: pip is looking at multiple versions of tifffile to determine which version is compatible with other requirements. This could take a while. Collecting tifffile\u003e=2019.7.26 Downloading tifffile-2022.8.12-py3-none-any.whl (208 kB) |████████████████████████████████| 208 kB 15.6 MB/s Downloading tifffile-2022.8.8-py3-none-any.whl (208 kB) 14:56 yea had to cancel, that wasn’t going anywhere .\nLet me try conda instead,\nconda create -n foodnot conda activate foodnot (foodnot) $ conda install matplotlib numpy pandas requests scikit-learn tensorflow tflite-model-maker tqdm # fiftyone # Hmm cannot find tflite-model-maker conda install matplotlib numpy pandas requests scikit-learn tensorflow tqdm # fiftyone Ok well that worked but now since cannot find tflite-model-maker with conda, trying with pip ,\npip install tflite-model-maker and it is a mess again! Just some kind of hell this installation just looks like a whole lot of this ,\nDownloading tf_nightly-2.12.0.dev20221104-cp310-cp310-macosx_10_14_x86_64.whl (221.5 MB) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 221.5/221.5 MB 3.3 MB/s eta 0:00:00 Downloading tf_nightly-2.12.0.dev20221103-cp310-cp310-macosx_10_14_x86_64.whl (221.5 MB) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 221.5/221.5 MB 7.3 MB/s eta 0:00:00 Downloading tf_nightly-2.12.0.dev20221102-cp310-cp310-macosx_10_14_x86_64.whl (221.7 MB) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 221.7/221.7 MB 4.1 MB/s eta 0:00:00 Downloading tf_nightly-2.12.0.dev20221101-cp310-cp310-macosx_10_14_x86_64.whl (221.7 MB) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 221.7/221.7 MB 3.4 MB/s eta 0:00:00 Downloading tf_nightly-2.12.0.dev20221031-cp310-cp310-macosx_10_14_x86_64.whl (222.4 MB) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 222.4/222.4 MB 3.4 MB/s eta 0:00:00 Downloading tf_nightly-2.12.0.dev20221030-cp310-cp310-macosx_10_14_x86_64.whl (222.4 MB) 15:21 ok let me try #Docker .\n15:35 ok from , https://www.tensorflow.org/install/docker ,\n(foodnot) $ docker -v Docker version 20.10.21, build baeda1f (foodnot) $ docker pull tensorflow/tensorflow ... (foodnot) $ docker run -it --rm tensorflow/tensorflow python -c \"import tensorflow as tf; print(tf.reduce_sum(tf.random.normal([1000, 1000])))\" 2022-11-12 20:37:15.606702: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations: AVX2 FMA To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. 2022-11-12 20:37:17.349502: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations: AVX2 FMA To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. tf.Tensor(-1153.0294, shape=(), dtype=float32) ok cool so now let me try to apply the [[Daniel Bourke Food not Food]] requirements?\n15:39 ok let me see from the typical build can I install tflite-model-maker ?\ndocker run -it tensorflow/tensorflow bash ________ _______________ ___ __/__________________________________ ____/__ /________ __ __ / _ _ \\_ __ \\_ ___/ __ \\_ ___/_ /_ __ /_ __ \\_ | /| / / _ / / __/ / / /(__ )/ /_/ / / _ __/ _ / / /_/ /_ |/ |/ / /_/ \\___//_/ /_//____/ \\____//_/ /_/ /_/ \\____/____/|__/ WARNING: You are running this container as root, which can cause new files in mounted volumes to be created as the root user on your host machine. To avoid this, run the container by specifying your user's userid: $ docker run -u $(id -u):$(id -g) args... root@566168cfbe3e:/# which pip /usr/local/bin/pip root@566168cfbe3e:/# pip freeze absl-py==1.2.0 astunparse==1.6.3 cachetools==5.2.0 certifi==2022.6.15 charset-normalizer==2.1.1 flatbuffers==2.0.7 gast==0.4.0 google-auth==2.11.0 google-auth-oauthlib==0.4.6 google-pasta==0.2.0 grpcio==1.48.1 h5py==3.7.0 idna==3.3 importlib-metadata==4.12.0 keras==2.10.0 Keras-Preprocessing==1.1.2 libclang==14.0.6 Markdown==3.4.1 MarkupSafe==2.1.1 numpy==1.23.2 oauthlib==3.2.0 opt-einsum==3.3.0 packaging==21.3 protobuf==3.19.4 pyasn1==0.4.8 pyasn1-modules==0.2.8 pyparsing==3.0.9 requests==2.28.1 requests-oauthlib==1.3.1 rsa==4.9 six==1.16.0 tensorboard==2.10.0 tensorboard-data-server==0.6.1 tensorboard-plugin-wit==1.8.1 tensorflow-cpu==2.10.0 tensorflow-estimator==2.10.0 tensorflow-io-gcs-filesystem==0.26.0 termcolor==1.1.0 typing-extensions==4.3.0 urllib3==1.26.12 Werkzeug==2.2.2 wrapt==1.14.1 zipp==3.8.1 root@566168cfbe3e:/# pip install tflite-model-maker Collecting tflite-model-maker Downloading tflite_model_maker-0.4.2-py3-none-any.whl (577 kB) |████████████████████████████████| 577 kB 1.2 MB/s ... ... ... Successfully built fire promise kaggle audioread Installing collected packages: pillow, PyYAML, packaging, tensorflow-hub, tensorflow, tensorflowjs, typeguard, tensorflow-addons, scann, dm-tree, tensorflow-model-optimization, lxml, kiwisolver, python-dateutil, cycler, matplotlib, llvmlite, numba, importlib-resources, toml, dill, etils, tqdm, googleapis-common-protos, tensorflow-metadata, promise, tensorflow-datasets, opencv-python-headless, Cython, tf-slim, proto-plus, pyarrow, grpcio-status, google-api-core, google-cloud-bigquery-storage, google-cloud-core, google-crc32c, google-resumable-media, google-cloud-bigquery, psutil, py-cpuinfo, httplib2, uritemplate, google-auth-httplib2, google-api-python-client, dataclasses, gin-config, sentencepiece, scipy, text-unidecode, python-slugify, urllib3, kaggle, pytz, pandas, tf-models-official, fire, pycparser, CFFI, sounddevice, pybind11, tflite-support, attrs, neural-structured-learning, appdirs, pooch, joblib, threadpoolctl, scikit-learn, soundfile, resampy, audioread, decorator, librosa, tflite-model-maker Attempting uninstall: packaging Found existing installation: packaging 21.3 Uninstalling packaging-21.3: Successfully uninstalled packaging-21.3 ... ERROR: After October 2020 you may experience errors when installing or updating packages. This is because pip will change the way that it resolves dependency conflicts. We recommend you use --use-feature=2020-resolver to test your packages with the new resolver before it becomes the default. scann 1.2.6 requires tensorflow~=2.8.0, but you'll have tensorflow 2.10.0 which is incompatible. grpcio-status 1.50.0 requires grpcio\u003e=1.50.0, but you'll have grpcio 1.48.1 which is incompatible. grpcio-status 1.50.0 requires protobuf\u003e=4.21.6, but you'll have protobuf 3.19.4 which is incompatible. google-api-core 2.10.2 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,\u003c5.0.0dev,\u003e=3.19.5, but you'll have protobuf 3.19.4 which is incompatible. google-cloud-bigquery-storage 2.16.2 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,\u003c5.0.0dev,\u003e=3.19.5, but you'll have protobuf 3.19.4 which is incompatible. google-cloud-bigquery 3.3.6 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,\u003c5.0.0dev,\u003e=3.19.5, but you'll have protobuf 3.19.4 which is incompatible. Successfully installed CFFI-1.15.1 Cython-0.29.32 PyYAML-6.0 appdirs-1.4.4 attrs-22.1.0 audioread-3.0.0 cycler-0.11.0 dataclasses-0.6 decorator-5.1.1 dill-0.3.6 dm-tree-0.1.7 etils-0.9.0 fire-0.4.0 gin-config-0.5.0 google-api-core-2.10.2 google-api-python-client-2.65.0 google-auth-httplib2-0.1.0 google-cloud-bigquery-3.3.6 google-cloud-bigquery-storage-2.16.2 google-cloud-core-2.3.2 google-crc32c-1.5.0 google-resumable-media-2.4.0 googleapis-common-protos-1.56.4 grpcio-status-1.50.0 httplib2-0.21.0 importlib-resources-5.10.0 joblib-1.2.0 kaggle-1.5.12 kiwisolver-1.4.4 librosa-0.8.1 llvmlite-0.36.0 lxml-4.9.1 matplotlib-3.4.3 neural-structured-learning-1.4.0 numba-0.53.0 opencv-python-headless-4.6.0.66 packaging-20.9 pandas-1.5.1 pillow-9.3.0 pooch-1.6.0 promise-2.3 proto-plus-1.22.1 psutil-5.9.4 py-cpuinfo-9.0.0 pyarrow-10.0.0 pybind11-2.10.1 pycparser-2.21 python-dateutil-2.8.2 python-slugify-6.1.2 pytz-2022.6 resampy-0.4.2 scann-1.2.6 scikit-learn-1.1.3 scipy-1.9.3 sentencepiece-0.1.97 sounddevice-0.4.5 soundfile-0.11.0 tensorflow-2.10.0 tensorflow-addons-0.18.0 tensorflow-datasets-4.7.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tensorflow-model-optimization-0.7.3 tensorflowjs-3.18.0 text-unidecode-1.3 tf-models-official-2.3.0 tf-slim-1.1.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 threadpoolctl-3.1.0 toml-0.10.2 tqdm-4.64.1 typeguard-2.13.3 uritemplate-4.1.1 urllib3-1.25.11 WARNING: You are using pip version 20.2.4; however, version 22.3.1 is available. You should consider upgrading via the '/usr/bin/python3 -m pip install --upgrade pip' command. root@566168cfbe3e:/# 15:47 ok that wasn’t terrible.\n17:56 So per the initial pip freeze, I had tensorflow-cpu==2.10.0 and when I tried pip installing tflite-model-maker and among packages ended up getting installed, includes\nscikit-learn-1.1.3 scipy-1.9.3 tensorflow-2.10.0 tensorflow-datasets-4.7.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 but I hope this Docker , if it flipped from tensorflow-cpu to tensorflow vanilla, will still work. So when I import tensorflow I get more or less a warning but not an error,\nIn [1]: import tensorflow as tf 2022-11-12 23:09:24.366553: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations: AVX2 FMA To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. 2022-11-12 23:09:25.000557: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory 2022-11-12 23:09:25.000647: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine. 2022-11-12 23:09:25.124265: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered 2022-11-12 23:09:27.457123: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory 2022-11-12 23:09:27.457399: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory 2022-11-12 23:09:27.457462: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly. Ah but too good to be true, so ,\nfrom tflite_model_maker import image_classifier ImportError: libusb-1.0.so.0: cannot open shared object file: No such file or directory Reading the https://www.tensorflow.org/lite/models/modify/model_maker#installation information here I am not yet sure is #GPU support required or not .\nAlso read on stackoverflow\napt-get install libusb-1.0-0-dev seems to have worked.\n18:38 ok well, so next time around, that from tflite_model_maker import image_classifier did not crash. so full input of mine was ,\ndocker run -it tensorflow/tensorflow bash ... then ,\napt-get install libusb-1.0-0-dev Next I tried to install the raw dependencies that got installed last time but that threw a weird error about ,\nERROR: Double requirement given: google==api-python-client-2.65.0 (already in google==api-core-2.10.2, name='google') so I ended up upgrading pip, from 20.2.4 because maybe , version 22.3.1 was smarter w/ dependencies?\npython3 -m pip install --upgrade pip Then I tried to again install the full chain of dependencies but I got an error about python 3.7 ,\nERROR: Ignored the following versions that require a different python version: 0.7 Requires-Python \u003e=3.6, \u003c3.7; 0.8 Requires-Python \u003e=3.6, \u003c3.7 so I just went ahead to try tflite-model-maker by itself why not\npip install tflite-model-maker==0.4.2 so the tflite-model-maker installation took maybe 3 minutes.\nERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts. tensorflow-cpu 2.10.0 requires keras\u003c2.11,\u003e=2.10.0, but you have keras 2.8.0 which is incompatible. tensorflow-cpu 2.10.0 requires tensorboard\u003c2.11,\u003e=2.10, but you have tensorboard 2.8.0 which is incompatible. tensorflow-cpu 2.10.0 requires tensorflow-estimator\u003c2.11,\u003e=2.10.0, but you have tensorflow-estimator 2.8.0 which is incompatible. Successfully installed CFFI-1.15.1 Cython-0.29.32 PyYAML-6.0 appdirs-1.4.4 attrs-22.1.0 audioread-3.0.0 cycler-0.11.0 dataclasses-0.6 decorator-5.1.1 dill-0.3.6 dm-tree-0.1.7 etils-0.9.0 fire-0.4.0 gin-config-0.5.0 google-api-core-2.10.2 google-api-python-client-2.65.0 google-auth-httplib2-0.1.0 google-cloud-bigquery-3.3.6 google-cloud-bigquery-storage-2.16.2 google-cloud-core-2.3.2 google-crc32c-1.5.0 google-resumable-media-2.4.0 googleapis-common-protos-1.56.4 grpcio-1.50.0 grpcio-status-1.48.2 httplib2-0.21.0 importlib-resources-5.10.0 joblib-1.2.0 kaggle-1.5.12 keras-2.8.0 kiwisolver-1.4.4 librosa-0.8.1 llvmlite-0.36.0 lxml-4.9.1 matplotlib-3.4.3 neural-structured-learning-1.4.0 numba-0.53.0 opencv-python-headless-4.6.0.66 packaging-20.9 pandas-1.5.1 pillow-9.3.0 pooch-1.6.0 promise-2.3 proto-plus-1.22.1 protobuf-3.19.6 psutil-5.9.4 py-cpuinfo-9.0.0 pyarrow-10.0.0 pybind11-2.10.1 pycparser-2.21 python-dateutil-2.8.2 python-slugify-6.1.2 pytz-2022.6 resampy-0.4.2 scann-1.2.6 scikit-learn-1.1.3 scipy-1.9.3 sentencepiece-0.1.97 sounddevice-0.4.5 soundfile-0.11.0 tensorboard-2.8.0 tensorflow-2.8.3 tensorflow-addons-0.18.0 tensorflow-datasets-4.7.0 tensorflow-estimator-2.8.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tensorflow-model-optimization-0.7.3 tensorflowjs-3.18.0 text-unidecode-1.3 tf-models-official-2.3.0 tf-slim-1.1.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 threadpoolctl-3.1.0 toml-0.10.2 tqdm-4.64.1 typeguard-2.13.3 uritemplate-4.1.1 urllib3-1.25.11 18:59 ok let me try to run docker now w/ a shared directory , with a Dockerfile , summarizing the above, and I am using from what I can tell, this version but somehow I do not see it on https://hub.docker.com/r/tensorflow/tensorflow/ , #Docker-hub\ntensorflow/tensorflow latest 976c17ec6daa 2 months ago 1.46GB FROM tensorflow/tensorflow:latest RUN apt-get install -y libusb-1.0-0-dev RUN python3 -m pip install --upgrade pip RUN pip install tflite-model-maker==0.4.2 RUN pip install ipython create an image,\ndocker build -t food-not-food -f hmm-docker/Dockerfile hmm-docker [+] Building 259.2s (9/9) FINISHED =\u003e [internal] load build definition from Dockerfile 0.2s =\u003e =\u003e transferring dockerfile: 228B 0.1s =\u003e [internal] load .dockerignore 0.1s =\u003e =\u003e transferring context: 2B 0.1s =\u003e [internal] load metadata for docker.io/tensorflow/tensorflow:latest 0.0s =\u003e [1/5] FROM docker.io/tensorflow/tensorflow 0.1s =\u003e [2/5] RUN apt-get install -y libusb-1.0-0-dev 3.9s =\u003e [3/5] RUN python3 -m pip install --upgrade pip 3.7s =\u003e [4/5] RUN pip install tflite-model-maker==0.4.2 219.6s =\u003e [5/5] RUN pip install ipython 8.4s =\u003e exporting to image 23.5s =\u003e =\u003e exporting layers 23.4s =\u003e =\u003e writing image sha256:dc8e469de66a5e8e9d91b4fc971a7cc9ff8ba9f2ed04e395e182e472a237c526 0.1s =\u003e =\u003e naming to docker.io/library/food-not-food 0.0s And run it , per my handy notes , https://github.com/namoopsoo/handy/blob/master/Docker/hmm.md\ncd ~/Dropbox/Code/repo/food-not-food docker run -i -t -v $(pwd):/home \\ -v ~/Dropbox/Code/repo/data/101_food_classes_all_data:/mnt/101_food_classes_all_data \\ food-not-food # docker run -it tensorflow/tensorflow bash 18:19 Since the installation basically worked in Docker at least,\n17:50 so let me see, can I run the model training script ?\nNext downloading the data ok ,\n/Users/michal/Dropbox/Code/repo/food-not-food (dedupe) (base) $ python data_download/download_food101.py 101_food_classes_all_data.zip: 100%|█████████████████████| 4.67G/4.67G [06:07\u003c00:00, 13.6MiB/s] [INFO] Food101 downloaded, unzipping... 20:04 So I kind of lazily ended up doing this\nIn [2]: from pathlib import Path ...: from datetime import date ...: from tflite_model_maker import image_classifier ...: from tflite_model_maker.image_classifier import DataLoader ...: In [3]: train_data_path = \"/mnt/101_food_classes_all_data/train/apple_pie\" In [4]: test_data_path = \"/mnt/101_food_classes_all_data/test/apple_pie\" In [5]: train_data = DataLoader.from_folder(train_data_path) ...: test_data = DataLoader.from_folder(test_data_path) ...: --------------------------------------------------------------------------- ValueError Traceback (most recent call last) Cell In [5], line 1 ----\u003e 1 train_data = DataLoader.from_folder(train_data_path) 2 test_data = DataLoader.from_folder(test_data_path) File /usr/local/lib/python3.8/dist-packages/tensorflow_examples/lite/model_maker/core/data_util/image_dataloader.py:73, in ImageClassifierDataLoader.from_folder(cls, filename, shuffle) 71 all_image_size = len(all_image_paths) 72 if all_image_size == 0: ---\u003e 73 raise ValueError('Image size is zero') 75 if shuffle: 76 # Random shuffle data. 77 random.shuffle(all_image_paths) ValueError: Image size is zero and I think the error was because a certain directory structure is expected.\nSo I did this.\n(base) $ cp ../data/101_food_classes_all_data/train/apple_pie/* ../data/101_food_classes_all_data/small/train/apple_pie (base) $ du -d 0 -h ../data/101_food_classes_all_data/small/train/apple_pie 36M\t../data/101_food_classes_all_data/small/train/apple_pie (base) $ cp ../data/101_food_classes_all_data/test/apple_pie/* ../data/101_food_classes_all_data/small/test/apple_pie/ (base) $ (base) $ cp ../data/101_food_classes_all_data/test/churros/* ../data/101_food_classes_all_data/small/test/not_apple_pie/ (base) $ cp ../data/101_food_classes_all_data/train/churros/* ../data/101_food_classes_all_data/small/train/not_apple_pie/ (base) $ 20:06 ok does that help?\ntrain_data_path = \"/mnt/101_food_classes_all_data/small/train\" test_data_path = \"/mnt/101_food_classes_all_data/small/test\" train_data = DataLoader.from_folder(train_data_path) test_data = DataLoader.from_folder(test_data_path) 2022-11-13 01:08:49.543996: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory 2022-11-13 01:08:49.545031: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303) 2022-11-13 01:08:49.546377: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (a4d9f933dc4f): /proc/driver/nvidia/version does not exist 2022-11-13 01:08:49.561325: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations: AVX2 FMA To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. INFO:tensorflow:Load image with size: 1500, num_label: 2, labels: apple_pie, not_apple_pie. INFO:tensorflow:Load image with size: 500, num_label: 2, labels: apple_pie, not_apple_pie. ok so that was the correct folder structure cool, but hopefully the other #GPU cuda errors don’t hold me back. Let’s find out\n20:10 ok,\nNUM_EPOCHS = 1 MODEL_SPEC = \"efficientnet_lite0\" # Create model print(f\"[INFO] Creating and training model...\") print(f\"[INFO] Training {MODEL_SPEC} for {NUM_EPOCHS} epochs...\") model = image_classifier.create( train_data=train_data, model_spec=MODEL_SPEC, epochs=NUM_EPOCHS, use_augmentation=True, ) [INFO] Creating and training model... [INFO] Training efficientnet_lite0 for 1 epochs... INFO:tensorflow:Retraining the models... Model: \"sequential\" _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= hub_keras_layer_v1v2 (HubKe (None, 1280) 3413024 rasLayerV1V2) dropout (Dropout) (None, 1280) 0 dense (Dense) (None, 2) 2562 ================================================================= Total params: 3,415,586 Trainable params: 2,562 Non-trainable params: 3,413,024 _________________________________________________________________ None INFO:tensorflow:Use default resize_bicubic. INFO:tensorflow:Use default resize_bicubic. INFO:tensorflow:Use customized resize method bilinear INFO:tensorflow:Use customized resize method bilinear 2022-11-13 01:12:34.077741: W tensorflow/core/framework/cpu_allocator_impl.cc:82] Allocation of 19267584 exceeds 10% of free system memory. 2022-11-13 01:12:34.350836: W tensorflow/core/framework/cpu_allocator_impl.cc:82] Allocation of 19267584 exceeds 10% of free system memory. 2022-11-13 01:12:34.357610: W tensorflow/core/framework/cpu_allocator_impl.cc:82] Allocation of 51380224 exceeds 10% of free system memory. 2022-11-13 01:12:34.718472: W tensorflow/core/framework/cpu_allocator_impl.cc:82] Allocation of 19267584 exceeds 10% of free system memory. 2022-11-13 01:12:34.887098: W tensorflow/core/framework/cpu_allocator_impl.cc:82] Allocation of 51380224 exceeds 10% of free system memory. 46/46 [==============================] - 48s 963ms/step - loss: 0.4440 - accuracy: 0.8274 ok wow that did something without crashing. nice. Will the testing work?\ntest_loss, test_accuracy = model.evaluate(test_data) INFO:tensorflow:Use customized resize method bilinear INFO:tensorflow:Use customized resize method bilinear 16/16 [==============================] - 22s 1s/step - loss: 0.3070 - accuracy: 0.9540 22:22 ok and let’s see how do I run this on unlabeled data then ?\nfrom datetime import date current_date = str(date.today()) model_number = 1 export_dir = \"/home/models\" model_save_path = ( Path(export_dir) / f\"{current_date}_apple_pie_or_churro_model_{MODEL_SPEC}_v{model_number}.tflite\") print(f\"[INFO] Saving the model to '{export_dir}' directory as '{model_save_path}'...\") model.export(export_dir=export_dir, tflite_filename=model_save_path) print(f\"[INFO] Model saved to: '{model_save_path}'.\") Ok that took a minute or two\n[INFO] Saving the model to '/home/models' directory as '/home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite'... INFO:tensorflow:Use customized resize method bilinear INFO:tensorflow:Use customized resize method bilinear 2022-11-13 03:37:29.984575: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them. INFO:tensorflow:Assets written to: /tmp/tmpodz47y2g/assets INFO:tensorflow:Assets written to: /tmp/tmpodz47y2g/assets 2022-11-13 03:37:35.785772: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count \u003e= 8, compute capability \u003e= 0.0): 0 2022-11-13 03:37:35.787503: I tensorflow/core/grappler/clusters/single_machine.cc:358] Starting new session 2022-11-13 03:37:35.864717: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1164] Optimization results for grappler item: graph_to_optimize function_optimizer: Graph size after: 913 nodes (656), 923 edges (664), time = 35.413ms. function_optimizer: function_optimizer did nothing. time = 0.888ms. /usr/local/lib/python3.8/dist-packages/tensorflow/lite/python/convert.py:746: UserWarning: Statistics for quantized inputs were expected, but not specified; continuing anyway. warnings.warn(\"Statistics for quantized inputs were expected, but not \" 2022-11-13 03:37:37.252870: W tensorflow/compiler/mlir/lite/python/tf_tfl_flatbuffer_helpers.cc:357] Ignored output_format. 2022-11-13 03:37:37.253120: W tensorflow/compiler/mlir/lite/python/tf_tfl_flatbuffer_helpers.cc:360] Ignored drop_control_dependency. fully_quantize: 0, inference_type: 6, input_inference_type: 3, output_inference_type: 3 INFO:tensorflow:Label file is inside the TFLite model with metadata. INFO:tensorflow:Label file is inside the TFLite model with metadata. INFO:tensorflow:Saving labels in /tmp/tmpmy_t1d99/labels.txt INFO:tensorflow:Saving labels in /tmp/tmpmy_t1d99/labels.txt INFO:tensorflow:TensorFlow Lite model exported successfully: /home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite INFO:tensorflow:TensorFlow Lite model exported successfully: /home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite [INFO] Model saved to: '/home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite'. And reading on here, https://www.tensorflow.org/lite/models/modify/model_maker/image_classification that you can also evaluate data like ,\nmodel.evaluate_tflite('model.tflite', test_data) but yea still looking for how do I create unlabeled dataset?\nAlso reading on https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker/image_classifier/DataLoader that the data passed in to DataLoader can also be a tf.data.Dataset ,\ntflite_model_maker.image_classifier.DataLoader( dataset, size, index_to_label ) 23:03 also reading on https://www.tensorflow.org/lite/api_docs/python/tf/lite/Interpreter here that not only can you convert a regular tensorflow model to the tensorflow lite format you also need to allocate tensors before using it,\ninterpreter = tf.lite.Interpreter(model_content=tflite_model) interpreter.allocate_tensors() # Needed before execution! lets try whatever,\nunlabeled_data_path = \"/mnt/101_food_classes_all_data/small/unlabeled/\" unlabeled_data = DataLoader.from_folder(unlabeled_data_path) ","wordCount":"2877","inLanguage":"en","datePublished":"2022-11-12T00:00:00Z","dateModified":"2023-02-26T18:33:54-05:00","author":{"@type":"Person","name":"Michal Piekarczyk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/"},"publisher":{"@type":"Organization","name":"michal.piekarczyk.xyz","logo":{"@type":"ImageObject","url":"https://michal.piekarczyk.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michal.piekarczyk.xyz/ accesskey=h title="michal.piekarczyk.xyz (Alt + H)">michal.piekarczyk.xyz</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michal.piekarczyk.xyz/post/ title=posts><span>posts</span></a></li><li><a href=https://michal.piekarczyk.xyz/project/ title=projects><span>projects</span></a></li><li><a href=https://michal.piekarczyk.xyz/handy/ title=handy><span>handy</span></a></li><li><a href=https://michal.piekarczyk.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://michal.piekarczyk.xyz/about/ title=about><span>about</span></a></li><li><a href=https://world.hey.com/michal.piekarczyk title=frivolity><span>frivolity</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://michal.piekarczyk.xyz/>Home</a>&nbsp;»&nbsp;<a href=https://michal.piekarczyk.xyz/post/>Posts</a></div><h1 class=post-title>Dockerizing Daniel Bourke's Food Not Food</h1><div class=post-meta>&lt;span title='2022-11-12 00:00:00 +0000 UTC'>November 12, 2022&lt;/span>&amp;nbsp;·&amp;nbsp;14 min&amp;nbsp;·&amp;nbsp;2877 words&amp;nbsp;·&amp;nbsp;Michal Piekarczyk</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#my-stream-of-consciousness-notes>My stream of consciousness notes!</a></li></ul></nav></div></details></div><div class=post-content><p>I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, <a href=https://github.com/namoopsoo/manage-my-photos>https://github.com/namoopsoo/manage-my-photos</a> related to my glue code.)</p><p>But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, <a href=https://github.com/mrdbourke/food-not-food>https://github.com/mrdbourke/food-not-food</a> .</p><p>This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this,
<a href=https://github.com/namoopsoo/food-not-food>https://github.com/namoopsoo/food-not-food</a> and added a <code>Dockerfile</code> to make this easier. Also putting this into docker eventually helped me to batch process photos as well. I can link to a separate post on that as well.</p><h2 id=my-stream-of-consciousness-notes>My stream of consciousness notes!<a hidden class=anchor aria-hidden=true href=#my-stream-of-consciousness-notes>#</a></h2><ul><li>14:02 continue with [[my photo system]] [[import my photos to icloud photos 2022-Oct]]<ul><li><p>14:12 I am also using a pytorch repo for photo deduping.</p></li><li><p>14:22 Ok I took a snapshot <code>dedupe-requirements-snapshot-2022-11-12.txt</code> of what I have in my <code>dedupe</code> pip environment and looks like actually the #deduping-images library I use , uses #PyTorch and the [[Daniel Bourke Food not Food]] uses #TensorFlow , so likely will not clash .</p></li><li><p>14:28 ok I cloned the repo and running the <code>pip install -r requirements.txt</code></p><ul><li>Stumbling on dependency resolution bottlenecks with several packages, <code>tensorflow-metadata</code> , <code>tabulate</code> ,<pre tabindex=0><code>INFO: pip is looking at multiple versions of tabulate to determine which version is compatible with other requirements. This could take a while.

...
INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. If you want to abort this run, you can press Ctrl + C to do so. To improve how pip performs, tell us what happened here: https://pip.pypa.io/surveys/backtracking

...
INFO: pip is looking at multiple versions of sortedcontainers to determine which version is compatible with other requirements. This could take a while.

INFO: pip is looking at multiple versions of tifffile to determine which version is compatible with other requirements. This could take a while.
Collecting tifffile&gt;=2019.7.26
  Downloading tifffile-2022.8.12-py3-none-any.whl (208 kB)
     |████████████████████████████████| 208 kB 15.6 MB/s 

  Downloading tifffile-2022.8.8-py3-none-any.whl (208 kB)
</code></pre></li></ul></li><li><p>14:56 yea had to cancel, that wasn&rsquo;t going anywhere .</p><ul><li><p>Let me try conda instead,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>conda create <span style=color:#f92672>-</span>n foodnot 
</span></span><span style=display:flex><span>conda activate foodnot
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(foodnot) <span style=color:#960050;background-color:#1e0010>$</span> conda install  matplotlib numpy pandas requests scikit<span style=color:#f92672>-</span>learn tensorflow tflite<span style=color:#f92672>-</span>model<span style=color:#f92672>-</span>maker tqdm <span style=color:#75715e># fiftyone</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Hmm cannot find tflite-model-maker</span>
</span></span><span style=display:flex><span>conda install  matplotlib numpy pandas requests scikit<span style=color:#f92672>-</span>learn tensorflow  tqdm <span style=color:#75715e># fiftyone</span>
</span></span></code></pre></div><p>Ok well that worked but now since cannot find <code>tflite-model-maker</code> with conda, trying with <code>pip</code> ,</p><pre tabindex=0><code>pip install tflite-model-maker
</code></pre><p>and it is a mess again! Just some kind of hell this installation just looks like a whole lot of this ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221104<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.5</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.5</span> MB <span style=color:#ae81ff>3.3</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221103<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.5</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.5</span> MB <span style=color:#ae81ff>7.3</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221102<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.7</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.7</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.7</span> MB <span style=color:#ae81ff>4.1</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221101<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.7</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.7</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.7</span> MB <span style=color:#ae81ff>3.4</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221031<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>222.4</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>222.4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>222.4</span> MB <span style=color:#ae81ff>3.4</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221030<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>222.4</span> MB)
</span></span></code></pre></div></li></ul></li><li><p>15:21 ok let me try #Docker .</p><ul><li><p>15:35 ok from , <a href=https://www.tensorflow.org/install/docker>https://www.tensorflow.org/install/docker</a> ,</p><pre tabindex=0><code>(foodnot) $ docker -v 
Docker version 20.10.21, build baeda1f
(foodnot) $ docker pull tensorflow/tensorflow
...

(foodnot) $ docker run -it --rm tensorflow/tensorflow python -c &#34;import tensorflow as tf; print(tf.reduce_sum(tf.random.normal([1000, 1000])))&#34;
2022-11-12 20:37:15.606702: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-11-12 20:37:17.349502: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
tf.Tensor(-1153.0294, shape=(), dtype=float32)
</code></pre></li><li><p>ok cool so now let me try to apply the [[Daniel Bourke Food not Food]] requirements?</p></li><li><p>15:39 ok let me see from the typical build can I install tflite-model-maker ?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run -it tensorflow/tensorflow bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>________                               _______________                
</span></span><span style=display:flex><span>___  __/__________________________________  ____/__  /________      __
</span></span><span style=display:flex><span>__  /  _  _ <span style=color:#ae81ff>\_</span>  __ <span style=color:#ae81ff>\_</span>  ___/  __ <span style=color:#ae81ff>\_</span>  ___/_  /_   __  /_  __ <span style=color:#ae81ff>\_</span> | /| / /
</span></span><span style=display:flex><span>_  /   /  __/  / / /<span style=color:#f92672>(</span>__  <span style=color:#f92672>)</span>/ /_/ /  /   _  __/   _  / / /_/ /_ |/ |/ / 
</span></span><span style=display:flex><span>/_/    <span style=color:#ae81ff>\_</span>__//_/ /_//____/ <span style=color:#ae81ff>\_</span>___//_/    /_/      /_/  <span style=color:#ae81ff>\_</span>___/____/|__/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WARNING: You are running this container as root, which can cause new files in
</span></span><span style=display:flex><span>mounted volumes to be created as the root user on your host machine.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To avoid this, run the container by specifying your user<span style=color:#e6db74>&#39;s userid:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$ docker run -u $(id -u):$(id -g) args...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@566168cfbe3e:/# which pip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/usr/local/bin/pip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@566168cfbe3e:/# pip freeze
</span></span></span><span style=display:flex><span><span style=color:#e6db74>absl-py==1.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>astunparse==1.6.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cachetools==5.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>certifi==2022.6.15
</span></span></span><span style=display:flex><span><span style=color:#e6db74>charset-normalizer==2.1.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>flatbuffers==2.0.7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gast==0.4.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>google-auth==2.11.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>google-auth-oauthlib==0.4.6
</span></span></span><span style=display:flex><span><span style=color:#e6db74>google-pasta==0.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>grpcio==1.48.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>h5py==3.7.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>idna==3.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>importlib-metadata==4.12.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>keras==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Keras-Preprocessing==1.1.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>libclang==14.0.6
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Markdown==3.4.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MarkupSafe==2.1.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>numpy==1.23.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>oauthlib==3.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>opt-einsum==3.3.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>packaging==21.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>protobuf==3.19.4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pyasn1==0.4.8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pyasn1-modules==0.2.8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pyparsing==3.0.9
</span></span></span><span style=display:flex><span><span style=color:#e6db74>requests==2.28.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>requests-oauthlib==1.3.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rsa==4.9
</span></span></span><span style=display:flex><span><span style=color:#e6db74>six==1.16.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorboard==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorboard-data-server==0.6.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorboard-plugin-wit==1.8.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorflow-cpu==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorflow-estimator==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorflow-io-gcs-filesystem==0.26.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>termcolor==1.1.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>typing-extensions==4.3.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>urllib3==1.26.12
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Werkzeug==2.2.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>wrapt==1.14.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zipp==3.8.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@566168cfbe3e:/# pip install tflite-model-maker
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Collecting tflite-model-maker
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Downloading tflite_model_maker-0.4.2-py3-none-any.whl (577 kB)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     |████████████████████████████████| 577 kB 1.2 MB/s 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ... 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ... 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ... 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Successfully built fire promise kaggle audioread
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Installing collected packages: pillow, PyYAML, packaging, tensorflow-hub, tensorflow, tensorflowjs, typeguard, tensorflow-addons, scann, dm-tree, tensorflow-model-optimization, lxml, kiwisolver, python-dateutil, cycler, matplotlib, llvmlite, numba, importlib-resources, toml, dill, etils, tqdm, googleapis-common-protos, tensorflow-metadata, promise, tensorflow-datasets, opencv-python-headless, Cython, tf-slim, proto-plus, pyarrow, grpcio-status, google-api-core, google-cloud-bigquery-storage, google-cloud-core, google-crc32c, google-resumable-media, google-cloud-bigquery, psutil, py-cpuinfo, httplib2, uritemplate, google-auth-httplib2, google-api-python-client, dataclasses, gin-config, sentencepiece, scipy, text-unidecode, python-slugify, urllib3, kaggle, pytz, pandas, tf-models-official, fire, pycparser, CFFI, sounddevice, pybind11, tflite-support, attrs, neural-structured-learning, appdirs, pooch, joblib, threadpoolctl, scikit-learn, soundfile, resampy, audioread, decorator, librosa, tflite-model-maker
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Attempting uninstall: packaging
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Found existing installation: packaging 21.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Uninstalling packaging-21.3:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Successfully uninstalled packaging-21.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		 ...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     ERROR: After October 2020 you may experience errors when installing or updating packages. This is because pip will change the way that it resolves dependency conflicts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     We recommend you use --use-feature=2020-resolver to test your packages with the new resolver before it becomes the default.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     scann 1.2.6 requires tensorflow~=2.8.0, but you&#39;</span>ll have tensorflow 2.10.0 which is incompatible.
</span></span><span style=display:flex><span>     grpcio-status 1.50.0 requires grpcio&gt;<span style=color:#f92672>=</span>1.50.0, but you<span style=color:#e6db74>&#39;ll have grpcio 1.48.1 which is incompatible.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     grpcio-status 1.50.0 requires protobuf&gt;=4.21.6, but you&#39;</span>ll have protobuf 3.19.4 which is incompatible.
</span></span><span style=display:flex><span>     google-api-core 2.10.2 requires protobuf!<span style=color:#f92672>=</span>3.20.0,!<span style=color:#f92672>=</span>3.20.1,!<span style=color:#f92672>=</span>4.21.0,!<span style=color:#f92672>=</span>4.21.1,!<span style=color:#f92672>=</span>4.21.2,!<span style=color:#f92672>=</span>4.21.3,!<span style=color:#f92672>=</span>4.21.4,!<span style=color:#f92672>=</span>4.21.5,&lt;5.0.0dev,&gt;<span style=color:#f92672>=</span>3.19.5, but you<span style=color:#e6db74>&#39;ll have protobuf 3.19.4 which is incompatible.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     google-cloud-bigquery-storage 2.16.2 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;5.0.0dev,&gt;=3.19.5, but you&#39;</span>ll have protobuf 3.19.4 which is incompatible.
</span></span><span style=display:flex><span>     google-cloud-bigquery 3.3.6 requires protobuf!<span style=color:#f92672>=</span>3.20.0,!<span style=color:#f92672>=</span>3.20.1,!<span style=color:#f92672>=</span>4.21.0,!<span style=color:#f92672>=</span>4.21.1,!<span style=color:#f92672>=</span>4.21.2,!<span style=color:#f92672>=</span>4.21.3,!<span style=color:#f92672>=</span>4.21.4,!<span style=color:#f92672>=</span>4.21.5,&lt;5.0.0dev,&gt;<span style=color:#f92672>=</span>3.19.5, but you<span style=color:#e6db74>&#39;ll have protobuf 3.19.4 which is incompatible.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     Successfully installed CFFI-1.15.1 Cython-0.29.32 PyYAML-6.0 appdirs-1.4.4 attrs-22.1.0 audioread-3.0.0 cycler-0.11.0 dataclasses-0.6 decorator-5.1.1 dill-0.3.6 dm-tree-0.1.7 etils-0.9.0 fire-0.4.0 gin-config-0.5.0 google-api-core-2.10.2 google-api-python-client-2.65.0 google-auth-httplib2-0.1.0 google-cloud-bigquery-3.3.6 google-cloud-bigquery-storage-2.16.2 google-cloud-core-2.3.2 google-crc32c-1.5.0 google-resumable-media-2.4.0 googleapis-common-protos-1.56.4 grpcio-status-1.50.0 httplib2-0.21.0 importlib-resources-5.10.0 joblib-1.2.0 kaggle-1.5.12 kiwisolver-1.4.4 librosa-0.8.1 llvmlite-0.36.0 lxml-4.9.1 matplotlib-3.4.3 neural-structured-learning-1.4.0 numba-0.53.0 opencv-python-headless-4.6.0.66 packaging-20.9 pandas-1.5.1 pillow-9.3.0 pooch-1.6.0 promise-2.3 proto-plus-1.22.1 psutil-5.9.4 py-cpuinfo-9.0.0 pyarrow-10.0.0 pybind11-2.10.1 pycparser-2.21 python-dateutil-2.8.2 python-slugify-6.1.2 pytz-2022.6 resampy-0.4.2 scann-1.2.6 scikit-learn-1.1.3 scipy-1.9.3 sentencepiece-0.1.97 sounddevice-0.4.5 soundfile-0.11.0 tensorflow-2.10.0 tensorflow-addons-0.18.0 tensorflow-datasets-4.7.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tensorflow-model-optimization-0.7.3 tensorflowjs-3.18.0 text-unidecode-1.3 tf-models-official-2.3.0 tf-slim-1.1.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 threadpoolctl-3.1.0 toml-0.10.2 tqdm-4.64.1 typeguard-2.13.3 uritemplate-4.1.1 urllib3-1.25.11
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     WARNING: You are using pip version 20.2.4; however, version 22.3.1 is available.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     You should consider upgrading via the &#39;</span>/usr/bin/python3 -m pip install --upgrade pip<span style=color:#960050;background-color:#1e0010>&#39;</span> command.
</span></span><span style=display:flex><span>     root@566168cfbe3e:/#  
</span></span></code></pre></div></li><li><p>15:47 ok that wasn&rsquo;t terrible.</p></li><li><p>17:56 So per the initial <code>pip freeze</code>, I had <code>tensorflow-cpu==2.10.0</code> and when I tried pip installing <code>tflite-model-maker</code> and among packages ended up getting installed, includes</p><pre tabindex=0><code>scikit-learn-1.1.3
scipy-1.9.3
tensorflow-2.10.0
tensorflow-datasets-4.7.0
tensorflow-hub-0.12.0
tensorflow-metadata-1.11.0
tflite-model-maker-0.4.2
tflite-support-0.4.3
</code></pre><ul><li><p>but I hope this Docker , if it flipped from <code>tensorflow-cpu</code> to <code>tensorflow</code> vanilla, will still work. So when I import <code>tensorflow</code> I get more or less a warning but not an error,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#ae81ff>1</span>]: <span style=color:#f92672>import</span> tensorflow <span style=color:#66d9ef>as</span> tf
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>24.366553</span>: I tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>cpu_feature_guard<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>193</span>] This TensorFlow binary <span style=color:#f92672>is</span> optimized <span style=color:#66d9ef>with</span> oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions <span style=color:#f92672>in</span> performance<span style=color:#f92672>-</span>critical operations:  AVX2 FMA
</span></span><span style=display:flex><span>To enable them <span style=color:#f92672>in</span> other operations, rebuild TensorFlow <span style=color:#66d9ef>with</span> the appropriate compiler flags<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>25.000557</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libcudart.so.11.0&#39;</span>; dlerror: libcudart<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.11.0</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>25.000647</span>: I tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cudart_stub<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>29</span>] Ignore above cudart dlerror <span style=color:#66d9ef>if</span> you do <span style=color:#f92672>not</span> have a GPU set up on your machine<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>25.124265</span>: E tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cuda_blas<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>2981</span>] Unable to register cuBLAS factory: Attempting to register factory <span style=color:#66d9ef>for</span> plugin cuBLAS when one has already been registered
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>27.457123</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libnvinfer.so.7&#39;</span>; dlerror: libnvinfer<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.7</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>27.457399</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libnvinfer_plugin.so.7&#39;</span>; dlerror: libnvinfer_plugin<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.7</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>27.457462</span>: W tensorflow<span style=color:#f92672>/</span>compiler<span style=color:#f92672>/</span>tf2tensorrt<span style=color:#f92672>/</span>utils<span style=color:#f92672>/</span>py_utils<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>38</span>] TF<span style=color:#f92672>-</span>TRT <span style=color:#a6e22e>Warning</span>: Cannot dlopen some TensorRT libraries<span style=color:#f92672>.</span> If you would like to use Nvidia GPU <span style=color:#66d9ef>with</span> TensorRT, please make sure the missing libraries mentioned above are installed properly<span style=color:#f92672>.</span>
</span></span></code></pre></div></li><li><p>Ah but too good to be true, so ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> tflite_model_maker <span style=color:#f92672>import</span> image_classifier
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ImportError</span>: libusb<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>.</span>so<span style=color:#ae81ff>.0</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span></code></pre></div></li><li><p>Reading the <a href=https://www.tensorflow.org/lite/models/modify/model_maker#installation>https://www.tensorflow.org/lite/models/modify/model_maker#installation</a> information here I am not yet sure is #GPU support required or not .</p></li><li><p>Also read on <a href=https://askubuntu.com/questions/629619/how-to-install-libusb>stackoverflow</a></p><pre tabindex=0><code>apt-get install libusb-1.0-0-dev
</code></pre><p>seems to have worked.</p></li><li><p>18:38 ok well, so next time around, that <code>from tflite_model_maker import image_classifier</code> did not crash. so full input of mine was ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run -it tensorflow/tensorflow bash
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>then ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>apt-get install libusb-1.0-0-dev
</span></span></code></pre></div><p>Next I tried to install the raw dependencies that got installed last time but that threw a weird error about ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ERROR: Double requirement given: google<span style=color:#f92672>==</span>api-python-client-2.65.0 <span style=color:#f92672>(</span>already in google<span style=color:#f92672>==</span>api-core-2.10.2, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;google&#39;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><p>so I ended up upgrading pip, from <code>20.2.4</code> because maybe , <code>version 22.3.1</code> was smarter w/ dependencies?</p><pre tabindex=0><code>python3 -m pip install --upgrade pip
</code></pre><p>Then I tried to again install the full chain of dependencies but I got an error about python 3.7 ,</p><pre tabindex=0><code>ERROR: Ignored the following versions that require a different python version: 0.7 Requires-Python &gt;=3.6, &lt;3.7; 0.8 Requires-Python &gt;=3.6, &lt;3.7
</code></pre><p>so I just went ahead to try <code>tflite-model-maker</code> by itself why not</p><pre tabindex=0><code>pip install tflite-model-maker==0.4.2
</code></pre><p>so the <code>tflite-model-maker</code> installation took maybe 3 minutes.</p><pre tabindex=0><code>ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
tensorflow-cpu 2.10.0 requires keras&lt;2.11,&gt;=2.10.0, but you have keras 2.8.0 which is incompatible.
tensorflow-cpu 2.10.0 requires tensorboard&lt;2.11,&gt;=2.10, but you have tensorboard 2.8.0 which is incompatible.
tensorflow-cpu 2.10.0 requires tensorflow-estimator&lt;2.11,&gt;=2.10.0, but you have tensorflow-estimator 2.8.0 which is incompatible.
Successfully installed CFFI-1.15.1 Cython-0.29.32 PyYAML-6.0 appdirs-1.4.4 attrs-22.1.0 audioread-3.0.0 cycler-0.11.0 dataclasses-0.6 decorator-5.1.1 dill-0.3.6 dm-tree-0.1.7 etils-0.9.0 fire-0.4.0 gin-config-0.5.0 google-api-core-2.10.2 google-api-python-client-2.65.0 google-auth-httplib2-0.1.0 google-cloud-bigquery-3.3.6 google-cloud-bigquery-storage-2.16.2 google-cloud-core-2.3.2 google-crc32c-1.5.0 google-resumable-media-2.4.0 googleapis-common-protos-1.56.4 grpcio-1.50.0 grpcio-status-1.48.2 httplib2-0.21.0 importlib-resources-5.10.0 joblib-1.2.0 kaggle-1.5.12 keras-2.8.0 kiwisolver-1.4.4 librosa-0.8.1 llvmlite-0.36.0 lxml-4.9.1 matplotlib-3.4.3 neural-structured-learning-1.4.0 numba-0.53.0 opencv-python-headless-4.6.0.66 packaging-20.9 pandas-1.5.1 pillow-9.3.0 pooch-1.6.0 promise-2.3 proto-plus-1.22.1 protobuf-3.19.6 psutil-5.9.4 py-cpuinfo-9.0.0 pyarrow-10.0.0 pybind11-2.10.1 pycparser-2.21 python-dateutil-2.8.2 python-slugify-6.1.2 pytz-2022.6 resampy-0.4.2 scann-1.2.6 scikit-learn-1.1.3 scipy-1.9.3 sentencepiece-0.1.97 sounddevice-0.4.5 soundfile-0.11.0 tensorboard-2.8.0 tensorflow-2.8.3 tensorflow-addons-0.18.0 tensorflow-datasets-4.7.0 tensorflow-estimator-2.8.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tensorflow-model-optimization-0.7.3 tensorflowjs-3.18.0 text-unidecode-1.3 tf-models-official-2.3.0 tf-slim-1.1.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 threadpoolctl-3.1.0 toml-0.10.2 tqdm-4.64.1 typeguard-2.13.3 uritemplate-4.1.1 urllib3-1.25.11
</code></pre></li><li><p>18:59 ok let me try to run docker now w/ a shared directory , with a <code>Dockerfile</code> , summarizing the above, and I am using from what I can tell, this version but somehow I do not see it on <a href=https://hub.docker.com/r/tensorflow/tensorflow/>https://hub.docker.com/r/tensorflow/tensorflow/</a> , #Docker-hub</p><pre tabindex=0><code>tensorflow/tensorflow   latest    976c17ec6daa   2 months ago    1.46GB
</code></pre><pre tabindex=0><code>FROM tensorflow/tensorflow:latest 

RUN apt-get install -y libusb-1.0-0-dev

RUN python3 -m pip install --upgrade pip

RUN pip install tflite-model-maker==0.4.2

RUN pip install ipython
</code></pre><p>create an image,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker build -t food-not-food -f hmm-docker/Dockerfile hmm-docker 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Building 259.2s <span style=color:#f92672>(</span>9/9<span style=color:#f92672>)</span> FINISHED                                                                                           
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>internal<span style=color:#f92672>]</span> load build definition from Dockerfile                                                                    0.2s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; transferring dockerfile: 228B                                                                                    0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>internal<span style=color:#f92672>]</span> load .dockerignore                                                                                       0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; transferring context: 2B                                                                                         0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>internal<span style=color:#f92672>]</span> load metadata <span style=color:#66d9ef>for</span> docker.io/tensorflow/tensorflow:latest                                                 0.0s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>1/5<span style=color:#f92672>]</span> FROM docker.io/tensorflow/tensorflow                                                                          0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>2/5<span style=color:#f92672>]</span> RUN apt-get install -y libusb-1.0-0-dev                                                                       3.9s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>3/5<span style=color:#f92672>]</span> RUN python3 -m pip install --upgrade pip                                                                      3.7s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>4/5<span style=color:#f92672>]</span> RUN pip install tflite-model-maker<span style=color:#f92672>==</span>0.4.2                                                                   219.6s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>5/5<span style=color:#f92672>]</span> RUN pip install ipython                                                                                       8.4s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; exporting to image                                                                                                 23.5s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; exporting layers                                                                                                23.4s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; writing image sha256:dc8e469de66a5e8e9d91b4fc971a7cc9ff8ba9f2ed04e395e182e472a237c526                            0.1s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; naming to docker.io/library/food-not-food                                                                        0.0s 
</span></span></code></pre></div><p>And run it , per my handy notes , <a href=https://github.com/namoopsoo/handy/blob/master/Docker/hmm.md>https://github.com/namoopsoo/handy/blob/master/Docker/hmm.md</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd ~/Dropbox/Code/repo/food-not-food
</span></span><span style=display:flex><span>docker run -i -t -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>:/home <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -v ~/Dropbox/Code/repo/data/101_food_classes_all_data:/mnt/101_food_classes_all_data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    food-not-food
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># docker run -it tensorflow/tensorflow bash</span>
</span></span></code></pre></div></li><li></li></ul></li><li><p>18:19 Since the installation basically worked in Docker at least,</p></li><li><p>17:50 so let me see, can I run the model training script ?</p></li></ul></li><li><p>Next downloading the data ok ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>/</span>Users<span style=color:#f92672>/</span>michal<span style=color:#f92672>/</span>Dropbox<span style=color:#f92672>/</span>Code<span style=color:#f92672>/</span>repo<span style=color:#f92672>/</span>food<span style=color:#f92672>-</span><span style=color:#f92672>not</span><span style=color:#f92672>-</span>food
</span></span><span style=display:flex><span>(dedupe) (base) <span style=color:#960050;background-color:#1e0010>$</span> python data_download<span style=color:#f92672>/</span>download_food101<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span><span style=color:#ae81ff>101</span>_food_classes_all_data<span style=color:#f92672>.</span>zip: <span style=color:#ae81ff>100</span><span style=color:#f92672>%|</span><span style=color:#960050;background-color:#1e0010>█████████████████████</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>4.67</span>G<span style=color:#f92672>/</span><span style=color:#ae81ff>4.67</span>G [<span style=color:#ae81ff>06</span>:<span style=color:#ae81ff>07</span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>, <span style=color:#ae81ff>13.6</span>MiB<span style=color:#f92672>/</span>s]
</span></span><span style=display:flex><span>[INFO] Food101 downloaded, unzipping<span style=color:#f92672>...</span>
</span></span></code></pre></div></li><li><p>20:04 So I kind of lazily ended up doing this</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>2</span>]: <span style=color:#f92672>from</span> pathlib <span style=color:#f92672>import</span> Path
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: <span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> date
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: <span style=color:#f92672>from</span> tflite_model_maker <span style=color:#f92672>import</span> image_classifier
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: <span style=color:#f92672>from</span> tflite_model_maker.image_classifier <span style=color:#f92672>import</span> DataLoader
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>3</span>]: train_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/train/apple_pie&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>4</span>]: test_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/test/apple_pie&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>5</span>]: train_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(train_data_path)
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: test_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(test_data_path)
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: 
</span></span><span style=display:flex><span><span style=color:#f92672>---------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ValueError</span>                                Traceback (most recent call last)
</span></span><span style=display:flex><span>Cell In [<span style=color:#ae81ff>5</span>], line <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>----&gt;</span> <span style=color:#ae81ff>1</span> train_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(train_data_path)
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> test_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(test_data_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>File <span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>local<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#ae81ff>.8</span><span style=color:#f92672>/</span>dist<span style=color:#f92672>-</span>packages<span style=color:#f92672>/</span>tensorflow_examples<span style=color:#f92672>/</span>lite<span style=color:#f92672>/</span>model_maker<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>data_util<span style=color:#f92672>/</span>image_dataloader<span style=color:#f92672>.</span>py:<span style=color:#ae81ff>73</span>, <span style=color:#f92672>in</span> ImageClassifierDataLoader<span style=color:#f92672>.</span>from_folder(cls, filename, shuffle)
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>71</span> all_image_size <span style=color:#f92672>=</span> len(all_image_paths)
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>72</span> <span style=color:#66d9ef>if</span> all_image_size <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>---&gt;</span> <span style=color:#ae81ff>73</span>   <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#39;Image size is zero&#39;</span>)
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>75</span> <span style=color:#66d9ef>if</span> shuffle:
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>76</span>   <span style=color:#75715e># Random shuffle data.</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>77</span>   random<span style=color:#f92672>.</span>shuffle(all_image_paths)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ValueError</span>: Image size <span style=color:#f92672>is</span> zero
</span></span></code></pre></div><p>and I think the error was because a certain directory structure is expected.</p><p>So I did this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/train/apple_pie/* ../data/101_food_classes_all_data/small/train/apple_pie
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ du -d <span style=color:#ae81ff>0</span> -h ../data/101_food_classes_all_data/small/train/apple_pie
</span></span><span style=display:flex><span> 36M	../data/101_food_classes_all_data/small/train/apple_pie
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/test/apple_pie/* ../data/101_food_classes_all_data/small/test/apple_pie/
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ 
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/test/churros/* ../data/101_food_classes_all_data/small/test/not_apple_pie/
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/train/churros/* ../data/101_food_classes_all_data/small/train/not_apple_pie/
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ 
</span></span></code></pre></div></li><li><p>20:06 ok does that help?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/small/train&#34;</span>
</span></span><span style=display:flex><span>test_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/small/test&#34;</span>
</span></span><span style=display:flex><span>train_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(train_data_path)
</span></span><span style=display:flex><span>test_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(test_data_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.543996</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libcuda.so.1&#39;</span>; dlerror: libcuda<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.1</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.545031</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cuda_driver<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>269</span>] failed call to cuInit: UNKNOWN ERROR (<span style=color:#ae81ff>303</span>)
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.546377</span>: I tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cuda_diagnostics<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>156</span>] kernel driver does <span style=color:#f92672>not</span> appear to be running on this host (a4d9f933dc4f): <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>driver<span style=color:#f92672>/</span>nvidia<span style=color:#f92672>/</span>version does <span style=color:#f92672>not</span> exist
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.561325</span>: I tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>cpu_feature_guard<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>151</span>] This TensorFlow binary <span style=color:#f92672>is</span> optimized <span style=color:#66d9ef>with</span> oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions <span style=color:#f92672>in</span> performance<span style=color:#f92672>-</span>critical operations:  AVX2 FMA
</span></span><span style=display:flex><span>To enable them <span style=color:#f92672>in</span> other operations, rebuild TensorFlow <span style=color:#66d9ef>with</span> the appropriate compiler flags<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Load image <span style=color:#66d9ef>with</span> size: <span style=color:#ae81ff>1500</span>, num_label: <span style=color:#ae81ff>2</span>, labels: apple_pie, not_apple_pie<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Load image <span style=color:#66d9ef>with</span> size: <span style=color:#ae81ff>500</span>, num_label: <span style=color:#ae81ff>2</span>, labels: apple_pie, not_apple_pie<span style=color:#f92672>.</span>
</span></span></code></pre></div></li><li><p>ok so that was the correct folder structure cool, but hopefully the other #GPU cuda errors don&rsquo;t hold me back. Let&rsquo;s find out</p></li><li><p>20:10 ok,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>NUM_EPOCHS <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>MODEL_SPEC <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;efficientnet_lite0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create model</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Creating and training model...&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Training </span><span style=color:#e6db74>{</span>MODEL_SPEC<span style=color:#e6db74>}</span><span style=color:#e6db74> for </span><span style=color:#e6db74>{</span>NUM_EPOCHS<span style=color:#e6db74>}</span><span style=color:#e6db74> epochs...&#34;</span>)
</span></span><span style=display:flex><span>model <span style=color:#f92672>=</span> image_classifier<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>    train_data<span style=color:#f92672>=</span>train_data,
</span></span><span style=display:flex><span>    model_spec<span style=color:#f92672>=</span>MODEL_SPEC,
</span></span><span style=display:flex><span>    epochs<span style=color:#f92672>=</span>NUM_EPOCHS,
</span></span><span style=display:flex><span>    use_augmentation<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[INFO] Creating <span style=color:#f92672>and</span> training model<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>[INFO] Training efficientnet_lite0 <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>1</span> epochs<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Retraining the models<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>Model: <span style=color:#e6db74>&#34;sequential&#34;</span>
</span></span><span style=display:flex><span>_________________________________________________________________
</span></span><span style=display:flex><span> Layer (type)                Output Shape              Param <span style=color:#75715e>#   </span>
</span></span><span style=display:flex><span><span style=color:#f92672>=================================================================</span>
</span></span><span style=display:flex><span> hub_keras_layer_v1v2 (HubKe  (<span style=color:#66d9ef>None</span>, <span style=color:#ae81ff>1280</span>)             <span style=color:#ae81ff>3413024</span>   
</span></span><span style=display:flex><span> rasLayerV1V2)                                                   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> dropout (Dropout)           (<span style=color:#66d9ef>None</span>, <span style=color:#ae81ff>1280</span>)              <span style=color:#ae81ff>0</span>         
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> dense (Dense)               (<span style=color:#66d9ef>None</span>, <span style=color:#ae81ff>2</span>)                 <span style=color:#ae81ff>2562</span>      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>=================================================================</span>
</span></span><span style=display:flex><span>Total params: <span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>415</span>,<span style=color:#ae81ff>586</span>
</span></span><span style=display:flex><span>Trainable params: <span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>562</span>
</span></span><span style=display:flex><span>Non<span style=color:#f92672>-</span>trainable params: <span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>413</span>,<span style=color:#ae81ff>024</span>
</span></span><span style=display:flex><span>_________________________________________________________________
</span></span><span style=display:flex><span><span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use default resize_bicubic<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use default resize_bicubic<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.077741</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>19267584</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.350836</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>19267584</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.357610</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>51380224</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.718472</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>19267584</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.887098</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>51380224</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>46</span><span style=color:#f92672>/</span><span style=color:#ae81ff>46</span> [<span style=color:#f92672>==============================</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>48</span>s <span style=color:#ae81ff>963</span>ms<span style=color:#f92672>/</span>step <span style=color:#f92672>-</span> loss: <span style=color:#ae81ff>0.4440</span> <span style=color:#f92672>-</span> accuracy: <span style=color:#ae81ff>0.8274</span>
</span></span></code></pre></div></li><li><p>ok wow that did something without crashing. nice. Will the testing work?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_loss, test_accuracy <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>evaluate(test_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span> [<span style=color:#f92672>==============================</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>22</span>s <span style=color:#ae81ff>1</span>s<span style=color:#f92672>/</span>step <span style=color:#f92672>-</span> loss: <span style=color:#ae81ff>0.3070</span> <span style=color:#f92672>-</span> accuracy: <span style=color:#ae81ff>0.9540</span>
</span></span></code></pre></div></li><li><p>22:22 ok and let&rsquo;s see how do I run this on unlabeled data then ?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> date
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>current_date <span style=color:#f92672>=</span> str(date<span style=color:#f92672>.</span>today())
</span></span><span style=display:flex><span>model_number <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>export_dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/home/models&#34;</span>
</span></span><span style=display:flex><span>model_save_path <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    Path(export_dir) 
</span></span><span style=display:flex><span>    <span style=color:#f92672>/</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>current_date<span style=color:#e6db74>}</span><span style=color:#e6db74>_apple_pie_or_churro_model_</span><span style=color:#e6db74>{</span>MODEL_SPEC<span style=color:#e6db74>}</span><span style=color:#e6db74>_v</span><span style=color:#e6db74>{</span>model_number<span style=color:#e6db74>}</span><span style=color:#e6db74>.tflite&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Saving the model to &#39;</span><span style=color:#e6db74>{</span>export_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; directory as &#39;</span><span style=color:#e6db74>{</span>model_save_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;...&#34;</span>)
</span></span><span style=display:flex><span>model<span style=color:#f92672>.</span>export(export_dir<span style=color:#f92672>=</span>export_dir, tflite_filename<span style=color:#f92672>=</span>model_save_path)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Model saved to: &#39;</span><span style=color:#e6db74>{</span>model_save_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;.&#34;</span>)
</span></span></code></pre></div><p>Ok that took a minute or two</p><pre tabindex=0><code>[INFO] Saving the model to &#39;/home/models&#39; directory as &#39;/home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite&#39;...
INFO:tensorflow:Use customized resize method bilinear
INFO:tensorflow:Use customized resize method bilinear
2022-11-13 03:37:29.984575: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.
INFO:tensorflow:Assets written to: /tmp/tmpodz47y2g/assets
INFO:tensorflow:Assets written to: /tmp/tmpodz47y2g/assets
2022-11-13 03:37:35.785772: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count &gt;= 8, compute capability &gt;= 0.0): 0
2022-11-13 03:37:35.787503: I tensorflow/core/grappler/clusters/single_machine.cc:358] Starting new session
2022-11-13 03:37:35.864717: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1164] Optimization results for grappler item: graph_to_optimize
  function_optimizer: Graph size after: 913 nodes (656), 923 edges (664), time = 35.413ms.
  function_optimizer: function_optimizer did nothing. time = 0.888ms.

/usr/local/lib/python3.8/dist-packages/tensorflow/lite/python/convert.py:746: UserWarning: Statistics for quantized inputs were expected, but not specified; continuing anyway.
  warnings.warn(&#34;Statistics for quantized inputs were expected, but not &#34;
2022-11-13 03:37:37.252870: W tensorflow/compiler/mlir/lite/python/tf_tfl_flatbuffer_helpers.cc:357] Ignored output_format.
2022-11-13 03:37:37.253120: W tensorflow/compiler/mlir/lite/python/tf_tfl_flatbuffer_helpers.cc:360] Ignored drop_control_dependency.

fully_quantize: 0, inference_type: 6, input_inference_type: 3, output_inference_type: 3
INFO:tensorflow:Label file is inside the TFLite model with metadata.
INFO:tensorflow:Label file is inside the TFLite model with metadata.
INFO:tensorflow:Saving labels in /tmp/tmpmy_t1d99/labels.txt
INFO:tensorflow:Saving labels in /tmp/tmpmy_t1d99/labels.txt
INFO:tensorflow:TensorFlow Lite model exported successfully: /home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite
INFO:tensorflow:TensorFlow Lite model exported successfully: /home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite
[INFO] Model saved to: &#39;/home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite&#39;.
</code></pre><p>And reading on here, <a href=https://www.tensorflow.org/lite/models/modify/model_maker/image_classification>https://www.tensorflow.org/lite/models/modify/model_maker/image_classification</a> that you can also evaluate data like ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>model<span style=color:#f92672>.</span>evaluate_tflite(<span style=color:#e6db74>&#39;model.tflite&#39;</span>, test_data)
</span></span></code></pre></div><p>but yea still looking for how do I create unlabeled dataset?</p></li><li><p>Also reading on <a href=https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker/image_classifier/DataLoader>https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker/image_classifier/DataLoader</a> that the data passed in to <code>DataLoader</code> can also be a <code>tf.data.Dataset</code> ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>tflite_model_maker<span style=color:#f92672>.</span>image_classifier<span style=color:#f92672>.</span>DataLoader(
</span></span><span style=display:flex><span>    dataset, size, index_to_label
</span></span><span style=display:flex><span>)
</span></span></code></pre></div></li><li><p>23:03 also reading on <a href=https://www.tensorflow.org/lite/api_docs/python/tf/lite/Interpreter>https://www.tensorflow.org/lite/api_docs/python/tf/lite/Interpreter</a> here that not only can you convert a regular tensorflow model to the tensorflow lite format you also need to allocate tensors before using it,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>interpreter <span style=color:#f92672>=</span> tf<span style=color:#f92672>.</span>lite<span style=color:#f92672>.</span>Interpreter(model_content<span style=color:#f92672>=</span>tflite_model)
</span></span><span style=display:flex><span>interpreter<span style=color:#f92672>.</span>allocate_tensors()  <span style=color:#75715e># Needed before execution!</span>
</span></span></code></pre></div></li><li><p>lets try whatever,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>unlabeled_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/small/unlabeled/&#34;</span>
</span></span><span style=display:flex><span>unlabeled_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(unlabeled_data_path)
</span></span></code></pre></div></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://michal.piekarczyk.xyz/tags/docker/>docker</a></li><li><a href=https://michal.piekarczyk.xyz/tags/tensorflow/>tensorflow</a></li></ul><nav class=paginav><a class=prev href=https://michal.piekarczyk.xyz/post/2023-01-29-lang-chain-quick-look/><span class=title>« Prev</span><br><span>Quick lang chain test drive</span>
</a><a class=next href=https://michal.piekarczyk.xyz/post/2022-10-13-backprop-scratch/><span class=title>Next »</span><br><span>Backprop and SGD From Scratch 2022-10-13</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://michal.piekarczyk.xyz/>michal.piekarczyk.xyz</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>