<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Dockerizing Daniel Bourke's Food Not Food | My blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link rel=stylesheet href=/css/custom_code_style.css><meta property="og:title" content="Dockerizing Daniel Bourke's Food Not Food"><meta property="og:description" content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-12T00:00:00+00:00"><meta property="og:site_name" content="My blog"><meta itemprop=name content="Dockerizing Daniel Bourke's Food Not Food"><meta itemprop=description content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."><meta itemprop=datePublished content="2022-11-12T00:00:00+00:00"><meta itemprop=dateModified content="2022-11-12T00:00:00+00:00"><meta itemprop=wordCount content="2877"><meta itemprop=keywords content="docker,tensorflow,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dockerizing Daniel Bourke's Food Not Food"><meta name=twitter:description content="I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, https://github.com/namoopsoo/manage-my-photos related to my glue code.)
But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, https://github.com/mrdbourke/food-not-food .
This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this, https://github."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">My blog</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/handy/ title="Handy page">Handy</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/post/ title="Post page">Post</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/project/ title="Side Projects page">Side Projects</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/foo/ title="The Foos page">The Foos</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POST</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/&text=Dockerizing%20Daniel%20Bourke%27s%20Food%20Not%20Food" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://michal.piekarczyk.xyz/post/2022-11-12-food-not-food/&title=Dockerizing%20Daniel%20Bourke%27s%20Food%20Not%20Food" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Dockerizing Daniel Bourke's Food Not Food</h1><time class="f6 mv4 dib tracked" datetime=2022-11-12T00:00:00Z>November 12, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>I have this on-going effort to be able to more easily show off my photos in the context of conversations. (I have a repo here, <a href=https://github.com/namoopsoo/manage-my-photos>https://github.com/namoopsoo/manage-my-photos</a> related to my glue code.)</p><p>But I want a nice photo stream and my food diary is not part of that at all haha. So after manually moving food photos out, ultimately I stumbled upon Daniel Bourke&rsquo;s Food Not Food repo, <a href=https://github.com/mrdbourke/food-not-food>https://github.com/mrdbourke/food-not-food</a> .</p><p>This was great I thought but I had some challenges getting this code off the ground, so here are my notes where ultimately I forked this,
<a href=https://github.com/namoopsoo/food-not-food>https://github.com/namoopsoo/food-not-food</a> and added a <code>Dockerfile</code> to make this easier. Also putting this into docker eventually helped me to batch process photos as well. I can link to a separate post on that as well.</p><h2 id=my-stream-of-consciousness-notes>My stream of consciousness notes!</h2><ul><li>14:02 continue with [[my photo system]] [[import my photos to icloud photos 2022-Oct]]<ul><li><p>14:12 I am also using a pytorch repo for photo deduping.</p></li><li><p>14:22 Ok I took a snapshot <code>dedupe-requirements-snapshot-2022-11-12.txt</code> of what I have in my <code>dedupe</code> pip environment and looks like actually the #deduping-images library I use , uses #PyTorch and the [[Daniel Bourke Food not Food]] uses #TensorFlow , so likely will not clash .</p></li><li><p>14:28 ok I cloned the repo and running the <code>pip install -r requirements.txt</code></p><ul><li>Stumbling on dependency resolution bottlenecks with several packages, <code>tensorflow-metadata</code> , <code>tabulate</code> ,<pre tabindex=0><code>INFO: pip is looking at multiple versions of tabulate to determine which version is compatible with other requirements. This could take a while.

...
INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. If you want to abort this run, you can press Ctrl + C to do so. To improve how pip performs, tell us what happened here: https://pip.pypa.io/surveys/backtracking

...
INFO: pip is looking at multiple versions of sortedcontainers to determine which version is compatible with other requirements. This could take a while.

INFO: pip is looking at multiple versions of tifffile to determine which version is compatible with other requirements. This could take a while.
Collecting tifffile&gt;=2019.7.26
  Downloading tifffile-2022.8.12-py3-none-any.whl (208 kB)
     |████████████████████████████████| 208 kB 15.6 MB/s 

  Downloading tifffile-2022.8.8-py3-none-any.whl (208 kB)
</code></pre></li></ul></li><li><p>14:56 yea had to cancel, that wasn&rsquo;t going anywhere .</p><ul><li><p>Let me try conda instead,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>conda create <span style=color:#f92672>-</span>n foodnot 
</span></span><span style=display:flex><span>conda activate foodnot
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(foodnot) <span style=color:#960050;background-color:#1e0010>$</span> conda install  matplotlib numpy pandas requests scikit<span style=color:#f92672>-</span>learn tensorflow tflite<span style=color:#f92672>-</span>model<span style=color:#f92672>-</span>maker tqdm <span style=color:#75715e># fiftyone</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Hmm cannot find tflite-model-maker</span>
</span></span><span style=display:flex><span>conda install  matplotlib numpy pandas requests scikit<span style=color:#f92672>-</span>learn tensorflow  tqdm <span style=color:#75715e># fiftyone</span>
</span></span></code></pre></div><p>Ok well that worked but now since cannot find <code>tflite-model-maker</code> with conda, trying with <code>pip</code> ,</p><pre tabindex=0><code>pip install tflite-model-maker
</code></pre><p>and it is a mess again! Just some kind of hell this installation just looks like a whole lot of this ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221104<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.5</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.5</span> MB <span style=color:#ae81ff>3.3</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221103<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.5</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.5</span> MB <span style=color:#ae81ff>7.3</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221102<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.7</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.7</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.7</span> MB <span style=color:#ae81ff>4.1</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221101<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>221.7</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>221.7</span><span style=color:#f92672>/</span><span style=color:#ae81ff>221.7</span> MB <span style=color:#ae81ff>3.4</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221031<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>222.4</span> MB)
</span></span><span style=display:flex><span>     <span style=color:#960050;background-color:#1e0010>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=color:#ae81ff>222.4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>222.4</span> MB <span style=color:#ae81ff>3.4</span> MB<span style=color:#f92672>/</span>s eta <span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>  Downloading tf_nightly<span style=color:#f92672>-</span><span style=color:#ae81ff>2.12.0</span><span style=color:#f92672>.</span>dev20221030<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>cp310<span style=color:#f92672>-</span>macosx_10_14_x86_64<span style=color:#f92672>.</span>whl (<span style=color:#ae81ff>222.4</span> MB)
</span></span></code></pre></div></li></ul></li><li><p>15:21 ok let me try #Docker .</p><ul><li><p>15:35 ok from , <a href=https://www.tensorflow.org/install/docker>https://www.tensorflow.org/install/docker</a> ,</p><pre tabindex=0><code>(foodnot) $ docker -v 
Docker version 20.10.21, build baeda1f
(foodnot) $ docker pull tensorflow/tensorflow
...

(foodnot) $ docker run -it --rm tensorflow/tensorflow python -c &#34;import tensorflow as tf; print(tf.reduce_sum(tf.random.normal([1000, 1000])))&#34;
2022-11-12 20:37:15.606702: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-11-12 20:37:17.349502: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
tf.Tensor(-1153.0294, shape=(), dtype=float32)
</code></pre></li><li><p>ok cool so now let me try to apply the [[Daniel Bourke Food not Food]] requirements?</p></li><li><p>15:39 ok let me see from the typical build can I install tflite-model-maker ?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run -it tensorflow/tensorflow bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>________                               _______________                
</span></span><span style=display:flex><span>___  __/__________________________________  ____/__  /________      __
</span></span><span style=display:flex><span>__  /  _  _ <span style=color:#ae81ff>\_</span>  __ <span style=color:#ae81ff>\_</span>  ___/  __ <span style=color:#ae81ff>\_</span>  ___/_  /_   __  /_  __ <span style=color:#ae81ff>\_</span> | /| / /
</span></span><span style=display:flex><span>_  /   /  __/  / / /<span style=color:#f92672>(</span>__  <span style=color:#f92672>)</span>/ /_/ /  /   _  __/   _  / / /_/ /_ |/ |/ / 
</span></span><span style=display:flex><span>/_/    <span style=color:#ae81ff>\_</span>__//_/ /_//____/ <span style=color:#ae81ff>\_</span>___//_/    /_/      /_/  <span style=color:#ae81ff>\_</span>___/____/|__/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WARNING: You are running this container as root, which can cause new files in
</span></span><span style=display:flex><span>mounted volumes to be created as the root user on your host machine.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To avoid this, run the container by specifying your user<span style=color:#e6db74>&#39;s userid:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$ docker run -u $(id -u):$(id -g) args...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@566168cfbe3e:/# which pip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/usr/local/bin/pip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@566168cfbe3e:/# pip freeze
</span></span></span><span style=display:flex><span><span style=color:#e6db74>absl-py==1.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>astunparse==1.6.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cachetools==5.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>certifi==2022.6.15
</span></span></span><span style=display:flex><span><span style=color:#e6db74>charset-normalizer==2.1.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>flatbuffers==2.0.7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gast==0.4.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>google-auth==2.11.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>google-auth-oauthlib==0.4.6
</span></span></span><span style=display:flex><span><span style=color:#e6db74>google-pasta==0.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>grpcio==1.48.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>h5py==3.7.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>idna==3.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>importlib-metadata==4.12.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>keras==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Keras-Preprocessing==1.1.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>libclang==14.0.6
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Markdown==3.4.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MarkupSafe==2.1.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>numpy==1.23.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>oauthlib==3.2.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>opt-einsum==3.3.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>packaging==21.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>protobuf==3.19.4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pyasn1==0.4.8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pyasn1-modules==0.2.8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pyparsing==3.0.9
</span></span></span><span style=display:flex><span><span style=color:#e6db74>requests==2.28.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>requests-oauthlib==1.3.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rsa==4.9
</span></span></span><span style=display:flex><span><span style=color:#e6db74>six==1.16.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorboard==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorboard-data-server==0.6.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorboard-plugin-wit==1.8.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorflow-cpu==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorflow-estimator==2.10.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tensorflow-io-gcs-filesystem==0.26.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>termcolor==1.1.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>typing-extensions==4.3.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>urllib3==1.26.12
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Werkzeug==2.2.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>wrapt==1.14.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zipp==3.8.1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root@566168cfbe3e:/# pip install tflite-model-maker
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Collecting tflite-model-maker
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Downloading tflite_model_maker-0.4.2-py3-none-any.whl (577 kB)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     |████████████████████████████████| 577 kB 1.2 MB/s 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ... 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ... 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ... 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Successfully built fire promise kaggle audioread
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Installing collected packages: pillow, PyYAML, packaging, tensorflow-hub, tensorflow, tensorflowjs, typeguard, tensorflow-addons, scann, dm-tree, tensorflow-model-optimization, lxml, kiwisolver, python-dateutil, cycler, matplotlib, llvmlite, numba, importlib-resources, toml, dill, etils, tqdm, googleapis-common-protos, tensorflow-metadata, promise, tensorflow-datasets, opencv-python-headless, Cython, tf-slim, proto-plus, pyarrow, grpcio-status, google-api-core, google-cloud-bigquery-storage, google-cloud-core, google-crc32c, google-resumable-media, google-cloud-bigquery, psutil, py-cpuinfo, httplib2, uritemplate, google-auth-httplib2, google-api-python-client, dataclasses, gin-config, sentencepiece, scipy, text-unidecode, python-slugify, urllib3, kaggle, pytz, pandas, tf-models-official, fire, pycparser, CFFI, sounddevice, pybind11, tflite-support, attrs, neural-structured-learning, appdirs, pooch, joblib, threadpoolctl, scikit-learn, soundfile, resampy, audioread, decorator, librosa, tflite-model-maker
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Attempting uninstall: packaging
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Found existing installation: packaging 21.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Uninstalling packaging-21.3:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Successfully uninstalled packaging-21.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		 ...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     ERROR: After October 2020 you may experience errors when installing or updating packages. This is because pip will change the way that it resolves dependency conflicts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     We recommend you use --use-feature=2020-resolver to test your packages with the new resolver before it becomes the default.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     scann 1.2.6 requires tensorflow~=2.8.0, but you&#39;</span>ll have tensorflow 2.10.0 which is incompatible.
</span></span><span style=display:flex><span>     grpcio-status 1.50.0 requires grpcio&gt;<span style=color:#f92672>=</span>1.50.0, but you<span style=color:#e6db74>&#39;ll have grpcio 1.48.1 which is incompatible.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     grpcio-status 1.50.0 requires protobuf&gt;=4.21.6, but you&#39;</span>ll have protobuf 3.19.4 which is incompatible.
</span></span><span style=display:flex><span>     google-api-core 2.10.2 requires protobuf!<span style=color:#f92672>=</span>3.20.0,!<span style=color:#f92672>=</span>3.20.1,!<span style=color:#f92672>=</span>4.21.0,!<span style=color:#f92672>=</span>4.21.1,!<span style=color:#f92672>=</span>4.21.2,!<span style=color:#f92672>=</span>4.21.3,!<span style=color:#f92672>=</span>4.21.4,!<span style=color:#f92672>=</span>4.21.5,&lt;5.0.0dev,&gt;<span style=color:#f92672>=</span>3.19.5, but you<span style=color:#e6db74>&#39;ll have protobuf 3.19.4 which is incompatible.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     google-cloud-bigquery-storage 2.16.2 requires protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;5.0.0dev,&gt;=3.19.5, but you&#39;</span>ll have protobuf 3.19.4 which is incompatible.
</span></span><span style=display:flex><span>     google-cloud-bigquery 3.3.6 requires protobuf!<span style=color:#f92672>=</span>3.20.0,!<span style=color:#f92672>=</span>3.20.1,!<span style=color:#f92672>=</span>4.21.0,!<span style=color:#f92672>=</span>4.21.1,!<span style=color:#f92672>=</span>4.21.2,!<span style=color:#f92672>=</span>4.21.3,!<span style=color:#f92672>=</span>4.21.4,!<span style=color:#f92672>=</span>4.21.5,&lt;5.0.0dev,&gt;<span style=color:#f92672>=</span>3.19.5, but you<span style=color:#e6db74>&#39;ll have protobuf 3.19.4 which is incompatible.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     Successfully installed CFFI-1.15.1 Cython-0.29.32 PyYAML-6.0 appdirs-1.4.4 attrs-22.1.0 audioread-3.0.0 cycler-0.11.0 dataclasses-0.6 decorator-5.1.1 dill-0.3.6 dm-tree-0.1.7 etils-0.9.0 fire-0.4.0 gin-config-0.5.0 google-api-core-2.10.2 google-api-python-client-2.65.0 google-auth-httplib2-0.1.0 google-cloud-bigquery-3.3.6 google-cloud-bigquery-storage-2.16.2 google-cloud-core-2.3.2 google-crc32c-1.5.0 google-resumable-media-2.4.0 googleapis-common-protos-1.56.4 grpcio-status-1.50.0 httplib2-0.21.0 importlib-resources-5.10.0 joblib-1.2.0 kaggle-1.5.12 kiwisolver-1.4.4 librosa-0.8.1 llvmlite-0.36.0 lxml-4.9.1 matplotlib-3.4.3 neural-structured-learning-1.4.0 numba-0.53.0 opencv-python-headless-4.6.0.66 packaging-20.9 pandas-1.5.1 pillow-9.3.0 pooch-1.6.0 promise-2.3 proto-plus-1.22.1 psutil-5.9.4 py-cpuinfo-9.0.0 pyarrow-10.0.0 pybind11-2.10.1 pycparser-2.21 python-dateutil-2.8.2 python-slugify-6.1.2 pytz-2022.6 resampy-0.4.2 scann-1.2.6 scikit-learn-1.1.3 scipy-1.9.3 sentencepiece-0.1.97 sounddevice-0.4.5 soundfile-0.11.0 tensorflow-2.10.0 tensorflow-addons-0.18.0 tensorflow-datasets-4.7.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tensorflow-model-optimization-0.7.3 tensorflowjs-3.18.0 text-unidecode-1.3 tf-models-official-2.3.0 tf-slim-1.1.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 threadpoolctl-3.1.0 toml-0.10.2 tqdm-4.64.1 typeguard-2.13.3 uritemplate-4.1.1 urllib3-1.25.11
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     WARNING: You are using pip version 20.2.4; however, version 22.3.1 is available.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     You should consider upgrading via the &#39;</span>/usr/bin/python3 -m pip install --upgrade pip<span style=color:#960050;background-color:#1e0010>&#39;</span> command.
</span></span><span style=display:flex><span>     root@566168cfbe3e:/#  
</span></span></code></pre></div></li><li><p>15:47 ok that wasn&rsquo;t terrible.</p></li><li><p>17:56 So per the initial <code>pip freeze</code>, I had <code>tensorflow-cpu==2.10.0</code> and when I tried pip installing <code>tflite-model-maker</code> and among packages ended up getting installed, includes</p><pre tabindex=0><code>scikit-learn-1.1.3
scipy-1.9.3
tensorflow-2.10.0
tensorflow-datasets-4.7.0
tensorflow-hub-0.12.0
tensorflow-metadata-1.11.0
tflite-model-maker-0.4.2
tflite-support-0.4.3
</code></pre><ul><li><p>but I hope this Docker , if it flipped from <code>tensorflow-cpu</code> to <code>tensorflow</code> vanilla, will still work. So when I import <code>tensorflow</code> I get more or less a warning but not an error,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#ae81ff>1</span>]: <span style=color:#f92672>import</span> tensorflow <span style=color:#66d9ef>as</span> tf
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>24.366553</span>: I tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>cpu_feature_guard<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>193</span>] This TensorFlow binary <span style=color:#f92672>is</span> optimized <span style=color:#66d9ef>with</span> oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions <span style=color:#f92672>in</span> performance<span style=color:#f92672>-</span>critical operations:  AVX2 FMA
</span></span><span style=display:flex><span>To enable them <span style=color:#f92672>in</span> other operations, rebuild TensorFlow <span style=color:#66d9ef>with</span> the appropriate compiler flags<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>25.000557</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libcudart.so.11.0&#39;</span>; dlerror: libcudart<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.11.0</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>25.000647</span>: I tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cudart_stub<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>29</span>] Ignore above cudart dlerror <span style=color:#66d9ef>if</span> you do <span style=color:#f92672>not</span> have a GPU set up on your machine<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>25.124265</span>: E tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cuda_blas<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>2981</span>] Unable to register cuBLAS factory: Attempting to register factory <span style=color:#66d9ef>for</span> plugin cuBLAS when one has already been registered
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>27.457123</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libnvinfer.so.7&#39;</span>; dlerror: libnvinfer<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.7</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>27.457399</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libnvinfer_plugin.so.7&#39;</span>; dlerror: libnvinfer_plugin<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.7</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span> <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>27.457462</span>: W tensorflow<span style=color:#f92672>/</span>compiler<span style=color:#f92672>/</span>tf2tensorrt<span style=color:#f92672>/</span>utils<span style=color:#f92672>/</span>py_utils<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>38</span>] TF<span style=color:#f92672>-</span>TRT <span style=color:#a6e22e>Warning</span>: Cannot dlopen some TensorRT libraries<span style=color:#f92672>.</span> If you would like to use Nvidia GPU <span style=color:#66d9ef>with</span> TensorRT, please make sure the missing libraries mentioned above are installed properly<span style=color:#f92672>.</span>
</span></span></code></pre></div></li><li><p>Ah but too good to be true, so ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> tflite_model_maker <span style=color:#f92672>import</span> image_classifier
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ImportError</span>: libusb<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>.</span>so<span style=color:#ae81ff>.0</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span></code></pre></div></li><li><p>Reading the <a href=https://www.tensorflow.org/lite/models/modify/model_maker#installation>https://www.tensorflow.org/lite/models/modify/model_maker#installation</a> information here I am not yet sure is #GPU support required or not .</p></li><li><p>Also read on <a href=https://askubuntu.com/questions/629619/how-to-install-libusb>stackoverflow</a></p><pre tabindex=0><code>apt-get install libusb-1.0-0-dev
</code></pre><p>seems to have worked.</p></li><li><p>18:38 ok well, so next time around, that <code>from tflite_model_maker import image_classifier</code> did not crash. so full input of mine was ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run -it tensorflow/tensorflow bash
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>then ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>apt-get install libusb-1.0-0-dev
</span></span></code></pre></div><p>Next I tried to install the raw dependencies that got installed last time but that threw a weird error about ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ERROR: Double requirement given: google<span style=color:#f92672>==</span>api-python-client-2.65.0 <span style=color:#f92672>(</span>already in google<span style=color:#f92672>==</span>api-core-2.10.2, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;google&#39;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><p>so I ended up upgrading pip, from <code>20.2.4</code> because maybe , <code>version 22.3.1</code> was smarter w/ dependencies?</p><pre tabindex=0><code>python3 -m pip install --upgrade pip
</code></pre><p>Then I tried to again install the full chain of dependencies but I got an error about python 3.7 ,</p><pre tabindex=0><code>ERROR: Ignored the following versions that require a different python version: 0.7 Requires-Python &gt;=3.6, &lt;3.7; 0.8 Requires-Python &gt;=3.6, &lt;3.7
</code></pre><p>so I just went ahead to try <code>tflite-model-maker</code> by itself why not</p><pre tabindex=0><code>pip install tflite-model-maker==0.4.2
</code></pre><p>so the <code>tflite-model-maker</code> installation took maybe 3 minutes.</p><pre tabindex=0><code>ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
tensorflow-cpu 2.10.0 requires keras&lt;2.11,&gt;=2.10.0, but you have keras 2.8.0 which is incompatible.
tensorflow-cpu 2.10.0 requires tensorboard&lt;2.11,&gt;=2.10, but you have tensorboard 2.8.0 which is incompatible.
tensorflow-cpu 2.10.0 requires tensorflow-estimator&lt;2.11,&gt;=2.10.0, but you have tensorflow-estimator 2.8.0 which is incompatible.
Successfully installed CFFI-1.15.1 Cython-0.29.32 PyYAML-6.0 appdirs-1.4.4 attrs-22.1.0 audioread-3.0.0 cycler-0.11.0 dataclasses-0.6 decorator-5.1.1 dill-0.3.6 dm-tree-0.1.7 etils-0.9.0 fire-0.4.0 gin-config-0.5.0 google-api-core-2.10.2 google-api-python-client-2.65.0 google-auth-httplib2-0.1.0 google-cloud-bigquery-3.3.6 google-cloud-bigquery-storage-2.16.2 google-cloud-core-2.3.2 google-crc32c-1.5.0 google-resumable-media-2.4.0 googleapis-common-protos-1.56.4 grpcio-1.50.0 grpcio-status-1.48.2 httplib2-0.21.0 importlib-resources-5.10.0 joblib-1.2.0 kaggle-1.5.12 keras-2.8.0 kiwisolver-1.4.4 librosa-0.8.1 llvmlite-0.36.0 lxml-4.9.1 matplotlib-3.4.3 neural-structured-learning-1.4.0 numba-0.53.0 opencv-python-headless-4.6.0.66 packaging-20.9 pandas-1.5.1 pillow-9.3.0 pooch-1.6.0 promise-2.3 proto-plus-1.22.1 protobuf-3.19.6 psutil-5.9.4 py-cpuinfo-9.0.0 pyarrow-10.0.0 pybind11-2.10.1 pycparser-2.21 python-dateutil-2.8.2 python-slugify-6.1.2 pytz-2022.6 resampy-0.4.2 scann-1.2.6 scikit-learn-1.1.3 scipy-1.9.3 sentencepiece-0.1.97 sounddevice-0.4.5 soundfile-0.11.0 tensorboard-2.8.0 tensorflow-2.8.3 tensorflow-addons-0.18.0 tensorflow-datasets-4.7.0 tensorflow-estimator-2.8.0 tensorflow-hub-0.12.0 tensorflow-metadata-1.11.0 tensorflow-model-optimization-0.7.3 tensorflowjs-3.18.0 text-unidecode-1.3 tf-models-official-2.3.0 tf-slim-1.1.0 tflite-model-maker-0.4.2 tflite-support-0.4.3 threadpoolctl-3.1.0 toml-0.10.2 tqdm-4.64.1 typeguard-2.13.3 uritemplate-4.1.1 urllib3-1.25.11
</code></pre></li><li><p>18:59 ok let me try to run docker now w/ a shared directory , with a <code>Dockerfile</code> , summarizing the above, and I am using from what I can tell, this version but somehow I do not see it on <a href=https://hub.docker.com/r/tensorflow/tensorflow/>https://hub.docker.com/r/tensorflow/tensorflow/</a> , #Docker-hub</p><pre tabindex=0><code>tensorflow/tensorflow   latest    976c17ec6daa   2 months ago    1.46GB
</code></pre><pre tabindex=0><code>FROM tensorflow/tensorflow:latest 

RUN apt-get install -y libusb-1.0-0-dev

RUN python3 -m pip install --upgrade pip

RUN pip install tflite-model-maker==0.4.2

RUN pip install ipython
</code></pre><p>create an image,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker build -t food-not-food -f hmm-docker/Dockerfile hmm-docker 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Building 259.2s <span style=color:#f92672>(</span>9/9<span style=color:#f92672>)</span> FINISHED                                                                                           
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>internal<span style=color:#f92672>]</span> load build definition from Dockerfile                                                                    0.2s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; transferring dockerfile: 228B                                                                                    0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>internal<span style=color:#f92672>]</span> load .dockerignore                                                                                       0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; transferring context: 2B                                                                                         0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>internal<span style=color:#f92672>]</span> load metadata <span style=color:#66d9ef>for</span> docker.io/tensorflow/tensorflow:latest                                                 0.0s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>1/5<span style=color:#f92672>]</span> FROM docker.io/tensorflow/tensorflow                                                                          0.1s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>2/5<span style=color:#f92672>]</span> RUN apt-get install -y libusb-1.0-0-dev                                                                       3.9s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>3/5<span style=color:#f92672>]</span> RUN python3 -m pip install --upgrade pip                                                                      3.7s
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>4/5<span style=color:#f92672>]</span> RUN pip install tflite-model-maker<span style=color:#f92672>==</span>0.4.2                                                                   219.6s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span>5/5<span style=color:#f92672>]</span> RUN pip install ipython                                                                                       8.4s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; exporting to image                                                                                                 23.5s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; exporting layers                                                                                                23.4s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; writing image sha256:dc8e469de66a5e8e9d91b4fc971a7cc9ff8ba9f2ed04e395e182e472a237c526                            0.1s 
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>=</span>&gt; naming to docker.io/library/food-not-food                                                                        0.0s 
</span></span></code></pre></div><p>And run it , per my handy notes , <a href=https://github.com/namoopsoo/handy/blob/master/Docker/hmm.md>https://github.com/namoopsoo/handy/blob/master/Docker/hmm.md</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd ~/Dropbox/Code/repo/food-not-food
</span></span><span style=display:flex><span>docker run -i -t -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>:/home <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -v ~/Dropbox/Code/repo/data/101_food_classes_all_data:/mnt/101_food_classes_all_data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    food-not-food
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># docker run -it tensorflow/tensorflow bash</span>
</span></span></code></pre></div></li><li></li></ul></li><li><p>18:19 Since the installation basically worked in Docker at least,</p></li><li><p>17:50 so let me see, can I run the model training script ?</p></li></ul></li><li><p>Next downloading the data ok ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>/</span>Users<span style=color:#f92672>/</span>michal<span style=color:#f92672>/</span>Dropbox<span style=color:#f92672>/</span>Code<span style=color:#f92672>/</span>repo<span style=color:#f92672>/</span>food<span style=color:#f92672>-</span><span style=color:#f92672>not</span><span style=color:#f92672>-</span>food
</span></span><span style=display:flex><span>(dedupe) (base) <span style=color:#960050;background-color:#1e0010>$</span> python data_download<span style=color:#f92672>/</span>download_food101<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span><span style=color:#ae81ff>101</span>_food_classes_all_data<span style=color:#f92672>.</span>zip: <span style=color:#ae81ff>100</span><span style=color:#f92672>%|</span><span style=color:#960050;background-color:#1e0010>█████████████████████</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>4.67</span>G<span style=color:#f92672>/</span><span style=color:#ae81ff>4.67</span>G [<span style=color:#ae81ff>06</span>:<span style=color:#ae81ff>07</span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>, <span style=color:#ae81ff>13.6</span>MiB<span style=color:#f92672>/</span>s]
</span></span><span style=display:flex><span>[INFO] Food101 downloaded, unzipping<span style=color:#f92672>...</span>
</span></span></code></pre></div></li><li><p>20:04 So I kind of lazily ended up doing this</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>2</span>]: <span style=color:#f92672>from</span> pathlib <span style=color:#f92672>import</span> Path
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: <span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> date
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: <span style=color:#f92672>from</span> tflite_model_maker <span style=color:#f92672>import</span> image_classifier
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: <span style=color:#f92672>from</span> tflite_model_maker.image_classifier <span style=color:#f92672>import</span> DataLoader
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>3</span>]: train_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/train/apple_pie&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>4</span>]: test_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/test/apple_pie&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>5</span>]: train_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(train_data_path)
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: test_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(test_data_path)
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: 
</span></span><span style=display:flex><span><span style=color:#f92672>---------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ValueError</span>                                Traceback (most recent call last)
</span></span><span style=display:flex><span>Cell In [<span style=color:#ae81ff>5</span>], line <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>----&gt;</span> <span style=color:#ae81ff>1</span> train_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(train_data_path)
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> test_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(test_data_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>File <span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>local<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#ae81ff>.8</span><span style=color:#f92672>/</span>dist<span style=color:#f92672>-</span>packages<span style=color:#f92672>/</span>tensorflow_examples<span style=color:#f92672>/</span>lite<span style=color:#f92672>/</span>model_maker<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>data_util<span style=color:#f92672>/</span>image_dataloader<span style=color:#f92672>.</span>py:<span style=color:#ae81ff>73</span>, <span style=color:#f92672>in</span> ImageClassifierDataLoader<span style=color:#f92672>.</span>from_folder(cls, filename, shuffle)
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>71</span> all_image_size <span style=color:#f92672>=</span> len(all_image_paths)
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>72</span> <span style=color:#66d9ef>if</span> all_image_size <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>---&gt;</span> <span style=color:#ae81ff>73</span>   <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#39;Image size is zero&#39;</span>)
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>75</span> <span style=color:#66d9ef>if</span> shuffle:
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>76</span>   <span style=color:#75715e># Random shuffle data.</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>77</span>   random<span style=color:#f92672>.</span>shuffle(all_image_paths)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ValueError</span>: Image size <span style=color:#f92672>is</span> zero
</span></span></code></pre></div><p>and I think the error was because a certain directory structure is expected.</p><p>So I did this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/train/apple_pie/* ../data/101_food_classes_all_data/small/train/apple_pie
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ du -d <span style=color:#ae81ff>0</span> -h ../data/101_food_classes_all_data/small/train/apple_pie
</span></span><span style=display:flex><span> 36M	../data/101_food_classes_all_data/small/train/apple_pie
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/test/apple_pie/* ../data/101_food_classes_all_data/small/test/apple_pie/
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ 
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/test/churros/* ../data/101_food_classes_all_data/small/test/not_apple_pie/
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ cp  ../data/101_food_classes_all_data/train/churros/* ../data/101_food_classes_all_data/small/train/not_apple_pie/
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>base<span style=color:#f92672>)</span> $ 
</span></span></code></pre></div></li><li><p>20:06 ok does that help?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/small/train&#34;</span>
</span></span><span style=display:flex><span>test_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/small/test&#34;</span>
</span></span><span style=display:flex><span>train_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(train_data_path)
</span></span><span style=display:flex><span>test_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(test_data_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.543996</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>default<span style=color:#f92672>/</span>dso_loader<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>64</span>] Could <span style=color:#f92672>not</span> load dynamic library <span style=color:#e6db74>&#39;libcuda.so.1&#39;</span>; dlerror: libcuda<span style=color:#f92672>.</span>so<span style=color:#ae81ff>.1</span>: cannot open shared object file: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.545031</span>: W tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cuda_driver<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>269</span>] failed call to cuInit: UNKNOWN ERROR (<span style=color:#ae81ff>303</span>)
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.546377</span>: I tensorflow<span style=color:#f92672>/</span>stream_executor<span style=color:#f92672>/</span>cuda<span style=color:#f92672>/</span>cuda_diagnostics<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>156</span>] kernel driver does <span style=color:#f92672>not</span> appear to be running on this host (a4d9f933dc4f): <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>driver<span style=color:#f92672>/</span>nvidia<span style=color:#f92672>/</span>version does <span style=color:#f92672>not</span> exist
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>49.561325</span>: I tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>platform<span style=color:#f92672>/</span>cpu_feature_guard<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>151</span>] This TensorFlow binary <span style=color:#f92672>is</span> optimized <span style=color:#66d9ef>with</span> oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions <span style=color:#f92672>in</span> performance<span style=color:#f92672>-</span>critical operations:  AVX2 FMA
</span></span><span style=display:flex><span>To enable them <span style=color:#f92672>in</span> other operations, rebuild TensorFlow <span style=color:#66d9ef>with</span> the appropriate compiler flags<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Load image <span style=color:#66d9ef>with</span> size: <span style=color:#ae81ff>1500</span>, num_label: <span style=color:#ae81ff>2</span>, labels: apple_pie, not_apple_pie<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Load image <span style=color:#66d9ef>with</span> size: <span style=color:#ae81ff>500</span>, num_label: <span style=color:#ae81ff>2</span>, labels: apple_pie, not_apple_pie<span style=color:#f92672>.</span>
</span></span></code></pre></div></li><li><p>ok so that was the correct folder structure cool, but hopefully the other #GPU cuda errors don&rsquo;t hold me back. Let&rsquo;s find out</p></li><li><p>20:10 ok,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>NUM_EPOCHS <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>MODEL_SPEC <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;efficientnet_lite0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create model</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Creating and training model...&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Training </span><span style=color:#e6db74>{</span>MODEL_SPEC<span style=color:#e6db74>}</span><span style=color:#e6db74> for </span><span style=color:#e6db74>{</span>NUM_EPOCHS<span style=color:#e6db74>}</span><span style=color:#e6db74> epochs...&#34;</span>)
</span></span><span style=display:flex><span>model <span style=color:#f92672>=</span> image_classifier<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>    train_data<span style=color:#f92672>=</span>train_data,
</span></span><span style=display:flex><span>    model_spec<span style=color:#f92672>=</span>MODEL_SPEC,
</span></span><span style=display:flex><span>    epochs<span style=color:#f92672>=</span>NUM_EPOCHS,
</span></span><span style=display:flex><span>    use_augmentation<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[INFO] Creating <span style=color:#f92672>and</span> training model<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>[INFO] Training efficientnet_lite0 <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>1</span> epochs<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Retraining the models<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>Model: <span style=color:#e6db74>&#34;sequential&#34;</span>
</span></span><span style=display:flex><span>_________________________________________________________________
</span></span><span style=display:flex><span> Layer (type)                Output Shape              Param <span style=color:#75715e>#   </span>
</span></span><span style=display:flex><span><span style=color:#f92672>=================================================================</span>
</span></span><span style=display:flex><span> hub_keras_layer_v1v2 (HubKe  (<span style=color:#66d9ef>None</span>, <span style=color:#ae81ff>1280</span>)             <span style=color:#ae81ff>3413024</span>   
</span></span><span style=display:flex><span> rasLayerV1V2)                                                   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> dropout (Dropout)           (<span style=color:#66d9ef>None</span>, <span style=color:#ae81ff>1280</span>)              <span style=color:#ae81ff>0</span>         
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> dense (Dense)               (<span style=color:#66d9ef>None</span>, <span style=color:#ae81ff>2</span>)                 <span style=color:#ae81ff>2562</span>      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>=================================================================</span>
</span></span><span style=display:flex><span>Total params: <span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>415</span>,<span style=color:#ae81ff>586</span>
</span></span><span style=display:flex><span>Trainable params: <span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>562</span>
</span></span><span style=display:flex><span>Non<span style=color:#f92672>-</span>trainable params: <span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>413</span>,<span style=color:#ae81ff>024</span>
</span></span><span style=display:flex><span>_________________________________________________________________
</span></span><span style=display:flex><span><span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use default resize_bicubic<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use default resize_bicubic<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.077741</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>19267584</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.350836</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>19267584</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.357610</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>51380224</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.718472</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>19267584</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>-</span><span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>34.887098</span>: W tensorflow<span style=color:#f92672>/</span>core<span style=color:#f92672>/</span>framework<span style=color:#f92672>/</span>cpu_allocator_impl<span style=color:#f92672>.</span>cc:<span style=color:#ae81ff>82</span>] Allocation of <span style=color:#ae81ff>51380224</span> exceeds <span style=color:#ae81ff>10</span><span style=color:#f92672>%</span> of free system memory<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>46</span><span style=color:#f92672>/</span><span style=color:#ae81ff>46</span> [<span style=color:#f92672>==============================</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>48</span>s <span style=color:#ae81ff>963</span>ms<span style=color:#f92672>/</span>step <span style=color:#f92672>-</span> loss: <span style=color:#ae81ff>0.4440</span> <span style=color:#f92672>-</span> accuracy: <span style=color:#ae81ff>0.8274</span>
</span></span></code></pre></div></li><li><p>ok wow that did something without crashing. nice. Will the testing work?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_loss, test_accuracy <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>evaluate(test_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span>INFO:tensorflow:Use customized resize method bilinear
</span></span><span style=display:flex><span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span> [<span style=color:#f92672>==============================</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>22</span>s <span style=color:#ae81ff>1</span>s<span style=color:#f92672>/</span>step <span style=color:#f92672>-</span> loss: <span style=color:#ae81ff>0.3070</span> <span style=color:#f92672>-</span> accuracy: <span style=color:#ae81ff>0.9540</span>
</span></span></code></pre></div></li><li><p>22:22 ok and let&rsquo;s see how do I run this on unlabeled data then ?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> date
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>current_date <span style=color:#f92672>=</span> str(date<span style=color:#f92672>.</span>today())
</span></span><span style=display:flex><span>model_number <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>export_dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/home/models&#34;</span>
</span></span><span style=display:flex><span>model_save_path <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    Path(export_dir) 
</span></span><span style=display:flex><span>    <span style=color:#f92672>/</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>current_date<span style=color:#e6db74>}</span><span style=color:#e6db74>_apple_pie_or_churro_model_</span><span style=color:#e6db74>{</span>MODEL_SPEC<span style=color:#e6db74>}</span><span style=color:#e6db74>_v</span><span style=color:#e6db74>{</span>model_number<span style=color:#e6db74>}</span><span style=color:#e6db74>.tflite&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Saving the model to &#39;</span><span style=color:#e6db74>{</span>export_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; directory as &#39;</span><span style=color:#e6db74>{</span>model_save_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;...&#34;</span>)
</span></span><span style=display:flex><span>model<span style=color:#f92672>.</span>export(export_dir<span style=color:#f92672>=</span>export_dir, tflite_filename<span style=color:#f92672>=</span>model_save_path)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[INFO] Model saved to: &#39;</span><span style=color:#e6db74>{</span>model_save_path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;.&#34;</span>)
</span></span></code></pre></div><p>Ok that took a minute or two</p><pre tabindex=0><code>[INFO] Saving the model to &#39;/home/models&#39; directory as &#39;/home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite&#39;...
INFO:tensorflow:Use customized resize method bilinear
INFO:tensorflow:Use customized resize method bilinear
2022-11-13 03:37:29.984575: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.
INFO:tensorflow:Assets written to: /tmp/tmpodz47y2g/assets
INFO:tensorflow:Assets written to: /tmp/tmpodz47y2g/assets
2022-11-13 03:37:35.785772: I tensorflow/core/grappler/devices.cc:66] Number of eligible GPUs (core count &gt;= 8, compute capability &gt;= 0.0): 0
2022-11-13 03:37:35.787503: I tensorflow/core/grappler/clusters/single_machine.cc:358] Starting new session
2022-11-13 03:37:35.864717: I tensorflow/core/grappler/optimizers/meta_optimizer.cc:1164] Optimization results for grappler item: graph_to_optimize
  function_optimizer: Graph size after: 913 nodes (656), 923 edges (664), time = 35.413ms.
  function_optimizer: function_optimizer did nothing. time = 0.888ms.

/usr/local/lib/python3.8/dist-packages/tensorflow/lite/python/convert.py:746: UserWarning: Statistics for quantized inputs were expected, but not specified; continuing anyway.
  warnings.warn(&#34;Statistics for quantized inputs were expected, but not &#34;
2022-11-13 03:37:37.252870: W tensorflow/compiler/mlir/lite/python/tf_tfl_flatbuffer_helpers.cc:357] Ignored output_format.
2022-11-13 03:37:37.253120: W tensorflow/compiler/mlir/lite/python/tf_tfl_flatbuffer_helpers.cc:360] Ignored drop_control_dependency.

fully_quantize: 0, inference_type: 6, input_inference_type: 3, output_inference_type: 3
INFO:tensorflow:Label file is inside the TFLite model with metadata.
INFO:tensorflow:Label file is inside the TFLite model with metadata.
INFO:tensorflow:Saving labels in /tmp/tmpmy_t1d99/labels.txt
INFO:tensorflow:Saving labels in /tmp/tmpmy_t1d99/labels.txt
INFO:tensorflow:TensorFlow Lite model exported successfully: /home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite
INFO:tensorflow:TensorFlow Lite model exported successfully: /home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite
[INFO] Model saved to: &#39;/home/models/2022-11-13_apple_pie_or_churro_model_efficientnet_lite0_v1.tflite&#39;.
</code></pre><p>And reading on here, <a href=https://www.tensorflow.org/lite/models/modify/model_maker/image_classification>https://www.tensorflow.org/lite/models/modify/model_maker/image_classification</a> that you can also evaluate data like ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>model<span style=color:#f92672>.</span>evaluate_tflite(<span style=color:#e6db74>&#39;model.tflite&#39;</span>, test_data)
</span></span></code></pre></div><p>but yea still looking for how do I create unlabeled dataset?</p></li><li><p>Also reading on <a href=https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker/image_classifier/DataLoader>https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker/image_classifier/DataLoader</a> that the data passed in to <code>DataLoader</code> can also be a <code>tf.data.Dataset</code> ,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>tflite_model_maker<span style=color:#f92672>.</span>image_classifier<span style=color:#f92672>.</span>DataLoader(
</span></span><span style=display:flex><span>    dataset, size, index_to_label
</span></span><span style=display:flex><span>)
</span></span></code></pre></div></li><li><p>23:03 also reading on <a href=https://www.tensorflow.org/lite/api_docs/python/tf/lite/Interpreter>https://www.tensorflow.org/lite/api_docs/python/tf/lite/Interpreter</a> here that not only can you convert a regular tensorflow model to the tensorflow lite format you also need to allocate tensors before using it,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>interpreter <span style=color:#f92672>=</span> tf<span style=color:#f92672>.</span>lite<span style=color:#f92672>.</span>Interpreter(model_content<span style=color:#f92672>=</span>tflite_model)
</span></span><span style=display:flex><span>interpreter<span style=color:#f92672>.</span>allocate_tensors()  <span style=color:#75715e># Needed before execution!</span>
</span></span></code></pre></div></li><li><p>lets try whatever,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>unlabeled_data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/mnt/101_food_classes_all_data/small/unlabeled/&#34;</span>
</span></span><span style=display:flex><span>unlabeled_data <span style=color:#f92672>=</span> DataLoader<span style=color:#f92672>.</span>from_folder(unlabeled_data_path)
</span></span></code></pre></div></li></ul></li></ul><ul class=pa0><li class=list><a href=/tags/docker class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">docker</a></li><li class=list><a href=/tags/tensorflow class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">tensorflow</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://michal.piekarczyk.xyz/>&copy; My blog 2023</a><div></div></div></footer></body></html>