<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Notes from a recent hackathon | michal.piekarczyk.xyz</title><meta name=keywords content><meta name=description content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."><meta name=author content="Michal Piekarczyk"><link rel=canonical href=https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/><link crossorigin=anonymous href=/assets/css/stylesheet.dd867d536fb6202811c1ee15fa181ef8945826662b49d3016ac91365a2621d58.css integrity="sha256-3YZ9U2+2ICgRwe4V+hge+JRYJmYrSdMBaskTZaJiHVg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://michal.piekarczyk.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michal.piekarczyk.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michal.piekarczyk.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://michal.piekarczyk.xyz/apple-touch-icon.png><link rel=mask-icon href=https://michal.piekarczyk.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-74MK08REDT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74MK08REDT",{anonymize_ip:!1})}</script><meta property="og:title" content="Notes from a recent hackathon"><meta property="og:description" content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-02-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-05T00:00:00+00:00"><meta property="og:site_name" content="michal.piekarczyk.xyz"><meta name=twitter:card content="summary"><meta name=twitter:title content="Notes from a recent hackathon"><meta name=twitter:description content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michal.piekarczyk.xyz/post/"},{"@type":"ListItem","position":2,"name":"Notes from a recent hackathon","item":"https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Notes from a recent hackathon","name":"Notes from a recent hackathon","description":"Spending a few spare moments to summarize some of my thought processes from a recent hackathon.\nWhat is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.\nPlan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document.","keywords":[],"articleBody":"Spending a few spare moments to summarize some of my thought processes from a recent hackathon.\nWhat is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.\nPlan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document. We ended up starting out with this public facing document, which one can seee a description of here with its download link https://content.sunfirematrix.com/2023/Humana-H1036-236-000-SB-EN-2023-SF20220922.pdf .\nMy thought around structured data Hackathons are always very time crunch like environments. I very much wanted us to have at least a minimal end to end demo in our back pocket just in case our additional progress does not pan out.\nSo on the first night, I had this hunch, that the value we can get from our public facing document, would be highest, with additional preprocessing, turning the raw text from this document into full enlish sentences, as opposed to the incomplete English in the document, and also to capture some of the inferred structural connections which are easy to see when visually inspecting, but cannot be captured easily by a raw text dump from the pdf, because perhaps at least the initial pdf to text extraction which we used did not capture this structure.\nOne quick example of this, For instance, here are two tables from the pdf document, that describe the “Mail Order Cost-Sharing” and the “Retail Cost-Sharing” options for prescription drug benefits\nAt the outset I handrewrote this as the following clauses\nThis plan has Prescription Drug Benefits . Here is information about what You Pay for Vaccines . Our plan covers most Part D vaccines at no cost to you, no matter what cost-sharing tier it’s on . Here is information about What You Pay for Insulin . You won’t pay more than $35 for a one-month (up to 30-day) supply of each Part D insulin product covered by our plan, no matter what cost-sharing tier it’s on . This applies to all Part D covered insulins, including the Select Insulins covered under the Insulin Savings Program as described below. What you pay for prescription drugs depends on whether you receive \"Extra Help\" or not. If you receive \"Extra Help\", you will still pay no more than $35 for a one-month supply for each Part D covered insulin. Please see your Prescription Drug Guide to find all Part D insulins covered by your plan. This plan does not have a deductible for prescription drugs. If you don't receive Extra Help for your drugs, you'll pay a different amount based on the type of cost-sharing option you use. For the Initial coverage, you are responsible to pay for a 30-day supply or a 90-day supply the amount based on the tier of the prescription drug. A prescription drug can be either in tier 1 preferred generic, tier 2 generic, tier 3 preferred brand, tier 4 non-preferred drug, or tier 5 specialty tier. You are responsible to pay for prescription drugs until the total yearly drug costs reach $4,660 . The total yearly drug costs are the total drug costs paid by both you and our plan. Once you reach this amount, you will enter the Coverage Gap. There are two different kinds of cost-sharing for prescription drugs, including Mail Order Cost-Sharing and Retail Cost-Sharing. There are two different kinds of Mail Order pharmacy options, Standard and Preferred. The Mail order pharmacy option called Standard includes Walmart Mail, PillPack and other pharmacies that are also available in our network. To find pharmacy mail order options go to Humana.com/pharmacyfinder . The second type of mail order pharmacy option is the Preferred pharmacy option, which includes only the CenterWell Pharmacy. For the Standard Mail order pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $10 and the 90-day supply costs $30. For the Standard Mail order pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $20 and the 90-day supply costs $60. For the Standard Mail order pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $47 and the 90-day supply costs $141. For the Standard Mail order pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $300. For the Standard Mail order pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available. For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0. For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0. For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $42 and the 90-day supply costs $116. For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $290. For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available. The other kind of prescription drug cost sharing is called Retail Cost-Sharing, which means that you can physically go to the pharmacy. You can go to any network retail pharmacy. To find the retail pharmacies near you, go to Humana.com/pharmacyfinder For the retail pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0. For the retail pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0. For the retail pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $42 and the 90-day supply costs $116. For the retail pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $300. For the retail pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available. Maybe there are really good libraries for inferring the generically inferring the tabular structure , but at least for the time being I really wanted to constrain the problem a bit more since my brain was in hackathon mode haha 😅\nA fully end to end version 1 demo So the day before I had already proven to myself, that the #langchain LLMChain class is really good at having a targeted conversation framed around some kind of small talk, with the use of a prompt that provides the focus. Also , earlier, I had shown myself just how quickly haha, no, instantaneously, you can use #langchain to embed a targeted bit of text, a section of a magazine article in my case, and run question answering based on this.\nI have not tried it yet but langchain also has the concept of an agent, which can compartmentalize separate functionality, say for engaging in small talk and separately for answering questions on an insurance plan document.\nAlready having some components already working in front of me, I wanted to at least first build a super simple demo, more or less jamming together the small talk prompts I had explored earlier with the document focused question answering.\nI ended up with something like this from langchain import OpenAI, ConversationChain, LLMChain, PromptTemplate from langchain.chains.conversation.memory import ConversationalBufferWindowMemory from langchain import PromptTemplate name_of_person = \"Alfred Jamesmanson\" real_person_prompt = f\"\"\" Assistant is uses friendly and helpful language. Assistant loves making new friends. If at any time {name_of_person} asks to talk with a real person that {name_of_person} should only ask and they will be connected to a real person. Assistant will remind {name_of_person} that they can connect to speak to a real person whenever they would like that. If {name_of_person} asks to talk to a real person then Assistant will let {name_of_person} know they will be connected to talk to a real person right away. \"\"\" person_details = f\"\"\" Assistant is designed to talk to {name_of_person} and answer their questions. {name_of_person} lives in Dallas Texas. {name_of_person} was born in Keywest Florida on January 2nd 1990. {name_of_person} goes to college. {name_of_person} studies electrical engineering. {name_of_person} is friends with Kelly Robin, Jesse Lambourghini and Jackson Loggin. {name_of_person} has brown hair. \"\"\" filename = \"summary-of-benefits-paragraphs.txt\" with open(filename) as f: document_text = f.read() len_doc = len(document_text ) print(\"len doc is \", len_doc) document_text = document_text[:(len_doc//2)] base_template = f\"\"\"Assistant is a large language model trained by OpenAI. {person_details} {real_person_prompt} {document_text} Assistant is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics. {name_of_person}:\"\"\" template = base_template + \"\"\" {human_input} Assistant: \"\"\" prompt = PromptTemplate( input_variables=[\"human_input\"], template=template ) chatgpt_chain = LLMChain( llm=OpenAI(temperature=0), prompt=prompt, verbose=True, memory=ConversationalBufferWindowMemory(k=3), ) human_input = \"Hi my name is Alfred Jamesmanson. I need your help Assistant. What color is my hair?\" while True: human_input = input(\": \") output = chatgpt_chain.predict( human_input=human_input, ) print(output) And I ended up, above, cutting the document in half, because my prompt had too many tokens looks like. Traceback (most recent call last): File \"/Users/michal/Dropbox/Code/repo/our-hack-qa/dumb-friendly.py\", line 63, in \u003cmodule\u003e output = chatgpt_chain.predict( File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py\", line 102, in predict return self(kwargs)[self.output_key] File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/base.py\", line 155, in __call__ raise e File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/base.py\", line 152, in __call__ outputs = self._call(inputs) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py\", line 86, in _call return self.apply([inputs])[0] File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py\", line 77, in apply response = self.generate(input_list) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py\", line 72, in generate response = self.llm.generate(prompts, stop=stop) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/base.py\", line 79, in generate raise e File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/base.py\", line 76, in generate output = self._generate(prompts, stop=stop) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/openai.py\", line 158, in _generate response = self.client.create(prompt=_prompts, **params) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_resources/completion.py\", line 25, in create return super().create(*args, **kwargs) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py\", line 153, in create response, _, api_key = requestor.request( File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py\", line 227, in request resp, got_stream = self._interpret_response(result, stream) File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py\", line 620, in _interpret_response self._interpret_response_line( File \"/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py\", line 680, in _interpret_response_line raise self.handle_error_response( openai.error.InvalidRequestError: This model's maximum context length is 4097 tokens, however you requested 6578 tokens (6322 in your prompt; 256 for the completion). Please reduce your prompt; or completion length. I would like to understand these limitations a bit better and also how to get around then at a later point ! conversation 1 : hello there \u003e Finished chain. Hi there! How can I help you? : can I talk to a real person? \u003e Finished chain. Yes, of course! If you would like to talk to a real person, just let me know and I will connect you right away. : can you please connect me with a real person? \u003e Finished chain. Of course! I can connect you with a real person right away. Please hold while I connect you. Trying out the real person part of the prompt. Actually initially I thought it was not working but then clearly confirmation was just requested.\nSo I wonder if that langchain agent can somehow help to route this conversation along to a human at this point.\nContinuing that one,\n: so by the way how is your day going so far? \u003e Finished chain. Hi Alfred Jamesmanson! My day is going great so far. I'm learning a lot and having a lot of fun. How about you? : I'm good. I wanted to know what is my mamogram copay? \u003e Finished chain. For Diagnostic mammography there is a $0 to $15 copay. : Ah thanks and what are my pharmacy options available to me? \u003e Finished chain. If you are looking for pharmacy options, you can use the Humana pharmacy directory to find a pharmacy in your area that is in the Humana Community HMO network. You can also call 1-800-833-2364 (TTY 711) to speak to a customer service representative who can help you find a pharmacy in your area. : what does a retail pharmacy mean? \u003e Finished chain. A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in stores, supermarkets, or other public locations, and are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the safe and effective use of medications. : what is the name of my plan again? \u003e Finished chain. Your plan is called Humana Community HMO H1036-236. : what is my hospital benefit? \u003e Finished chain. Your plan covers an unlimited number of days for an inpatient stay. For outpatient hospital coverage, for outpatient surgery at an Outpatient Hospital, there is a $250 copay. For emergency room care, the copay is $110. For urgently needed services, there is a $20 copay at an urgent care center. For Medicare-covered dental services, there is a $15 copay. For Medicare-covered vision services, there is a $15 copay. For Medicare-covered diabetic eye exam, there is a $0 copay. For Medicare-covered glaucoma screening, there is a $0 copay. For Medicare-covered eyewear that is post-cataract, there is a $0 copay. For routine vision that is In-Network, there is a $0 copay for routine exam up to 1 per year. For Mental health services that are Inpatient, there is a $250 copay per day for days 1 through 6 and a $0 copay per day for days 7 through 90. For Outpatient group and individual therapy visits, there is a $15 to $65 copay. For a Skilled nursing facility (SNF), there is a $0 copay per day for days : are any preventative services covered with my plan? \u003e Finished chain. Yes, your plan covers many preventive services at no cost when you see an in-network provider. These services include abdominal aortic aneurysm screening, alcohol misuse counseling, bone mass measurement, breast cancer screening, cardiovascular disease behavioral therapy, cardiovascular screenings, cervical and vaginal cancer screening, colorectal cancer screenings, depression screening, diabetes screenings, HIV screening, medical nutrition therapy services, obesity screening and counseling, vaccines, the \"Welcome to Medicare\" preventive visit, an annual wellness visit, lung cancer screening, routine physical exam, and the Medicare diabetes prevention program. Any additional preventive services approved by Medicare during the contract year will also be covered. : how much should I have to pay for tier 1 prescription drugs? \u003e Finished chain. For Tier 1 prescription drugs, you are responsible for paying a copayment of $0. This applies to both generic and brand name drugs. : how about tier 2 drugs? what would I pay? \u003e Finished chain. For Tier 2 drugs, you are responsible for 25% of the cost. : for tier 2 drugs how much is it for a 90 day supply? \u003e Finished chain. For tier 2 drugs, you are responsible for 25% of the cost for a 90 day supply. : what emergency services copay do i need to pay? \u003e Finished chain. For emergency care, the copay is $110. If you are admitted to the hospital within 24 hours, you do not have to pay your share of the cost for the emergency care. Urgently needed services have a $20 copay at an urgent care center. Another one : hi how are you \u003e Finished chain. Hi Alfred Jamesmanson! I'm doing great, how about you? : how much is my copay for a mamogram? \u003e Finished chain. For Diagnostic mammography there is a $0 to $15 copay. : what is a retail pharmacy? \u003e Finished chain. A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in grocery stores, drug stores, and other retail outlets. They are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the proper use of medications. : what is the name of my plan? \u003e Finished chain. Your plan is called Humana Community HMO H1036-236. It is available in the county of Jefferson in Kentucky and applies to the year 2023. : where is my plan avaialble? \u003e Finished chain. Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. You can find more information about the plan on Humana.com/medicare or by calling 1-800-833-2364 (TTY 711). : can i talk to a real person please? \u003e Finished chain. Of course! I can connect you to a real person right away. Just let me know when you're ready and I'll get you connected. : yes I am ready. \u003e Finished chain. Great! What can I help you with? So this was an important ending my teammate asked me to write that last part, “yes I am ready” to see if memory held up and in this case clearly it did not haha!\nOne more : hi how are you \u003e Finished chain. Hi Alfred Jamesmanson! I'm doing great, how about you? : how much is my copay for a mamogram? \u003e Finished chain. For Diagnostic mammography there is a $0 to $15 copay. : what is a retail pharmacy? \u003e Finished chain. A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in grocery stores, drug stores, and other retail outlets. They are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the proper use of medications. : what is the name of my plan? \u003e Finished chain. Your plan is called Humana Community HMO H1036-236. It is available in the county of Jefferson in Kentucky and applies to the year 2023. : where is my plan avaialble? \u003e Finished chain. Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. You can find more information about the plan on Humana.com/medicare or by calling 1-800-833-2364 (TTY 711). : can i talk to a real person please? \u003e Finished chain. Of course! I can connect you to a real person right away. Just let me know when you're ready and I'll get you connected. : yes I am ready. \u003e Finished chain. Great! What can I help you with? : what are my emergency room copay? \u003e Finished chain. Your Emergency room copay is $110. If you are admitted to the hospital within 24 hours, you do not have to pay your share of the cost for the emergency care. Anolther (langchainz) (base) $ python dumb-friendly.py len doc is 25318 : hi how is going \u003e Finished chain. Hi Alfred Jamesmanson! How can I help you? : how is your day so far \u003e Finished chain. Hi Alfred Jamesmanson! My day has been going great so far. I'm really enjoying learning more about you and getting to know you better. How about you? : I would like to know about my plan with humana \u003e Finished chain. Sure, Alfred Jamesmanson. Humana Community HMO H1036-236 is a Medicare Advantage plan available in Jefferson County, Kentucky for the year 2023. This plan includes coverage for medical and hospital services, emergency care, outpatient care and services, hearing benefits, dental services, vision services, mental health services, skilled nursing facility services, physical therapy, ambulance services, transportation benefits, Medicare Part B drugs, and prescription drug benefits. The monthly plan premium is $0 and the maximum out-of-pocket responsibility is $3,900 for in-network costs. For more information, please visit Humana.com/medicare or call 1-800-833-2364 (TTY 711). : where is my plan available? \u003e Finished chain. Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. : what is my copay in the emergency room? \u003e Finished chain. Your copay for emergency room services is $110. : what kinds of prescription drugs can I use? \u003e Finished chain. Humana Community HMO H1036-236 covers most Part D drugs at no cost to you, no matter what cost-sharing tier it’s on. Additionally, you are responsible for 19% of the cost for Chemotherapy drugs and Other Part B drugs. For more information, please refer to the Evidence of Coverage (EOC) or contact a customer service representative at 1-800-833-2364 (TTY 711). : where can I find a pharmacy ? \u003e Finished chain. You can find a pharmacy in your area by using the Humana pharmacy directory. You can access the directory online at Humana.com/medicare or by calling 1-800-833-2364 (TTY 711). : ahh I am just so frustrated can you please help me? \u003e Finished chain. I'm sorry to hear that you're feeling frustrated. Is there anything specific I can help you with? I like that last bit at the end about responding to frustration.\nI am curious to better understand just how much structure is helpful around the contextual document that is provided. Running some tests would be a cool exercise at some point.\n","wordCount":"3519","inLanguage":"en","datePublished":"2023-02-05T00:00:00Z","dateModified":"2023-02-05T00:00:00Z","author":{"@type":"Person","name":"Michal Piekarczyk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/"},"publisher":{"@type":"Organization","name":"michal.piekarczyk.xyz","logo":{"@type":"ImageObject","url":"https://michal.piekarczyk.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michal.piekarczyk.xyz/ accesskey=h title="michal.piekarczyk.xyz (Alt + H)">michal.piekarczyk.xyz</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michal.piekarczyk.xyz/post/ title=posts><span>posts</span></a></li><li><a href=https://michal.piekarczyk.xyz/project/ title=projects><span>projects</span></a></li><li><a href=https://michal.piekarczyk.xyz/handy/ title=handy><span>handy</span></a></li><li><a href=https://michal.piekarczyk.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://michal.piekarczyk.xyz/about/ title=about><span>about</span></a></li><li><a href=https://world.hey.com/michal.piekarczyk title=frivolity><span>frivolity</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://michal.piekarczyk.xyz/>Home</a>&nbsp;»&nbsp;<a href=https://michal.piekarczyk.xyz/post/>Posts</a></div><h1 class=post-title>Notes from a recent hackathon</h1><div class=post-meta><span title='2023-02-05 00:00:00 +0000 UTC'>5055-05-512</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;3519 words&nbsp;·&nbsp;Michal Piekarczyk</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#what-is-all-this>What is all this</a></li><li><a href=#plan-of-action>Plan of action</a></li><li><a href=#my-thought-around-structured-data>My thought around structured data</a></li><li><a href=#a-fully-end-to-end-version-1-demo>A fully end to end version 1 demo</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Spending a few spare moments to summarize some of my thought processes from a recent hackathon.</p><h3 id=what-is-all-this>What is all this<a hidden class=anchor aria-hidden=true href=#what-is-all-this>#</a></h3><p>So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.</p><h3 id=plan-of-action>Plan of action<a hidden class=anchor aria-hidden=true href=#plan-of-action>#</a></h3><p>So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document. We ended up starting out with this public facing document, which one can seee a description of <a href=https://www.medicareadvantage.com/plans/humana-community-hmo-h1036-236-000>here</a> with its download link <a href=here>https://content.sunfirematrix.com/2023/Humana-H1036-236-000-SB-EN-2023-SF20220922.pdf</a> .</p><h3 id=my-thought-around-structured-data>My thought around structured data<a hidden class=anchor aria-hidden=true href=#my-thought-around-structured-data>#</a></h3><p>Hackathons are always very time crunch like environments. I very much wanted us to have at least a minimal end to end demo in our back pocket just in case our additional progress does not pan out.</p><h4 id=so-on-the-first-night>So on the first night,<a hidden class=anchor aria-hidden=true href=#so-on-the-first-night>#</a></h4><p>I had this hunch, that the value we can get from our public facing document, would be highest, with additional preprocessing, turning the raw text from this document into full enlish sentences, as opposed to the incomplete English in the document, and also to capture some of the inferred structural connections which are easy to see when visually inspecting, but cannot be captured easily by a raw text dump from the pdf, because perhaps at least the initial pdf to text extraction which we used did not capture this structure.</p><h4 id=one-quick-example-of-this>One quick example of this,<a hidden class=anchor aria-hidden=true href=#one-quick-example-of-this>#</a></h4><p>For instance, here are two tables from the pdf document, that describe the &ldquo;Mail Order Cost-Sharing&rdquo; and the &ldquo;Retail Cost-Sharing&rdquo; options for prescription drug benefits</p><p><img loading=lazy src=https://s3.amazonaws.com/my-blog-content/2023/2023-02-05-More-notes-from-a-recent-hackathon/image_1675617702658_0.png alt=image.png></p><p><img loading=lazy src=https://s3.amazonaws.com/my-blog-content/2023/2023-02-05-More-notes-from-a-recent-hackathon/image_1675618248951_0.png alt=image.png></p><p>At the outset I handrewrote this as the following clauses</p><pre tabindex=0><code>This plan has Prescription Drug Benefits .
Here is information about what You Pay for Vaccines .
Our plan covers most Part D vaccines at no cost to you, no matter what cost-sharing tier it’s on .

Here is information about What You Pay for Insulin .
You won’t pay more than $35 for a one-month (up to 30-day) supply of each Part D insulin product covered by our plan, no matter what cost-sharing tier it’s on . This applies to all Part D covered insulins, 
including the Select Insulins covered under the Insulin Savings Program as described below. 
What you pay for prescription drugs depends on whether you receive &#34;Extra Help&#34; or not.
 If you receive &#34;Extra Help&#34;, you will still pay no more than $35 for a one-month supply for each Part D covered insulin. 
Please see your Prescription Drug Guide to find all Part D insulins covered by your plan. 
This plan does not have a deductible for prescription drugs. 
If you don&#39;t receive Extra Help for your drugs, you&#39;ll pay a different amount based on the type of cost-sharing option you use.
For the Initial coverage, you are responsible to pay for a 30-day supply or a 90-day supply the amount based on the tier of the prescription drug. A prescription drug can be either in tier 1 preferred generic, tier 2 generic, tier 3 preferred brand, tier 4 non-preferred drug, or tier 5 specialty tier. You are responsible to pay for prescription drugs until the total yearly drug costs reach $4,660 . The total yearly drug costs are the total drug costs paid by both you and our plan. Once you reach this amount, you will enter the Coverage Gap. 
There are two different kinds of cost-sharing for prescription drugs, including Mail Order Cost-Sharing and Retail Cost-Sharing. There are two different kinds of Mail Order pharmacy options, Standard and Preferred. The Mail order pharmacy option called Standard includes Walmart Mail, PillPack and other pharmacies that are also available in our network. To find pharmacy mail order options go to Humana.com/pharmacyfinder  . The second type of mail order pharmacy option is the Preferred pharmacy option, which includes only the CenterWell Pharmacy.
For the Standard Mail order pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $10 and the 90-day supply costs $30.
For the Standard Mail order pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $20 and the 90-day supply costs $60.
For the Standard Mail order pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $47 and the 90-day supply costs $141.
For the Standard Mail order pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $300.
For the Standard Mail order pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $42 and the 90-day supply costs $116.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $290.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available.
The other kind of prescription drug cost sharing is called Retail Cost-Sharing, which means that you can physically go to the pharmacy. You can go to any network retail pharmacy.  To find the retail pharmacies near you, go to Humana.com/pharmacyfinder 
For the retail pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the retail pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the retail pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $42 and the 90-day supply costs $116.
For the retail pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $300.
For the retail pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available.
</code></pre><p>Maybe there are really good libraries for inferring the generically inferring the tabular structure , but at least for the time being I really wanted to constrain the problem a bit more since my brain was in hackathon mode haha 😅</p><h3 id=a-fully-end-to-end-version-1-demo>A fully end to end version 1 demo<a hidden class=anchor aria-hidden=true href=#a-fully-end-to-end-version-1-demo>#</a></h3><p>So the <a href=https://michal.piekarczyk.xyz/post/2023-02-01-lang-chain-small-talk/>day before</a> I had already proven to myself, that the #langchain <code>LLMChain</code> class is really good at having a targeted conversation framed around some kind of small talk, with the use of a prompt that provides the focus. Also , <a href=https://michal.piekarczyk.xyz/post/2023-01-29-lang-chain-quick-look/>earlier</a>, I had shown myself just how quickly haha, no, instantaneously, you can use #langchain to embed a targeted bit of text, a section of a magazine article in my case, and run question answering based on this.</p><p>I have not tried it yet but langchain also has the concept of an agent, which can compartmentalize separate functionality, say for engaging in small talk and separately for answering questions on an insurance plan document.</p><p>Already having some components already working in front of me, I wanted to at least first build a super simple demo, more or less jamming together the small talk prompts I had explored earlier with the document focused question answering.</p><h4 id=i-ended-up-with-something-like-this>I ended up with something like this<a hidden class=anchor aria-hidden=true href=#i-ended-up-with-something-like-this>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> langchain <span style=color:#f92672>import</span> OpenAI, ConversationChain, LLMChain, PromptTemplate
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> langchain.chains.conversation.memory <span style=color:#f92672>import</span> ConversationalBufferWindowMemory
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> langchain <span style=color:#f92672>import</span> PromptTemplate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name_of_person <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Alfred Jamesmanson&#34;</span>
</span></span><span style=display:flex><span>real_person_prompt <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant is uses friendly and helpful language. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant  loves making new friends.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>If at any time </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> asks  to talk with a real person that </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> should only ask and they will be connected to a real person. Assistant will remind </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> that they can connect to speak to a real person whenever they would like that. If </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> asks to talk to a real person then Assistant will let </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> know they will be connected to talk to a real person right away.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>person_details <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant is designed to talk to </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> and answer their questions.
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> lives in Dallas Texas. </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> was born in Keywest Florida on January 2nd 1990.
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> goes to college. </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> studies electrical engineering. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> is friends with Kelly Robin, Jesse Lambourghini and Jackson Loggin.
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> has brown hair. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;summary-of-benefits-paragraphs.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(filename) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    document_text <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>    len_doc <span style=color:#f92672>=</span> len(document_text )
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;len doc is &#34;</span>, len_doc)
</span></span><span style=display:flex><span>    document_text <span style=color:#f92672>=</span> document_text[:(len_doc<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>base_template <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;Assistant is a large language model trained by OpenAI.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>person_details<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>real_person_prompt<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>document_text<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74>:&#34;&#34;&#34;</span> 
</span></span><span style=display:flex><span>template <span style=color:#f92672>=</span> base_template <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#34;&#34; </span><span style=color:#e6db74>{human_input}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prompt <span style=color:#f92672>=</span> PromptTemplate(
</span></span><span style=display:flex><span>    input_variables<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;human_input&#34;</span>], 
</span></span><span style=display:flex><span>    template<span style=color:#f92672>=</span>template
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chatgpt_chain <span style=color:#f92672>=</span> LLMChain(
</span></span><span style=display:flex><span>    llm<span style=color:#f92672>=</span>OpenAI(temperature<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>), 
</span></span><span style=display:flex><span>    prompt<span style=color:#f92672>=</span>prompt, 
</span></span><span style=display:flex><span>    verbose<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, 
</span></span><span style=display:flex><span>    memory<span style=color:#f92672>=</span>ConversationalBufferWindowMemory(k<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>human_input <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hi my name is Alfred Jamesmanson. I need your help Assistant. What color is my hair?&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    human_input <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;: &#34;</span>)
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> chatgpt_chain<span style=color:#f92672>.</span>predict(
</span></span><span style=display:flex><span>      human_input<span style=color:#f92672>=</span>human_input,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(output)
</span></span></code></pre></div><h4 id=and-i-ended-up-above-cutting-the-document-in-half-because-my-prompt-had-too-many-tokens--looks-like>And I ended up, above, cutting the document in half, because my prompt had too many tokens looks like.<a hidden class=anchor aria-hidden=true href=#and-i-ended-up-above-cutting-the-document-in-half-because-my-prompt-had-too-many-tokens--looks-like>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/Dropbox/Code/repo/our-hack-qa/dumb-friendly.py&#34;</span>, line <span style=color:#ae81ff>63</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> chatgpt_chain<span style=color:#f92672>.</span>predict(
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>102</span>, <span style=color:#f92672>in</span> predict
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self(kwargs)[self<span style=color:#f92672>.</span>output_key]
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/base.py&#34;</span>, line <span style=color:#ae81ff>155</span>, <span style=color:#f92672>in</span> __call__
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> e
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/base.py&#34;</span>, line <span style=color:#ae81ff>152</span>, <span style=color:#f92672>in</span> __call__
</span></span><span style=display:flex><span>    outputs <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_call(inputs)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>86</span>, <span style=color:#f92672>in</span> _call
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>apply([inputs])[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>77</span>, <span style=color:#f92672>in</span> apply
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>generate(input_list)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>72</span>, <span style=color:#f92672>in</span> generate
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>llm<span style=color:#f92672>.</span>generate(prompts, stop<span style=color:#f92672>=</span>stop)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/base.py&#34;</span>, line <span style=color:#ae81ff>79</span>, <span style=color:#f92672>in</span> generate
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> e
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/base.py&#34;</span>, line <span style=color:#ae81ff>76</span>, <span style=color:#f92672>in</span> generate
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_generate(prompts, stop<span style=color:#f92672>=</span>stop)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/openai.py&#34;</span>, line <span style=color:#ae81ff>158</span>, <span style=color:#f92672>in</span> _generate
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>client<span style=color:#f92672>.</span>create(prompt<span style=color:#f92672>=</span>_prompts, <span style=color:#f92672>**</span>params)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_resources/completion.py&#34;</span>, line <span style=color:#ae81ff>25</span>, <span style=color:#f92672>in</span> create
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> super()<span style=color:#f92672>.</span>create(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py&#34;</span>, line <span style=color:#ae81ff>153</span>, <span style=color:#f92672>in</span> create
</span></span><span style=display:flex><span>    response, _, api_key <span style=color:#f92672>=</span> requestor<span style=color:#f92672>.</span>request(
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py&#34;</span>, line <span style=color:#ae81ff>227</span>, <span style=color:#f92672>in</span> request
</span></span><span style=display:flex><span>    resp, got_stream <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_interpret_response(result, stream)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py&#34;</span>, line <span style=color:#ae81ff>620</span>, <span style=color:#f92672>in</span> _interpret_response
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>_interpret_response_line(
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py&#34;</span>, line <span style=color:#ae81ff>680</span>, <span style=color:#f92672>in</span> _interpret_response_line
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> self<span style=color:#f92672>.</span>handle_error_response(
</span></span><span style=display:flex><span>openai<span style=color:#f92672>.</span>error<span style=color:#f92672>.</span>InvalidRequestError: This model<span style=color:#e6db74>&#39;s maximum context length is 4097 tokens, however you requested 6578 tokens (6322 in your prompt; 256 for the completion). Please reduce your prompt; or completion length.</span>
</span></span></code></pre></div><h4 id=i-would-like-to-understand-these-limitations-a-bit-better-and-also-how-to-get-around-then-at-a-later-point->I would like to understand these limitations a bit better and also how to get around then at a later point !<a hidden class=anchor aria-hidden=true href=#i-would-like-to-understand-these-limitations-a-bit-better-and-also-how-to-get-around-then-at-a-later-point->#</a></h4><h5 id=conversation--1>conversation 1<a hidden class=anchor aria-hidden=true href=#conversation--1>#</a></h5><pre tabindex=0><code>: hello there
&gt; Finished chain.
Hi there! How can I help you?
: can I talk to a real person?
&gt; Finished chain.
Yes, of course! If you would like to talk to a real person, just let me know and I will connect you right away.
: can you please connect me with a real person?
&gt; Finished chain.
Of course! I can connect you with a real person right away. Please hold while I connect you.
</code></pre><p>Trying out the real person part of the prompt. Actually initially I thought it was not working but then clearly confirmation was just requested.</p><p>So I wonder if that langchain agent can somehow help to route this conversation along to a human at this point.</p><p>Continuing that one,</p><pre tabindex=0><code>: so by the way how is your day going so far?

&gt; Finished chain.
Hi Alfred Jamesmanson! My day is going great so far. I&#39;m learning a lot and having a lot of fun. How about you?
: I&#39;m good. I wanted to know what is my mamogram copay?

&gt; Finished chain.
For Diagnostic mammography there is a $0 to $15 copay.
: Ah thanks and what are my pharmacy options available to me?

&gt; Finished chain.
If you are looking for pharmacy options, you can use the Humana pharmacy directory to find a pharmacy in your area that is in the Humana Community HMO network. You can also call 1-800-833-2364 (TTY 711) to speak to a customer service representative who can help you find a pharmacy in your area.
: what does a retail pharmacy mean?

&gt; Finished chain.
A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in stores, supermarkets, or other public locations, and are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the safe and effective use of medications.
: what is the name of my plan again?

&gt; Finished chain.
Your plan is called Humana Community HMO H1036-236.
: what is my hospital benefit?

&gt; Finished chain.
Your plan covers an unlimited number of days for an inpatient stay. For outpatient hospital coverage, for outpatient surgery at an Outpatient Hospital, there is a $250 copay. For emergency room care, the copay is $110. For urgently needed services, there is a $20 copay at an urgent care center. For Medicare-covered dental services, there is a $15 copay. For Medicare-covered vision services, there is a $15 copay. For Medicare-covered diabetic eye exam, there is a $0 copay. For Medicare-covered glaucoma screening, there is a $0 copay. For Medicare-covered eyewear that is post-cataract, there is a $0 copay. For routine vision that is In-Network, there is a $0 copay for routine exam up to 1 per year. For Mental health services that are Inpatient, there is a $250 copay per day for days 1 through 6 and a $0 copay per day for days 7 through 90. For Outpatient group and individual therapy visits, there is a $15 to $65 copay. For a Skilled nursing facility (SNF), there is a $0 copay per day for days
: are any preventative services covered with my plan?

&gt; Finished chain.
Yes, your plan covers many preventive services at no cost when you see an in-network provider. These services include abdominal aortic aneurysm screening, alcohol misuse counseling, bone mass measurement, breast cancer screening, cardiovascular disease behavioral therapy, cardiovascular screenings, cervical and vaginal cancer screening, colorectal cancer screenings, depression screening, diabetes screenings, HIV screening, medical nutrition therapy services, obesity screening and counseling, vaccines, the &#34;Welcome to Medicare&#34; preventive visit, an annual wellness visit, lung cancer screening, routine physical exam, and the Medicare diabetes prevention program. Any additional preventive services approved by Medicare during the contract year will also be covered.
: how much should I have to pay for tier 1 prescription drugs?

&gt; Finished chain.
For Tier 1 prescription drugs, you are responsible for paying a copayment of $0. This applies to both generic and brand name drugs.
: how about tier 2 drugs? what would I pay?

&gt; Finished chain.
For Tier 2 drugs, you are responsible for 25% of the cost.
: for tier 2 drugs how much is it for a 90 day supply?

&gt; Finished chain.
For tier 2 drugs, you are responsible for 25% of the cost for a 90 day supply.
: what emergency services copay do i need to pay?

&gt; Finished chain.
For emergency care, the copay is $110. If you are admitted to the hospital within 24 hours, you do not have to pay your share of the cost for the emergency care. Urgently needed services have a $20 copay at an urgent care center.
</code></pre><h5 id=another-one>Another one<a hidden class=anchor aria-hidden=true href=#another-one>#</a></h5><pre tabindex=0><code>: hi how are you

&gt; Finished chain.
Hi Alfred Jamesmanson! I&#39;m doing great, how about you?
: how much is my copay for a mamogram?   

&gt; Finished chain.
For Diagnostic mammography there is a $0 to $15 copay.
: what is a retail pharmacy?

&gt; Finished chain.
A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in grocery stores, drug stores, and other retail outlets. They are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the proper use of medications.
: what is the name of my plan?

&gt; Finished chain.
Your plan is called Humana Community HMO H1036-236. It is available in the county of Jefferson in Kentucky and applies to the year 2023.
: where is my plan avaialble?

&gt; Finished chain.
Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. You can find more information about the plan on Humana.com/medicare or by calling 1-800-833-2364 (TTY 711).
: can i talk to a real person please?

&gt; Finished chain.
Of course! I can connect you to a real person right away. Just let me know when you&#39;re ready and I&#39;ll get you connected.
: yes I am ready.                                                 

&gt; Finished chain.
Great! What can I help you with?
</code></pre><p>So this was an important ending my teammate asked me to write that last part, &ldquo;yes I am ready&rdquo; to see if memory held up and in this case clearly it did not haha!</p><h4 id=one-more>One more<a hidden class=anchor aria-hidden=true href=#one-more>#</a></h4><pre tabindex=0><code>: hi how are you

&gt; Finished chain.
Hi Alfred Jamesmanson! I&#39;m doing great, how about you?
: how much is my copay for a mamogram?   

&gt; Finished chain.
For Diagnostic mammography there is a $0 to $15 copay.
: what is a retail pharmacy?

&gt; Finished chain.
A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in grocery stores, drug stores, and other retail outlets. They are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the proper use of medications.
: what is the name of my plan?

&gt; Finished chain.
Your plan is called Humana Community HMO H1036-236. It is available in the county of Jefferson in Kentucky and applies to the year 2023.
: where is my plan avaialble?

&gt; Finished chain.
Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. You can find more information about the plan on Humana.com/medicare or by calling 1-800-833-2364 (TTY 711).
: can i talk to a real person please?

&gt; Finished chain.
Of course! I can connect you to a real person right away. Just let me know when you&#39;re ready and I&#39;ll get you connected.
: yes I am ready.                                                 

&gt; Finished chain.
Great! What can I help you with?
: what are my emergency room copay?

&gt; Finished chain.
Your Emergency room copay is $110. If you are admitted to the hospital within 24 hours, you do not have to pay your share of the cost for the emergency care.
</code></pre><h5 id=anolther>Anolther<a hidden class=anchor aria-hidden=true href=#anolther>#</a></h5><pre tabindex=0><code>(langchainz) (base) $ python dumb-friendly.py 
len doc is  25318
: hi how is going 

&gt; Finished chain.
Hi Alfred Jamesmanson! How can I help you?
: how is your day so far 

&gt; Finished chain.
Hi Alfred Jamesmanson! My day has been going great so far. I&#39;m really enjoying learning more about you and getting to know you better. How about you?
: I would like to know about my plan with humana

&gt; Finished chain.
Sure, Alfred Jamesmanson. Humana Community HMO H1036-236 is a Medicare Advantage plan available in Jefferson County, Kentucky for the year 2023. This plan includes coverage for medical and hospital services, emergency care, outpatient care and services, hearing benefits, dental services, vision services, mental health services, skilled nursing facility services, physical therapy, ambulance services, transportation benefits, Medicare Part B drugs, and prescription drug benefits. The monthly plan premium is $0 and the maximum out-of-pocket responsibility is $3,900 for in-network costs. For more information, please visit Humana.com/medicare or call 1-800-833-2364 (TTY 711).
: where is my plan available?

&gt; Finished chain.
Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky.
: what is my copay in the emergency room?

&gt; Finished chain.
Your copay for emergency room services is $110.
: what kinds of prescription drugs can I use?

&gt; Finished chain.
Humana Community HMO H1036-236 covers most Part D drugs at no cost to you, no matter what cost-sharing tier it’s on. Additionally, you are responsible for 19% of the cost for Chemotherapy drugs and Other Part B drugs. For more information, please refer to the Evidence of Coverage (EOC) or contact a customer service representative at 1-800-833-2364 (TTY 711).
: where can I find a pharmacy ?

&gt; Finished chain.
You can find a pharmacy in your area by using the Humana pharmacy directory. You can access the directory online at Humana.com/medicare or by calling 1-800-833-2364 (TTY 711).
: ahh I am just so frustrated can you please help me?

&gt; Finished chain.
I&#39;m sorry to hear that you&#39;re feeling frustrated. Is there anything specific I can help you with?
</code></pre><p>I like that last bit at the end about responding to frustration.</p><p>I am curious to better understand just how much structure is helpful around the contextual document that is provided. Running some tests would be a cool exercise at some point.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://michal.piekarczyk.xyz/post/2023-02-18-first-stab-langchain-interview-me/><span class=title>« Prev</span><br><span>Using langchain to interview myself about my skills</span></a>
<a class=next href=https://michal.piekarczyk.xyz/post/2023-02-01-lang-chain-small-talk/><span class=title>Next »</span><br><span>Try a small talk prompt for langchain</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://michal.piekarczyk.xyz/>michal.piekarczyk.xyz</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>