<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Notes from a recent hackathon | My blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link rel=stylesheet href=/css/custom_code_style.css><meta property="og:title" content="Notes from a recent hackathon"><meta property="og:description" content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-02-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-05T00:00:00+00:00"><meta property="og:site_name" content="My blog"><meta itemprop=name content="Notes from a recent hackathon"><meta itemprop=description content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."><meta itemprop=datePublished content="2023-02-05T00:00:00+00:00"><meta itemprop=dateModified content="2023-02-05T00:00:00+00:00"><meta itemprop=wordCount content="3519"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Notes from a recent hackathon"><meta name=twitter:description content="Spending a few spare moments to summarize some of my thought processes from a recent hackathon.
What is all this So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.
Plan of action So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">My blog</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/handy/ title="Handy page">Handy</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/post/ title="Post page">Post</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/project/ title="Side Projects page">Side Projects</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/foo/ title="The Foos page">The Foos</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POST</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/&text=Notes%20from%20a%20recent%20hackathon" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://michal.piekarczyk.xyz/post/2023-02-03-policy-document-understanding/&title=Notes%20from%20a%20recent%20hackathon" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Notes from a recent hackathon</h1><time class="f6 mv4 dib tracked" datetime=2023-02-05T00:00:00Z>February 5, 2023</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Spending a few spare moments to summarize some of my thought processes from a recent hackathon.</p><h3 id=what-is-all-this>What is all this</h3><p>So I was glad to be part of a really cool hackathon team recently at my company and here are some of my perspectives from the experience.</p><h3 id=plan-of-action>Plan of action</h3><p>So We settled to constrain our problem space to apply langchain, a library that wraps around large language model APIs notably the OpenAI API, to show language understanding from a publicly available health insurance plan summary of benefits document. We ended up starting out with this public facing document, which one can seee a description of <a href=https://www.medicareadvantage.com/plans/humana-community-hmo-h1036-236-000>here</a> with its download link <a href=here>https://content.sunfirematrix.com/2023/Humana-H1036-236-000-SB-EN-2023-SF20220922.pdf</a> .</p><h3 id=my-thought-around-structured-data>My thought around structured data</h3><p>Hackathons are always very time crunch like environments. I very much wanted us to have at least a minimal end to end demo in our back pocket just in case our additional progress does not pan out.</p><h4 id=so-on-the-first-night>So on the first night,</h4><p>I had this hunch, that the value we can get from our public facing document, would be highest, with additional preprocessing, turning the raw text from this document into full enlish sentences, as opposed to the incomplete English in the document, and also to capture some of the inferred structural connections which are easy to see when visually inspecting, but cannot be captured easily by a raw text dump from the pdf, because perhaps at least the initial pdf to text extraction which we used did not capture this structure.</p><h4 id=one-quick-example-of-this>One quick example of this,</h4><p>For instance, here are two tables from the pdf document, that describe the &ldquo;Mail Order Cost-Sharing&rdquo; and the &ldquo;Retail Cost-Sharing&rdquo; options for prescription drug benefits</p><p><img src=https://s3.amazonaws.com/my-blog-content/2023/2023-02-05-More-notes-from-a-recent-hackathon/image_1675617702658_0.png alt=image.png></p><p><img src=https://s3.amazonaws.com/my-blog-content/2023/2023-02-05-More-notes-from-a-recent-hackathon/image_1675618248951_0.png alt=image.png></p><p>At the outset I handrewrote this as the following clauses</p><pre tabindex=0><code>This plan has Prescription Drug Benefits .
Here is information about what You Pay for Vaccines .
Our plan covers most Part D vaccines at no cost to you, no matter what cost-sharing tier itâ€™s on .

Here is information about What You Pay for Insulin .
You wonâ€™t pay more than $35 for a one-month (up to 30-day) supply of each Part D insulin product covered by our plan, no matter what cost-sharing tier itâ€™s on . This applies to all Part D covered insulins, 
including the Select Insulins covered under the Insulin Savings Program as described below. 
What you pay for prescription drugs depends on whether you receive &#34;Extra Help&#34; or not.
 If you receive &#34;Extra Help&#34;, you will still pay no more than $35 for a one-month supply for each Part D covered insulin. 
Please see your Prescription Drug Guide to find all Part D insulins covered by your plan. 
This plan does not have a deductible for prescription drugs. 
If you don&#39;t receive Extra Help for your drugs, you&#39;ll pay a different amount based on the type of cost-sharing option you use.
For the Initial coverage, you are responsible to pay for a 30-day supply or a 90-day supply the amount based on the tier of the prescription drug. A prescription drug can be either in tier 1 preferred generic, tier 2 generic, tier 3 preferred brand, tier 4 non-preferred drug, or tier 5 specialty tier. You are responsible to pay for prescription drugs until the total yearly drug costs reach $4,660 . The total yearly drug costs are the total drug costs paid by both you and our plan. Once you reach this amount, you will enter the Coverage Gap. 
There are two different kinds of cost-sharing for prescription drugs, including Mail Order Cost-Sharing and Retail Cost-Sharing. There are two different kinds of Mail Order pharmacy options, Standard and Preferred. The Mail order pharmacy option called Standard includes Walmart Mail, PillPack and other pharmacies that are also available in our network. To find pharmacy mail order options go to Humana.com/pharmacyfinder  . The second type of mail order pharmacy option is the Preferred pharmacy option, which includes only the CenterWell Pharmacy.
For the Standard Mail order pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $10 and the 90-day supply costs $30.
For the Standard Mail order pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $20 and the 90-day supply costs $60.
For the Standard Mail order pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $47 and the 90-day supply costs $141.
For the Standard Mail order pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $300.
For the Standard Mail order pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $42 and the 90-day supply costs $116.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $290.
For the Preferred CenterWell Pharmacy Mail order pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available.
The other kind of prescription drug cost sharing is called Retail Cost-Sharing, which means that you can physically go to the pharmacy. You can go to any network retail pharmacy.  To find the retail pharmacies near you, go to Humana.com/pharmacyfinder 
For the retail pharmacy option, for Tier 1 Preferred Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the retail pharmacy option, for Tier 2 Generic drugs, the 30-day supply costs $0 and the 90-day supply costs $0.
For the retail pharmacy option, for Tier 3 Preferred Brand drugs, the 30-day supply costs $42 and the 90-day supply costs $116.
For the retail pharmacy option, for Tier 4 Non-Preferred drugs, the 30-day supply costs $100 and the 90-day supply costs $300.
For the retail pharmacy option, for Tier 5 Specialty Tier drugs, the 30-day supply costs 33% and the 90-day supply is not available.
</code></pre><p>Maybe there are really good libraries for inferring the generically inferring the tabular structure , but at least for the time being I really wanted to constrain the problem a bit more since my brain was in hackathon mode haha ðŸ˜…</p><h3 id=a-fully-end-to-end-version-1-demo>A fully end to end version 1 demo</h3><p>So the <a href=https://michal.piekarczyk.xyz/post/2023-02-01-lang-chain-small-talk/>day before</a> I had already proven to myself, that the #langchain <code>LLMChain</code> class is really good at having a targeted conversation framed around some kind of small talk, with the use of a prompt that provides the focus. Also , <a href=https://michal.piekarczyk.xyz/post/2023-01-29-lang-chain-quick-look/>earlier</a>, I had shown myself just how quickly haha, no, instantaneously, you can use #langchain to embed a targeted bit of text, a section of a magazine article in my case, and run question answering based on this.</p><p>I have not tried it yet but langchain also has the concept of an agent, which can compartmentalize separate functionality, say for engaging in small talk and separately for answering questions on an insurance plan document.</p><p>Already having some components already working in front of me, I wanted to at least first build a super simple demo, more or less jamming together the small talk prompts I had explored earlier with the document focused question answering.</p><h4 id=i-ended-up-with-something-like-this>I ended up with something like this</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> langchain <span style=color:#f92672>import</span> OpenAI, ConversationChain, LLMChain, PromptTemplate
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> langchain.chains.conversation.memory <span style=color:#f92672>import</span> ConversationalBufferWindowMemory
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> langchain <span style=color:#f92672>import</span> PromptTemplate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name_of_person <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Alfred Jamesmanson&#34;</span>
</span></span><span style=display:flex><span>real_person_prompt <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant is uses friendly and helpful language. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant  loves making new friends.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>If at any time </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> asks  to talk with a real person that </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> should only ask and they will be connected to a real person. Assistant will remind </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> that they can connect to speak to a real person whenever they would like that. If </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> asks to talk to a real person then Assistant will let </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> know they will be connected to talk to a real person right away.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>person_details <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant is designed to talk to </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> and answer their questions.
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> lives in Dallas Texas. </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> was born in Keywest Florida on January 2nd 1990.
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> goes to college. </span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> studies electrical engineering. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> is friends with Kelly Robin, Jesse Lambourghini and Jackson Loggin.
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74> has brown hair. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;summary-of-benefits-paragraphs.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(filename) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    document_text <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>    len_doc <span style=color:#f92672>=</span> len(document_text )
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;len doc is &#34;</span>, len_doc)
</span></span><span style=display:flex><span>    document_text <span style=color:#f92672>=</span> document_text[:(len_doc<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>base_template <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;Assistant is a large language model trained by OpenAI.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>person_details<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>real_person_prompt<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>document_text<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant is able to process and understand large amounts of text, and can use this knowledge to provide accurate and informative responses to a wide range of questions. Additionally, Assistant is able to generate its own text based on the input it receives, allowing it to engage in discussions and provide explanations and descriptions on a wide range of topics.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{</span>name_of_person<span style=color:#e6db74>}</span><span style=color:#e6db74>:&#34;&#34;&#34;</span> 
</span></span><span style=display:flex><span>template <span style=color:#f92672>=</span> base_template <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#34;&#34; </span><span style=color:#e6db74>{human_input}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Assistant:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prompt <span style=color:#f92672>=</span> PromptTemplate(
</span></span><span style=display:flex><span>    input_variables<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;human_input&#34;</span>], 
</span></span><span style=display:flex><span>    template<span style=color:#f92672>=</span>template
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chatgpt_chain <span style=color:#f92672>=</span> LLMChain(
</span></span><span style=display:flex><span>    llm<span style=color:#f92672>=</span>OpenAI(temperature<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>), 
</span></span><span style=display:flex><span>    prompt<span style=color:#f92672>=</span>prompt, 
</span></span><span style=display:flex><span>    verbose<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, 
</span></span><span style=display:flex><span>    memory<span style=color:#f92672>=</span>ConversationalBufferWindowMemory(k<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>human_input <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hi my name is Alfred Jamesmanson. I need your help Assistant. What color is my hair?&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    human_input <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;: &#34;</span>)
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> chatgpt_chain<span style=color:#f92672>.</span>predict(
</span></span><span style=display:flex><span>      human_input<span style=color:#f92672>=</span>human_input,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(output)
</span></span></code></pre></div><h4 id=and-i-ended-up-above-cutting-the-document-in-half-because-my-prompt-had-too-many-tokens--looks-like>And I ended up, above, cutting the document in half, because my prompt had too many tokens looks like.</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/Dropbox/Code/repo/our-hack-qa/dumb-friendly.py&#34;</span>, line <span style=color:#ae81ff>63</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> chatgpt_chain<span style=color:#f92672>.</span>predict(
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>102</span>, <span style=color:#f92672>in</span> predict
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self(kwargs)[self<span style=color:#f92672>.</span>output_key]
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/base.py&#34;</span>, line <span style=color:#ae81ff>155</span>, <span style=color:#f92672>in</span> __call__
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> e
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/base.py&#34;</span>, line <span style=color:#ae81ff>152</span>, <span style=color:#f92672>in</span> __call__
</span></span><span style=display:flex><span>    outputs <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_call(inputs)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>86</span>, <span style=color:#f92672>in</span> _call
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>apply([inputs])[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>77</span>, <span style=color:#f92672>in</span> apply
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>generate(input_list)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/chains/llm.py&#34;</span>, line <span style=color:#ae81ff>72</span>, <span style=color:#f92672>in</span> generate
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>llm<span style=color:#f92672>.</span>generate(prompts, stop<span style=color:#f92672>=</span>stop)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/base.py&#34;</span>, line <span style=color:#ae81ff>79</span>, <span style=color:#f92672>in</span> generate
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> e
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/base.py&#34;</span>, line <span style=color:#ae81ff>76</span>, <span style=color:#f92672>in</span> generate
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_generate(prompts, stop<span style=color:#f92672>=</span>stop)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/langchain/llms/openai.py&#34;</span>, line <span style=color:#ae81ff>158</span>, <span style=color:#f92672>in</span> _generate
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>client<span style=color:#f92672>.</span>create(prompt<span style=color:#f92672>=</span>_prompts, <span style=color:#f92672>**</span>params)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_resources/completion.py&#34;</span>, line <span style=color:#ae81ff>25</span>, <span style=color:#f92672>in</span> create
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> super()<span style=color:#f92672>.</span>create(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py&#34;</span>, line <span style=color:#ae81ff>153</span>, <span style=color:#f92672>in</span> create
</span></span><span style=display:flex><span>    response, _, api_key <span style=color:#f92672>=</span> requestor<span style=color:#f92672>.</span>request(
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py&#34;</span>, line <span style=color:#ae81ff>227</span>, <span style=color:#f92672>in</span> request
</span></span><span style=display:flex><span>    resp, got_stream <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_interpret_response(result, stream)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py&#34;</span>, line <span style=color:#ae81ff>620</span>, <span style=color:#f92672>in</span> _interpret_response
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>_interpret_response_line(
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Users/michal/.python_venvs/langchainz/lib/python3.9/site-packages/openai/api_requestor.py&#34;</span>, line <span style=color:#ae81ff>680</span>, <span style=color:#f92672>in</span> _interpret_response_line
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> self<span style=color:#f92672>.</span>handle_error_response(
</span></span><span style=display:flex><span>openai<span style=color:#f92672>.</span>error<span style=color:#f92672>.</span>InvalidRequestError: This model<span style=color:#e6db74>&#39;s maximum context length is 4097 tokens, however you requested 6578 tokens (6322 in your prompt; 256 for the completion). Please reduce your prompt; or completion length.</span>
</span></span></code></pre></div><h4 id=i-would-like-to-understand-these-limitations-a-bit-better-and-also-how-to-get-around-then-at-a-later-point->I would like to understand these limitations a bit better and also how to get around then at a later point !</h4><h5 id=conversation--1>conversation 1</h5><pre tabindex=0><code>: hello there
&gt; Finished chain.
Hi there! How can I help you?
: can I talk to a real person?
&gt; Finished chain.
Yes, of course! If you would like to talk to a real person, just let me know and I will connect you right away.
: can you please connect me with a real person?
&gt; Finished chain.
Of course! I can connect you with a real person right away. Please hold while I connect you.
</code></pre><p>Trying out the real person part of the prompt. Actually initially I thought it was not working but then clearly confirmation was just requested.</p><p>So I wonder if that langchain agent can somehow help to route this conversation along to a human at this point.</p><p>Continuing that one,</p><pre tabindex=0><code>: so by the way how is your day going so far?

&gt; Finished chain.
Hi Alfred Jamesmanson! My day is going great so far. I&#39;m learning a lot and having a lot of fun. How about you?
: I&#39;m good. I wanted to know what is my mamogram copay?

&gt; Finished chain.
For Diagnostic mammography there is a $0 to $15 copay.
: Ah thanks and what are my pharmacy options available to me?

&gt; Finished chain.
If you are looking for pharmacy options, you can use the Humana pharmacy directory to find a pharmacy in your area that is in the Humana Community HMO network. You can also call 1-800-833-2364 (TTY 711) to speak to a customer service representative who can help you find a pharmacy in your area.
: what does a retail pharmacy mean?

&gt; Finished chain.
A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in stores, supermarkets, or other public locations, and are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the safe and effective use of medications.
: what is the name of my plan again?

&gt; Finished chain.
Your plan is called Humana Community HMO H1036-236.
: what is my hospital benefit?

&gt; Finished chain.
Your plan covers an unlimited number of days for an inpatient stay. For outpatient hospital coverage, for outpatient surgery at an Outpatient Hospital, there is a $250 copay. For emergency room care, the copay is $110. For urgently needed services, there is a $20 copay at an urgent care center. For Medicare-covered dental services, there is a $15 copay. For Medicare-covered vision services, there is a $15 copay. For Medicare-covered diabetic eye exam, there is a $0 copay. For Medicare-covered glaucoma screening, there is a $0 copay. For Medicare-covered eyewear that is post-cataract, there is a $0 copay. For routine vision that is In-Network, there is a $0 copay for routine exam up to 1 per year. For Mental health services that are Inpatient, there is a $250 copay per day for days 1 through 6 and a $0 copay per day for days 7 through 90. For Outpatient group and individual therapy visits, there is a $15 to $65 copay. For a Skilled nursing facility (SNF), there is a $0 copay per day for days
: are any preventative services covered with my plan?

&gt; Finished chain.
Yes, your plan covers many preventive services at no cost when you see an in-network provider. These services include abdominal aortic aneurysm screening, alcohol misuse counseling, bone mass measurement, breast cancer screening, cardiovascular disease behavioral therapy, cardiovascular screenings, cervical and vaginal cancer screening, colorectal cancer screenings, depression screening, diabetes screenings, HIV screening, medical nutrition therapy services, obesity screening and counseling, vaccines, the &#34;Welcome to Medicare&#34; preventive visit, an annual wellness visit, lung cancer screening, routine physical exam, and the Medicare diabetes prevention program. Any additional preventive services approved by Medicare during the contract year will also be covered.
: how much should I have to pay for tier 1 prescription drugs?

&gt; Finished chain.
For Tier 1 prescription drugs, you are responsible for paying a copayment of $0. This applies to both generic and brand name drugs.
: how about tier 2 drugs? what would I pay?

&gt; Finished chain.
For Tier 2 drugs, you are responsible for 25% of the cost.
: for tier 2 drugs how much is it for a 90 day supply?

&gt; Finished chain.
For tier 2 drugs, you are responsible for 25% of the cost for a 90 day supply.
: what emergency services copay do i need to pay?

&gt; Finished chain.
For emergency care, the copay is $110. If you are admitted to the hospital within 24 hours, you do not have to pay your share of the cost for the emergency care. Urgently needed services have a $20 copay at an urgent care center.
</code></pre><h5 id=another-one>Another one</h5><pre tabindex=0><code>: hi how are you

&gt; Finished chain.
Hi Alfred Jamesmanson! I&#39;m doing great, how about you?
: how much is my copay for a mamogram?   

&gt; Finished chain.
For Diagnostic mammography there is a $0 to $15 copay.
: what is a retail pharmacy?

&gt; Finished chain.
A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in grocery stores, drug stores, and other retail outlets. They are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the proper use of medications.
: what is the name of my plan?

&gt; Finished chain.
Your plan is called Humana Community HMO H1036-236. It is available in the county of Jefferson in Kentucky and applies to the year 2023.
: where is my plan avaialble?

&gt; Finished chain.
Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. You can find more information about the plan on Humana.com/medicare or by calling 1-800-833-2364 (TTY 711).
: can i talk to a real person please?

&gt; Finished chain.
Of course! I can connect you to a real person right away. Just let me know when you&#39;re ready and I&#39;ll get you connected.
: yes I am ready.                                                 

&gt; Finished chain.
Great! What can I help you with?
</code></pre><p>So this was an important ending my teammate asked me to write that last part, &ldquo;yes I am ready&rdquo; to see if memory held up and in this case clearly it did not haha!</p><h4 id=one-more>One more</h4><pre tabindex=0><code>: hi how are you

&gt; Finished chain.
Hi Alfred Jamesmanson! I&#39;m doing great, how about you?
: how much is my copay for a mamogram?   

&gt; Finished chain.
For Diagnostic mammography there is a $0 to $15 copay.
: what is a retail pharmacy?

&gt; Finished chain.
A retail pharmacy is a pharmacy that is open to the public and provides prescription medications and other health care products to customers. Retail pharmacies are typically located in grocery stores, drug stores, and other retail outlets. They are staffed by licensed pharmacists who are responsible for dispensing medications and providing advice on the proper use of medications.
: what is the name of my plan?

&gt; Finished chain.
Your plan is called Humana Community HMO H1036-236. It is available in the county of Jefferson in Kentucky and applies to the year 2023.
: where is my plan avaialble?

&gt; Finished chain.
Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky. You can find more information about the plan on Humana.com/medicare or by calling 1-800-833-2364 (TTY 711).
: can i talk to a real person please?

&gt; Finished chain.
Of course! I can connect you to a real person right away. Just let me know when you&#39;re ready and I&#39;ll get you connected.
: yes I am ready.                                                 

&gt; Finished chain.
Great! What can I help you with?
: what are my emergency room copay?

&gt; Finished chain.
Your Emergency room copay is $110. If you are admitted to the hospital within 24 hours, you do not have to pay your share of the cost for the emergency care.
</code></pre><h5 id=anolther>Anolther</h5><pre tabindex=0><code>(langchainz) (base) $ python dumb-friendly.py 
len doc is  25318
: hi how is going 

&gt; Finished chain.
Hi Alfred Jamesmanson! How can I help you?
: how is your day so far 

&gt; Finished chain.
Hi Alfred Jamesmanson! My day has been going great so far. I&#39;m really enjoying learning more about you and getting to know you better. How about you?
: I would like to know about my plan with humana

&gt; Finished chain.
Sure, Alfred Jamesmanson. Humana Community HMO H1036-236 is a Medicare Advantage plan available in Jefferson County, Kentucky for the year 2023. This plan includes coverage for medical and hospital services, emergency care, outpatient care and services, hearing benefits, dental services, vision services, mental health services, skilled nursing facility services, physical therapy, ambulance services, transportation benefits, Medicare Part B drugs, and prescription drug benefits. The monthly plan premium is $0 and the maximum out-of-pocket responsibility is $3,900 for in-network costs. For more information, please visit Humana.com/medicare or call 1-800-833-2364 (TTY 711).
: where is my plan available?

&gt; Finished chain.
Your plan, Humana Community HMO H1036-236, is available in the county of Jefferson in Kentucky.
: what is my copay in the emergency room?

&gt; Finished chain.
Your copay for emergency room services is $110.
: what kinds of prescription drugs can I use?

&gt; Finished chain.
Humana Community HMO H1036-236 covers most Part D drugs at no cost to you, no matter what cost-sharing tier itâ€™s on. Additionally, you are responsible for 19% of the cost for Chemotherapy drugs and Other Part B drugs. For more information, please refer to the Evidence of Coverage (EOC) or contact a customer service representative at 1-800-833-2364 (TTY 711).
: where can I find a pharmacy ?

&gt; Finished chain.
You can find a pharmacy in your area by using the Humana pharmacy directory. You can access the directory online at Humana.com/medicare or by calling 1-800-833-2364 (TTY 711).
: ahh I am just so frustrated can you please help me?

&gt; Finished chain.
I&#39;m sorry to hear that you&#39;re feeling frustrated. Is there anything specific I can help you with?
</code></pre><p>I like that last bit at the end about responding to frustration.</p><p>I am curious to better understand just how much structure is helpful around the contextual document that is provided. Running some tests would be a cool exercise at some point.</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://michal.piekarczyk.xyz/>&copy; My blog 2023</a><div></div></div></footer></body></html>