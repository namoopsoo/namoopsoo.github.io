<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Some of my notes through learning Golang by conversing with ChatGPT | michal.piekarczyk.xyz</title>
<meta name=keywords content><meta name=description content="I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT? Not a full conversation below , but just using this to jot down some notes. And most of the code examples I&rsquo;m pasting below are from ChatGPT.
Error handling is very different in Go So no exceptions like Python. Instead, you can give a return tuple type from a function like this and the second term will be a error code."><meta name=author content="Michal Piekarczyk"><link rel=canonical href=https://michal.piekarczyk.xyz/post/2023-12-23-learn-golang-through-chat-gpt-conversation/><link crossorigin=anonymous href=/assets/css/stylesheet.dd867d536fb6202811c1ee15fa181ef8945826662b49d3016ac91365a2621d58.css integrity="sha256-3YZ9U2+2ICgRwe4V+hge+JRYJmYrSdMBaskTZaJiHVg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://michal.piekarczyk.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://michal.piekarczyk.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://michal.piekarczyk.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://michal.piekarczyk.xyz/apple-touch-icon.png><link rel=mask-icon href=https://michal.piekarczyk.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-74MK08REDT"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-74MK08REDT",{anonymize_ip:!1})}</script><meta property="og:title" content="Some of my notes through learning Golang by conversing with ChatGPT"><meta property="og:description" content="I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT? Not a full conversation below , but just using this to jot down some notes. And most of the code examples I&rsquo;m pasting below are from ChatGPT.
Error handling is very different in Go So no exceptions like Python. Instead, you can give a return tuple type from a function like this and the second term will be a error code."><meta property="og:type" content="article"><meta property="og:url" content="https://michal.piekarczyk.xyz/post/2023-12-23-learn-golang-through-chat-gpt-conversation/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-12-23T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-07T15:54:17-05:00"><meta property="og:site_name" content="michal.piekarczyk.xyz"><meta name=twitter:card content="summary"><meta name=twitter:title content="Some of my notes through learning Golang by conversing with ChatGPT"><meta name=twitter:description content="I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT? Not a full conversation below , but just using this to jot down some notes. And most of the code examples I&rsquo;m pasting below are from ChatGPT.
Error handling is very different in Go So no exceptions like Python. Instead, you can give a return tuple type from a function like this and the second term will be a error code."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://michal.piekarczyk.xyz/post/"},{"@type":"ListItem","position":2,"name":"Some of my notes through learning Golang by conversing with ChatGPT","item":"https://michal.piekarczyk.xyz/post/2023-12-23-learn-golang-through-chat-gpt-conversation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Some of my notes through learning Golang by conversing with ChatGPT","name":"Some of my notes through learning Golang by conversing with ChatGPT","description":"I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT? Not a full conversation below , but just using this to jot down some notes. And most of the code examples I\u0026rsquo;m pasting below are from ChatGPT.\nError handling is very different in Go So no exceptions like Python. Instead, you can give a return tuple type from a function like this and the second term will be a error code.","keywords":[],"articleBody":"I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT? Not a full conversation below , but just using this to jot down some notes. And most of the code examples I‚Äôm pasting below are from ChatGPT.\nError handling is very different in Go So no exceptions like Python. Instead, you can give a return tuple type from a function like this and the second term will be a error code.\nfunc divide(a, b float64) (float64, error) { if b == 0 { return 0, errors.New(\"division by zero\") } return a / b, nil } func main() { result, err := divide(10.0, 0) if err != nil { fmt.Println(\"Error:\", err) return } fmt.Println(\"Result:\", result) } Attaching functions to struct types So there are no classes per se. You can however attach methods to structs, with this additional syntactic sugar, below.\nThere is an additional (r Rectangle) squished in between func and Area and the arguments are an empty ().\nIn addition , an interface is defined also below, Shape, which carries a subset of the methods that are defined on the struct type Rectangle.\npackage main import \"fmt\" // Define a struct type Rectangle struct { Width, Height float64 } // Define a method on the struct func (r Rectangle) Area() float64 { return r.Width * r.Height } // Define an interface type Shape interface { Area() float64 } func main() { var s Shape = Rectangle{Width: 10, Height: 5} fmt.Println(\"Area:\", s.Area()) } In addition, I was inquiring in the above , why bother specifying that the return of Area in the interface Shape is float64 if we already know the type from the earlier definition of Area earlier. And the response was that more or less the interface is a contract and that types ‚Äúmight‚Äù implement it or they might not.\nIndeed, I tried changing the return type to see what would happen So only updating that one thing, I tried running the below in https://go.dev/play/\npackage main import \"fmt\" // Define a struct type Rectangle struct { Width, Height float64 } // Define a method on the struct func (r Rectangle) Area() int { return r.Width * r.Height } // Define an interface type Shape interface { Area() float64 } func main() { var s Shape = Rectangle{Width: 10, Height: 5} fmt.Println(\"Area:\", s.Area()) } and actually first I got a message that multiplying floats will not produce an int. Very nice.\n./prog.go:12:9: cannot use r.Width * r.Height (value of type float64) as int value in return statement And I also got the message,\n./prog.go:21:16: cannot use Rectangle{‚Ä¶} (value of type Rectangle) as Shape value in variable declaration: Rectangle does not implement Shape (wrong type for method Area) have Area() int want Area() float64 and the line 21 above is the var s Shape = Rectangle{Width: 10, Height: 5} , so, cool, as expected, this is an error not on the interface, not on the type implementing the interface, but on the declaration that attempts to use the type Rectangle claiming to implement the interface Shape. Interesting.\nAnd indeed when I fix the types of Width and Height to int in Rectangle and comment out that line 21 above, the program actually has no compile error, so then looks like this is a runtime error only.\nBehavior of passing objects into functions Ok, we have pass by value behavior and we have pass by reference behavior, depending on the type.\nWow, i learned that the size of a Go array is part of its type and therefore you must define a different function for different sizes of arrays as inputs.\nBut this is not true of slices as function parameters, which also have a pass by reference behavior as opposed to array pass by value behavior and so overall seems like passing slices to functions is the way to go.\nHTTP server with channels for delegating to workers Discussing this, I was asking , hey if I want to build a web server with Golang, with a listener that receives HTTP requests and then pushes them to channels for available workers to consume , are channels good option for this or would this cause the listener go routine to block on channel push operations?\nChat GPT reminding me that, unbufferes channels block but also buffered channels that are ‚Äúfull‚Äù also block.\nBut the recommendation was to use a channel with a capacity that is large enough to handle peak loads, and then that would prevent a listener from blocking on a push to the channel.\nYea good point!\nReceived this example code based on my question package main import ( \"fmt\" \"net/http\" \"time\" ) func worker(id int, jobs \u003c-chan http.Request) { for req := range jobs { fmt.Printf(\"Worker %d processing request: %v\\n\", id, req) // Process the request... } } func main() { jobs := make(chan http.Request, 100) // Buffered channel // Start worker goroutines for w := 1; w \u003c= 3; w++ { go worker(w, jobs) } // HTTP listener (simplified example) http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { fmt.Println(\"Received request:\", r) jobs \u003c- *r // Send the request to the channel fmt.Fprintln(w, \"Request is being processed\") }) http.ListenAndServe(\":8080\", nil) } Nice let me see if it runs !\nOkay that basically worked out of the box Only that \"time\" was imported but unused. Other than that worked like here, after putting this into a serve.go\ngo run serve.go and I used a python repl to call the server,\nimport requests In [2]: data = {\"some\": \"data\"} ...: r = requests.post(\"http://localhost:8080\", json=data) In [3]: r.status_code, r.text Out[3]: (200, 'Request is being processed\\n') And saw this in my STDOUT logs,\nReceived request: \u0026{POST / HTTP/1.1 1 1 map[Accept:[*/*] Accept-Encoding:[gzip, deflate] Connection:[keep-alive] Content-Length:[16] Content-Type:[application/json] User-Agent:[python-requests/2.31.0]] 0xc00012a240 16 [] false localhost:8080 map[] map[] map[] 127.0.0.1:63359 / 0xc000076230} Worker 1 processing request: {POST / HTTP/1.1 1 1 map[Accept:[*/*] Accept-Encoding:[gzip, deflate] Connection:[keep-alive] Content-Length:[16] Content-Type:[application/json] User-Agent:[python-requests/2.31.0]] 0xc00012a240 16 [] false localhost:8080 map[] map[] map[] 127.0.0.1:63359 / 0xc000076230} Nice, so the response is provided by the server, Request is being processed. And a cool next step would be, okay probably I should pass the response writer http.ResponseWriter to the worker, so that it can send the response? Let me try.\nFirst try produced empty responses for the client So I created a new struct type, for both the request and the response writer,\ntype Packet struct { request http.Request response_writer http.ResponseWriter } And I was passing this to the worker through the channel,\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { fmt.Println(\"Received request:\", r) done := make(chan struct{}) packet := Packet{ request: *r, response_writer: w, } jobs \u003c- packet // Send the request to the channel }) with worker , like\nfunc worker(id int, jobs \u003c-chan Packet) { for packet := range jobs { req := packet.request response_writer := packet.response_writer fmt.Printf(\"Worker %d processing request: %v\\n\", id, req) // Process the request... fmt.Fprintln(response_writer, \"Request is being processed\") } } So when the response on the client was blank, this was puzzling. I inquired w/ ChatGPT and got the idea that oh wow üòÆright, the listener is likely returning a response before the worker writes to the buffer there. So I should have the handler block until the worker is done by using a per request channel, done.\nOk, so I tried creating adding a channel on which the handler blocks and that worked ! package main import ( \"fmt\" \"net/http\" // \"time\" ) type Packet struct { request http.Request response_writer http.ResponseWriter done chan struct{} } func worker(id int, jobs \u003c-chan Packet) { for packet := range jobs { req := packet.request response_writer := packet.response_writer fmt.Printf(\"Worker %d processing request: %v\\n\", id, req) // Process the request... fmt.Fprintln(response_writer, \"Request is being processed\") // Signal we are done packet.done \u003c- struct{}{} } } func main() { fmt.Println(\"Server has started.\") jobs := make(chan Packet, 100) // Buffered channel // Start worker goroutines for w := 1; w \u003c= 3; w++ { go worker(w, jobs) } // HTTP listener (simplified example) http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { fmt.Println(\"Received request:\", r) done := make(chan struct{}) packet := Packet{ request: *r, response_writer: w, done: done, } jobs \u003c- packet // Send the request to the channel \u003c- done }) http.ListenAndServe(\":8080\", nil) } And on client side,\nIn [10]: data = {\"some\": \"xxxxxxxxxxxxxxxxxxxx\"} ...: r = requests.post(\"http://localhost:8080\", json=data) ...: r.status_code, r.text Out[10]: (200, 'Request is being processed\\n') Nice.\nReading a csv So funny thing happened, I inquired about some simple csv parsing code and ended up with this, since I want to create a dict (aka map) from column 1 to column 2. With a file like\nstuff,num hambuerger,12 cheesypoofs,.123 cheesy whizz,0.25 import ( \"os\" \"fmt\" \"encoding/csv\" \"strconv\" ) func read_my_csv() { file, err := os.Open(\"blah/balh.csv\") if err != nil { fmt.Println(fmt.Sprintf(`hmmm %q`, err)) return } defer file.Close() reader := csv.NewReader(file) my_dict := make(map[string]float64) for { record, err := reader.Read() if err != nil { fmt.Println(fmt.Sprintf(\"error %q\", err)) } num, err := strconv.ParseFloat(record[1], 64) if err != nil { fmt.Println(fmt.Sprintf(\"internal error parsing csv %q\", err)) return } my_dict[record[0]] = num } return my_dict } But I was getting, oddly,\n\"internal error parsing csv \"strconv.ParseFloat: parsing \\\\\"num\\\\\": invalid syntax\"\" Ah duh, the column header is not a number, right, ok then this csv parsing library is pretty do it yourself then haha üòÖ, if I have to handle reading the header myself.\nLooking further, looks like I just need to read the header row myself manually So header first, then I can also use reader.ReadAll() , a better way I found to iterate through the remaining rows.\nheader, err := reader.Read() if err != nil { fmt.Println(fmt.Sprintf(\"error %q reading header\", err)) } fmt.Println(\"header\", header) records, err := reader.ReadAll() if err != nil { fmt.Println(fmt.Sprintf(\"error %q reading rows\", err)) } blahMap := make(map[string]float64) for _, record in range records { num, err := strconv.ParseFloat(record[1], 64) if err != nil { blahMap[record[0]] = math.NaN() } blahMap[record[0]] = num } Mapping receiver functions to types as value receiver or pointer receivers Useful to know that you can assign a function to a struct type, with an instance of the type passed as a copy or as a pointer.\nAs a copy, a func will not modify the original.\nAs a value , type SomeType struct{ blah int } func (s SomeType) SomeFunc(hmm string) { // Here SomeFunc will interact with a copy \"s\". s.blah += 1 fmt.Println(\"SomeFunc\", s.blah, hmm) } func (s *SomeType) SomeOtherFunc(hmm string) { // Here SomeFunc will interact with the real \"s\". s.blah += 1 fmt.Println(\"SomeFunc\", s.blah, hmm) } func main() { // Example 1 s := SomeType{22} fmt.Println(\"before\", s.blah) s.SomeFunc(\"hi\") fmt.Println(\"after SomeFunc\", s.blah) // Example 2 s.SomeOtherFunc(\"hi\") fmt.Println(\"after SomeOtherFunc\", s.blah) } before 22 SomeFunc 22 hi after SomeFunc 22 SomeFunc 23 hi after SomeOtherFunc 23 Looking like pointers in Go are very similar to pointers in C++ , I had this program,\n// You can edit this code! // Click here and start typing. package main import ( \"fmt\" ) type SomeType struct { blah int } func main() { pointerToStruct := \u0026SomeType{} fmt.Println( fmt.Sprintf( \"pointer: %q, member: %q, dereferenced: %q, dereferenced member, %q\", pointerToStruct, pointerToStruct.blah, (*pointerToStruct), (*pointerToStruct).blah)) pointerToStruct.blah = 20 fmt.Println( fmt.Sprintf( \"pointer: %q, member: %q, dereferenced: %q, dereferenced member, %q\", pointerToStruct, pointerToStruct.blah, (*pointerToStruct), (*pointerToStruct).blah)) (*pointerToStruct).blah = 30 fmt.Println( fmt.Sprintf( \"pointer: %q, member: %q, dereferenced: %q, dereferenced member, %q\", pointerToStruct, pointerToStruct.blah, (*pointerToStruct), (*pointerToStruct).blah)) } and I was seeing the outpu\npointer: \u0026{'\\x00'}, member: '\\x00', dereferenced: {'\\x00'}, dereferenced member, '\\x00' pointer: \u0026{'\\x14'}, member: '\\x14', dereferenced: {'\\x14'}, dereferenced member, '\\x14' pointer: \u0026{'\\x1e'}, member: '\\x1e', dereferenced: {'\\x1e'}, dereferenced member, '\\x1e' which I think was kind of weird. I was confused why I could not see the integer blah member values.\nI asked Chat GPT and got the explanation that the %q verb indeed, will attempt to safely escape what it prints. So sounds like when dealing with pointers, even the dereferenced resulting instance member integer is escaped as hex.\nAnd Chat GPT suggested an alternate set of verbs.\nTake 2, package main import ( \"fmt\" ) type SomeType struct { blah int } func main() { pointerToStruct := \u0026SomeType{} fmt.Println( fmt.Sprintf( \"pointer: %p, member: %d, dereferenced: %v, dereferenced member, %d\", pointerToStruct, pointerToStruct.blah, (*pointerToStruct), (*pointerToStruct).blah)) pointerToStruct.blah = 20 fmt.Println( fmt.Sprintf( \"pointer: %p, member: %d, dereferenced: %v, dereferenced member, %d\", pointerToStruct, pointerToStruct.blah, (*pointerToStruct), (*pointerToStruct).blah)) (*pointerToStruct).blah = 30 fmt.Println( fmt.Sprintf( \"pointer: %p, member: %d, dereferenced: %v, dereferenced member, %d\", pointerToStruct, pointerToStruct.blah, (*pointerToStruct), (*pointerToStruct).blah)) } gave me a cleaner result\npointer: 0xc000012028, member: 0, dereferenced: {0}, dereferenced member, 0 pointer: 0xc000012028, member: 20, dereferenced: {20}, dereferenced member, 20 pointer: 0xc000012028, member: 30, dereferenced: {30}, dereferenced member, 30 ","wordCount":"2115","inLanguage":"en","datePublished":"2023-12-23T00:00:00Z","dateModified":"2024-01-07T15:54:17-05:00","author":{"@type":"Person","name":"Michal Piekarczyk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://michal.piekarczyk.xyz/post/2023-12-23-learn-golang-through-chat-gpt-conversation/"},"publisher":{"@type":"Organization","name":"michal.piekarczyk.xyz","logo":{"@type":"ImageObject","url":"https://michal.piekarczyk.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://michal.piekarczyk.xyz/ accesskey=h title="michal.piekarczyk.xyz (Alt + H)">michal.piekarczyk.xyz</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://michal.piekarczyk.xyz/post/ title=posts><span>posts</span></a></li><li><a href=https://michal.piekarczyk.xyz/project/ title=projects><span>projects</span></a></li><li><a href=https://michal.piekarczyk.xyz/handy/ title=handy><span>handy</span></a></li><li><a href=https://michal.piekarczyk.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://michal.piekarczyk.xyz/about/ title=about><span>about</span></a></li><li><a href=https://world.hey.com/michal.piekarczyk title=frivolity><span>frivolity</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://michal.piekarczyk.xyz/>Home</a>&nbsp;¬ª&nbsp;<a href=https://michal.piekarczyk.xyz/post/>Posts</a></div><h1 class=post-title>Some of my notes through learning Golang by conversing with ChatGPT</h1><div class=post-meta>&lt;span title='2023-12-23 00:00:00 +0000 UTC'>December 23, 2023&lt;/span>&amp;nbsp;¬∑&amp;nbsp;10 min&amp;nbsp;¬∑&amp;nbsp;2115 words&amp;nbsp;¬∑&amp;nbsp;Michal Piekarczyk</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#i-have-not-messed-around-with-golang-yet-and-figured-why-not-try-to-learn-this-through-just-chatting-with-chatgpt>I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT?</a></li><li><a href=#error-handling-is-very-different-in-go>Error handling is very different in Go</a></li><li><a href=#attaching-functions-to-struct-types>Attaching functions to struct types</a><ul><li><a href=#indeed-i-tried-changing-the-return-type-to-see-what-would-happen>Indeed, I tried changing the return type to see what would happen</a></li></ul></li><li><a href=#behavior-of-passing-objects-into-functions>Behavior of passing objects into functions</a></li><li><a href=#http-server-with-channels-for-delegating-to--workers>HTTP server with channels for delegating to workers</a><ul><li><a href=#received-this-example-code-based-on-my-question>Received this example code based on my question</a></li><li><a href=#okay-that-basically-worked-out-of-the-box>Okay that basically worked out of the box</a></li><li><a href=#first-try-produced-empty-responses-for-the-client>First try produced empty responses for the client</a></li><li><a href=#ok-so-i-tried-creating-adding-a-channel-on-which-the-handler-blocks-and-that-worked->Ok, so I tried creating adding a channel on which the handler blocks and that worked !</a></li></ul></li><li><a href=#reading-a-csv>Reading a csv</a><ul><li></li></ul></li><li><a href=#mapping-receiver-functions-to-types-as-value-receiver-or-pointer-receivers>Mapping receiver functions to types as value receiver or pointer receivers</a><ul><li><a href=#as-a-value->As a value ,</a></li></ul></li><li><a href=#looking-like-pointers-in-go-are-very-similar-to-pointers-in-c->Looking like pointers in Go are very similar to pointers in C++ ,</a><ul><li><a href=#take-2>Take 2,</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=i-have-not-messed-around-with-golang-yet-and-figured-why-not-try-to-learn-this-through-just-chatting-with-chatgpt>I have not messed around with Golang yet and figured why not try to learn this through just chatting with ChatGPT?<a hidden class=anchor aria-hidden=true href=#i-have-not-messed-around-with-golang-yet-and-figured-why-not-try-to-learn-this-through-just-chatting-with-chatgpt>#</a></h2><p>Not a full conversation below , but just using this to jot down some notes. And most of the code examples I&rsquo;m pasting below are from ChatGPT.</p><h2 id=error-handling-is-very-different-in-go>Error handling is very different in Go<a hidden class=anchor aria-hidden=true href=#error-handling-is-very-different-in-go>#</a></h2><p>So no exceptions like Python. Instead, you can give a return tuple type from a function like this and the second term will be a error code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>divide</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> <span style=color:#66d9ef>float64</span>) (<span style=color:#66d9ef>float64</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;division by zero&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>b</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>divide</span>(<span style=color:#ae81ff>10.0</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Error:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Result:&#34;</span>, <span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=attaching-functions-to-struct-types>Attaching functions to struct types<a hidden class=anchor aria-hidden=true href=#attaching-functions-to-struct-types>#</a></h2><p>So there are no classes per se. You can however attach methods to structs, with this additional syntactic sugar, below.</p><p>There is an additional <code>(r Rectangle)</code> squished in between <code>func</code> and <code>Area</code> and the arguments are an empty <code>()</code>.</p><p>In addition , an interface is defined also below, <code>Shape</code>, which carries a subset of the methods that are defined on the struct type <code>Rectangle</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define a struct
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Rectangle</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Width</span>, <span style=color:#a6e22e>Height</span> <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define a method on the struct
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>Rectangle</span>) <span style=color:#a6e22e>Area</span>() <span style=color:#66d9ef>float64</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Width</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Height</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define an interface
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Shape</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Area</span>() <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Shape</span> = <span style=color:#a6e22e>Rectangle</span>{<span style=color:#a6e22e>Width</span>: <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>Height</span>: <span style=color:#ae81ff>5</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Area:&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Area</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In addition, I was inquiring in the above , why bother specifying that the return of <code>Area</code> in the interface <code>Shape</code> is <code>float64</code> if we already know the type from the earlier definition of <code>Area</code> earlier. And the response was that more or less the interface is a contract and that types &ldquo;might&rdquo; implement it or they might not.</p><h3 id=indeed-i-tried-changing-the-return-type-to-see-what-would-happen>Indeed, I tried changing the return type to see what would happen<a hidden class=anchor aria-hidden=true href=#indeed-i-tried-changing-the-return-type-to-see-what-would-happen>#</a></h3><p>So only updating that one thing, I tried running the below in <a href=https://go.dev/play/>https://go.dev/play/</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define a struct
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Rectangle</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Width</span>, <span style=color:#a6e22e>Height</span> <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define a method on the struct
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>Rectangle</span>) <span style=color:#a6e22e>Area</span>() <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Width</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Height</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define an interface
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Shape</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Area</span>() <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Shape</span> = <span style=color:#a6e22e>Rectangle</span>{<span style=color:#a6e22e>Width</span>: <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>Height</span>: <span style=color:#ae81ff>5</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Area:&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Area</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and actually first I got a message that multiplying floats will not produce an <code>int</code>. Very nice.</p><pre tabindex=0><code>./prog.go:12:9: cannot use r.Width * r.Height (value of type float64) as int value in return statement
</code></pre><p>And I also got the message,</p><pre tabindex=0><code>./prog.go:21:16: cannot use Rectangle{‚Ä¶} (value of type Rectangle) as Shape value in variable declaration: Rectangle does not implement Shape (wrong type for method Area)
		have Area() int
		want Area() float64
</code></pre><p>and the line 21 above is the <code>var s Shape = Rectangle{Width: 10, Height: 5}</code> , so, cool, as expected, this is an error not on the interface, not on the type implementing the interface, but on the declaration that attempts to use the type <code>Rectangle</code> claiming to implement the interface <code>Shape</code>. Interesting.</p><p>And indeed when I fix the types of <code>Width</code> and <code>Height</code> to <code>int</code> in <code>Rectangle</code> and comment out that line <code>21</code> above, the program actually has no compile error, so then looks like this is a runtime error only.</p><h2 id=behavior-of-passing-objects-into-functions>Behavior of passing objects into functions<a hidden class=anchor aria-hidden=true href=#behavior-of-passing-objects-into-functions>#</a></h2><p>Ok, we have pass by value behavior and we have pass by reference behavior, depending on the type.</p><p>Wow, i learned that the size of a Go array is part of its type and therefore you must define a different function for different sizes of arrays as inputs.</p><p>But this is not true of slices as function parameters, which also have a pass by reference behavior as opposed to array pass by value behavior and so overall seems like passing slices to functions is the way to go.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go></code></pre></div><h2 id=http-server-with-channels-for-delegating-to--workers>HTTP server with channels for delegating to workers<a hidden class=anchor aria-hidden=true href=#http-server-with-channels-for-delegating-to--workers>#</a></h2><p>Discussing this, I was asking , hey if I want to build a web server with Golang, with a listener that receives HTTP requests and then pushes them to channels for available workers to consume , are channels good option for this or would this cause the listener go routine to block on channel push operations?</p><p>Chat GPT reminding me that, unbufferes channels block but also buffered channels that are &ldquo;full&rdquo; also block.</p><p>But the recommendation was to use a channel with a capacity that is large enough to handle peak loads, and then that would prevent a listener from blocking on a push to the channel.</p><p>Yea good point!</p><h3 id=received-this-example-code-based-on-my-question>Received this example code based on my question<a hidden class=anchor aria-hidden=true href=#received-this-example-code-based-on-my-question>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>jobs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d processing request: %v\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Process the request...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#ae81ff>100</span>) <span style=color:#75715e>// Buffered channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Start worker goroutines
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>w</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>w</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>w</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>jobs</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// HTTP listener (simplified example)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Received request:&#34;</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>&lt;-</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>r</span> <span style=color:#75715e>// Send the request to the channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintln</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Request is being processed&#34;</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Nice let me see if it runs !</p><h3 id=okay-that-basically-worked-out-of-the-box>Okay that basically worked out of the box<a hidden class=anchor aria-hidden=true href=#okay-that-basically-worked-out-of-the-box>#</a></h3><p>Only that <code>"time"</code> was imported but unused. Other than that worked like here, after putting this into a <code>serve.go</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>go run serve.go
</span></span></code></pre></div><p>and I used a python repl to call the server,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>2</span>]: data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;some&#34;</span>: <span style=color:#e6db74>&#34;data&#34;</span>}
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>: r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#34;http://localhost:8080&#34;</span>, json<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>3</span>]: r<span style=color:#f92672>.</span>status_code, r<span style=color:#f92672>.</span>text
</span></span><span style=display:flex><span>Out[<span style=color:#ae81ff>3</span>]: (<span style=color:#ae81ff>200</span>, <span style=color:#e6db74>&#39;Request is being processed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span></code></pre></div><p>And saw this in my STDOUT logs,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Received request: &amp;<span style=color:#f92672>{</span>POST / HTTP/1.1 <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> map<span style=color:#f92672>[</span>Accept:<span style=color:#f92672>[</span>*/*<span style=color:#f92672>]</span> Accept-Encoding:<span style=color:#f92672>[</span>gzip, deflate<span style=color:#f92672>]</span> Connection:<span style=color:#f92672>[</span>keep-alive<span style=color:#f92672>]</span> Content-Length:<span style=color:#f92672>[</span>16<span style=color:#f92672>]</span> Content-Type:<span style=color:#f92672>[</span>application/json<span style=color:#f92672>]</span> User-Agent:<span style=color:#f92672>[</span>python-requests/2.31.0<span style=color:#f92672>]]</span> 0xc00012a240 &lt;nil&gt; <span style=color:#ae81ff>16</span> <span style=color:#f92672>[]</span> false localhost:8080 map<span style=color:#f92672>[]</span> map<span style=color:#f92672>[]</span> &lt;nil&gt; map<span style=color:#f92672>[]</span> 127.0.0.1:63359 / &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc000076230<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>1</span> processing request: <span style=color:#f92672>{</span>POST / HTTP/1.1 <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> map<span style=color:#f92672>[</span>Accept:<span style=color:#f92672>[</span>*/*<span style=color:#f92672>]</span> Accept-Encoding:<span style=color:#f92672>[</span>gzip, deflate<span style=color:#f92672>]</span> Connection:<span style=color:#f92672>[</span>keep-alive<span style=color:#f92672>]</span> Content-Length:<span style=color:#f92672>[</span>16<span style=color:#f92672>]</span> Content-Type:<span style=color:#f92672>[</span>application/json<span style=color:#f92672>]</span> User-Agent:<span style=color:#f92672>[</span>python-requests/2.31.0<span style=color:#f92672>]]</span> 0xc00012a240 &lt;nil&gt; <span style=color:#ae81ff>16</span> <span style=color:#f92672>[]</span> false localhost:8080 map<span style=color:#f92672>[]</span> map<span style=color:#f92672>[]</span> &lt;nil&gt; map<span style=color:#f92672>[]</span> 127.0.0.1:63359 / &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc000076230<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Nice, so the response is provided by the server, <code>Request is being processed</code>. And a cool next step would be, okay probably I should pass the response writer <code>http.ResponseWriter</code> to the worker, so that it can send the response? Let me try.</p><h3 id=first-try-produced-empty-responses-for-the-client>First try produced empty responses for the client<a hidden class=anchor aria-hidden=true href=#first-try-produced-empty-responses-for-the-client>#</a></h3><p>So I created a new struct type, for both the request and the response writer,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Packet</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>request</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>response_writer</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And I was passing this to the worker through the channel,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Received request:&#34;</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{})
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>packet</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Packet</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>request</span>: <span style=color:#f92672>*</span><span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>response_writer</span>: <span style=color:#a6e22e>w</span>,
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>packet</span> <span style=color:#75715e>// Send the request to the channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    })
</span></span></code></pre></div><p>with worker , like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Packet</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>packet</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>jobs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>packet</span>.<span style=color:#a6e22e>request</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>response_writer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>packet</span>.<span style=color:#a6e22e>response_writer</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d processing request: %v\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Process the request...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintln</span>(<span style=color:#a6e22e>response_writer</span>, <span style=color:#e6db74>&#34;Request is being processed&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So when the response on the client was blank, this was puzzling. I inquired w/ ChatGPT and got the idea that oh wow üòÆright, the listener is likely returning a response before the worker writes to the buffer there. So I should have the handler block until the worker is done by using a per request channel, <code>done</code>.</p><h3 id=ok-so-i-tried-creating-adding-a-channel-on-which-the-handler-blocks-and-that-worked->Ok, so I tried creating adding a channel on which the handler blocks and that worked !<a hidden class=anchor aria-hidden=true href=#ok-so-i-tried-creating-adding-a-channel-on-which-the-handler-blocks-and-that-worked->#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// &#34;time&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Packet</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>request</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>response_writer</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>done</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Packet</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>packet</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>jobs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>packet</span>.<span style=color:#a6e22e>request</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>response_writer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>packet</span>.<span style=color:#a6e22e>response_writer</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d processing request: %v\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Process the request...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintln</span>(<span style=color:#a6e22e>response_writer</span>, <span style=color:#e6db74>&#34;Request is being processed&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Signal we are done 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>packet</span>.<span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>struct</span>{}{}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Server has started.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Packet</span>, <span style=color:#ae81ff>100</span>) <span style=color:#75715e>// Buffered channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Start worker goroutines
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>w</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>w</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>w</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>jobs</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// HTTP listener (simplified example)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Received request:&#34;</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{})
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>packet</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Packet</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>request</span>: <span style=color:#f92672>*</span><span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>response_writer</span>: <span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>done</span>: <span style=color:#a6e22e>done</span>,
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>packet</span> <span style=color:#75715e>// Send the request to the channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>done</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And on client side,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>In</span> [<span style=color:#ae81ff>10</span>]: <span style=color:#a6e22e>data</span> = {<span style=color:#e6db74>&#34;some&#34;</span>: <span style=color:#e6db74>&#34;xxxxxxxxxxxxxxxxxxxx&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>: <span style=color:#a6e22e>r</span> = <span style=color:#a6e22e>requests</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;http://localhost:8080&#34;</span>, <span style=color:#a6e22e>json</span>=<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>: <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>status_code</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>text</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Out</span>[<span style=color:#ae81ff>10</span>]: (<span style=color:#ae81ff>200</span>, <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#a6e22e>Request</span> <span style=color:#a6e22e>is</span> <span style=color:#a6e22e>being</span> <span style=color:#a6e22e>processed</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>&#39;</span>)
</span></span></code></pre></div><p>Nice.</p><h2 id=reading-a-csv>Reading a csv<a hidden class=anchor aria-hidden=true href=#reading-a-csv>#</a></h2><p>So funny thing happened, I inquired about some simple csv parsing code and ended up with this, since I want to create a dict (aka map) from column 1 to column 2. With a file like</p><pre tabindex=0><code>stuff,num
hambuerger,12
cheesypoofs,.123
cheesy whizz,0.25
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;encoding/csv&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>read_my_csv</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;blah/balh.csv&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`hmmm %q`</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>csv</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>my_dict</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>float64</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>record</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>Read</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;error %q&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>num</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>record</span>[<span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;internal error parsing csv %q&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>my_dict</span>[<span style=color:#a6e22e>record</span>[<span style=color:#ae81ff>0</span>]] = <span style=color:#a6e22e>num</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>my_dict</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But I was getting, oddly,</p><pre tabindex=0><code>&#34;internal error parsing csv &#34;strconv.ParseFloat: parsing \\&#34;num\\&#34;: invalid syntax&#34;&#34;
</code></pre><p>Ah duh, the column header is not a number, right, ok then this csv parsing library is pretty do it yourself then haha üòÖ, if I have to handle reading the header myself.</p><h4 id=looking-further-looks-like-i-just-need-to-read-the-header-row-myself-manually>Looking further, looks like I just need to read the header row myself manually<a hidden class=anchor aria-hidden=true href=#looking-further-looks-like-i-just-need-to-read-the-header-row-myself-manually>#</a></h4><p>So header first, then I can also use <code>reader.ReadAll()</code> , a better way I found to iterate through the remaining rows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>header</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>Read</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;error %q reading header&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;header&#34;</span>, <span style=color:#a6e22e>header</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>records</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>ReadAll</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;error %q reading rows&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>blahMap</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>float64</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>record</span> <span style=color:#a6e22e>in</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>records</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>num</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>record</span>[<span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>blahMap</span>[<span style=color:#a6e22e>record</span>[<span style=color:#ae81ff>0</span>]] = <span style=color:#a6e22e>math</span>.<span style=color:#a6e22e>NaN</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>blahMap</span>[<span style=color:#a6e22e>record</span>[<span style=color:#ae81ff>0</span>]] = <span style=color:#a6e22e>num</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=mapping-receiver-functions-to-types-as-value-receiver-or-pointer-receivers>Mapping receiver functions to types as value receiver or pointer receivers<a hidden class=anchor aria-hidden=true href=#mapping-receiver-functions-to-types-as-value-receiver-or-pointer-receivers>#</a></h2><p>Useful to know that you can assign a function to a struct type, with an instance of the type passed as a copy or as a pointer.</p><p>As a copy, a func will not modify the original.</p><h3 id=as-a-value->As a value ,<a hidden class=anchor aria-hidden=true href=#as-a-value->#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SomeType</span> <span style=color:#66d9ef>struct</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>blah</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>SomeType</span>) <span style=color:#a6e22e>SomeFunc</span>(<span style=color:#a6e22e>hmm</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Here SomeFunc will interact with a copy &#34;s&#34;. 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;SomeFunc&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span>, <span style=color:#a6e22e>hmm</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>SomeType</span>) <span style=color:#a6e22e>SomeOtherFunc</span>(<span style=color:#a6e22e>hmm</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Here SomeFunc will interact with the real &#34;s&#34;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;SomeFunc&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span>, <span style=color:#a6e22e>hmm</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Example 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>SomeType</span>{<span style=color:#ae81ff>22</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;before&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>SomeFunc</span>(<span style=color:#e6db74>&#34;hi&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;after SomeFunc&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Example 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>SomeOtherFunc</span>(<span style=color:#e6db74>&#34;hi&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;after SomeOtherFunc&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blah</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><pre tabindex=0><code>before 22
SomeFunc 22 hi
after SomeFunc 22
SomeFunc 23 hi
after SomeOtherFunc 23
</code></pre><h2 id=looking-like-pointers-in-go-are-very-similar-to-pointers-in-c->Looking like pointers in Go are very similar to pointers in C++ ,<a hidden class=anchor aria-hidden=true href=#looking-like-pointers-in-go-are-very-similar-to-pointers-in-c->#</a></h2><p>I had this program,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// You can edit this code!
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Click here and start typing.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SomeType</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>blah</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pointerToStruct</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>SomeType</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;pointer: %q, member: %q, dereferenced: %q, dereferenced member, %q&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pointerToStruct</span>, <span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span>, (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>), (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span> = <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;pointer: %q, member: %q, dereferenced: %q, dereferenced member, %q&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pointerToStruct</span>, <span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span>, (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>), (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	(<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span> = <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;pointer: %q, member: %q, dereferenced: %q, dereferenced member, %q&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pointerToStruct</span>, <span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span>, (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>), (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and I was seeing the outpu</p><pre tabindex=0><code>pointer: &amp;{&#39;\x00&#39;}, member: &#39;\x00&#39;, dereferenced: {&#39;\x00&#39;}, dereferenced member, &#39;\x00&#39;
pointer: &amp;{&#39;\x14&#39;}, member: &#39;\x14&#39;, dereferenced: {&#39;\x14&#39;}, dereferenced member, &#39;\x14&#39;
pointer: &amp;{&#39;\x1e&#39;}, member: &#39;\x1e&#39;, dereferenced: {&#39;\x1e&#39;}, dereferenced member, &#39;\x1e&#39;
</code></pre><p>which I think was kind of weird. I was confused why I could not see the integer <code>blah</code> member values.</p><p>I asked Chat GPT and got the explanation that the <code>%q</code> verb indeed, will attempt to safely escape what it prints. So sounds like when dealing with pointers, even the dereferenced resulting instance member integer is escaped as hex.</p><p>And Chat GPT suggested an alternate set of verbs.</p><h3 id=take-2>Take 2,<a hidden class=anchor aria-hidden=true href=#take-2>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SomeType</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>blah</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pointerToStruct</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>SomeType</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;pointer: %p, member: %d, dereferenced: %v, dereferenced member, %d&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pointerToStruct</span>, <span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span>, (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>), (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span> = <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;pointer: %p, member: %d, dereferenced: %v, dereferenced member, %d&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pointerToStruct</span>, <span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span>, (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>), (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	(<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span> = <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;pointer: %p, member: %d, dereferenced: %v, dereferenced member, %d&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pointerToStruct</span>, <span style=color:#a6e22e>pointerToStruct</span>.<span style=color:#a6e22e>blah</span>, (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>), (<span style=color:#f92672>*</span><span style=color:#a6e22e>pointerToStruct</span>).<span style=color:#a6e22e>blah</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>gave me a cleaner result</p><pre tabindex=0><code>
pointer: 0xc000012028, member: 0, dereferenced: {0}, dereferenced member, 0
pointer: 0xc000012028, member: 20, dereferenced: {20}, dereferenced member, 20
pointer: 0xc000012028, member: 30, dereferenced: {30}, dereferenced member, 30
</code></pre></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://michal.piekarczyk.xyz/post/2024-02-04-golang-http-struct-types-proliferation/><span class=title>¬´ Prev</span><br><span>Minimizing Golang struct types while observing tyep safety</span>
</a><a class=next href=https://michal.piekarczyk.xyz/post/2023-12-09-imessage-export/><span class=title>Next ¬ª</span><br><span>Exporting messages from Apple imessages</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://michal.piekarczyk.xyz/>michal.piekarczyk.xyz</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>